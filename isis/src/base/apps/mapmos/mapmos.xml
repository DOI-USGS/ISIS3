<?xml version="1.0" encoding="UTF-8"?>

<application name="mapmos" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
  <brief>
    Create a mosaic using map projected cubes
  </brief>

  <description>
    <html>
      <head>
        <style>
          .td {
          padding-left: 20px; width:70px; align:center;
          }
          .td1 {
          padding-left: 5px; width:70px; align:left;
          }
        </style>
      </head>
    <body> <font size="2" face="Verdana">
   <p>
      This program allows the user to create a mosaic using a map projected cube (<def>Level2</def>). 
      A mosaic can be created from an initial cube or the input cube can be placed in a pre-existing mosaic.
    </p>
      <p>
        REQUIREMENT: The input cube must be map projected (<def>Level2</def>).
        The input cube is required to be projected to the EXACT SAME ProjectionName,
        PixelResolution (or MapScale), EquatorialRadius, PolarRadius, LatitudeType,
        LongitudeDirection, as well as specific map projection keywords (e.g., CenterLatitude,
        CenterLongitude).  If these map projection requirements are not met, an error will be
        encountered.
      </p>
      <b>Note</b>: The latitude and longitude range of the individual input cubes may vary. 
      <p>
      If a new mosaic is to be created, it must be initalized with an input cube and CREATE=YES. The
      default size of the output mosaic will be the SAME latitude and longitude extents of the input
      file. The size of the output mosaic can be entered by the user through any or all four
      boundary parameters: MINLAT, MAXLAT, MINLON, MAXLON. The input cube also establishes the
      number of bands and BandBin Group of the output mosaic. If there is a list of input cubes to
      mosaic together, refer to the similar application called <def>automos</def>. 
     </p>
       <p>
        <b>Integrity-check Parameters</b>:
        <p>
          MATCHBANDBIN = TRUE, the default is to require all the bandbin group and wavelength
          keywords of the input cube files exactly match the output mosaic.
        </p>
        <p>
          MATCHDEM = FALSE, the default does not check the SHAPEMODEL keyword of the input cube
          files and does not propagate what DEM Shapemodel was used when the input files were
          projected.
        </p>
      </p>
      <p>
        The PRIORITY parameter will determine how each input cube is combined with the current
        output mosaic cube. The process involves replacing an output mosaic pixel (or not) with
        an input pixel at the same location. There are many user options and criteria that
        influence the pixel replacement. Use of the PRIORITY parameter with and without other
        options is explained in the tables and descriptions below.
      </p>
      <p>
        The TRACK feature creates a separate tracking cube in addition to the mosaic cube and
        contains information for the source files of every pixel within the output mosaic.
        This cube will have the same base-name as the mosaic cube, but will end in 
        "_tracking.cub". The tracking cube must always reside in the same directory as the
        mosaic cube to be properly accessed; this means that if the mosaic cube is copied or
        moved, then its associated tracking cube must be copied or moved to the same location.
        <b>The tracking cube will always be of type unsigned integer. Depending on the
        bit-type of the mosaic cube and/or the number of bands it contains, the tracking cube
        may be as much as four times the size of the mosaic cube itself.</b>
      </p>
      <p>
        The tracking cube can be used appropriately through the QVIEW-AdvancedTracking
        tool. As the user pans across the displayed mosaic, for every mosaic pixel location,
        QVIEW-AdvancedTracking will interactively report the index, the filename and the
        serial number of the input cube that was input to mapmos for that specific pixel
        location. Since the tracking cube is of bit-type unsigned integer, the DN values of
        0, 1 and 2 are reserved for NULL, LRS and LIS, respectively, so valid pixel DN values
        will begin at an offset of 3. In other words, a pixel of DN value 3 in the tracking
        cube means that this same pixel within the mosaic was taken from the first input
        image. The tracking cube cannot be used outside of the QVIEW-AdvancedTracking tool
        except as a visual representation of the source cubes for the different pixels. 
      </p>
      <p>
        The TRACK feature works with Priority options ONTOP and BENEATH for single band input
        cubes. It works for multiband cubes for PRIORITY=ONTOP only when the NULL,
        HIGHSATURATION and LOWSATURATION options are set to true. It also works for multiband
        cubes when PRIORITY=BAND. Furthermore, this feature is NOT supported when
        PRIORITY=AVERAGE.
      </p>
      <p>
        <b>Please Note: Prior to ISIS version 3.6.0, tracking for the various mosaicking apllications
          was being handled with an internal tracking band. Tracking is now being handled by an
          external tracking cube that contains the associated tracking information. This application
          can no longer add to mosaics of the old format. In order to continue to use these
          older mosaics with the updated mosaicking applications, you must first use the
          <def>trackextract</def> utility application to extract the tracking band and the associated
          tracking information into an external tracking cube.</b>
      </p>
      <p>
        <b>
          The following table describes how the program will determine the pixel value in the output
          mosaic for areas of image overlap.
        </b>
        <table border="1" >
          <tr><th>PRIORITY</th><th>RESULT</th></tr>
          <tr>
            <td>ONTOP</td>
            <td>
              This is the default.  The current input image will be placed on top of the
              output mosaic. Thus in any area of overlap, the Valid pixel values for the
              current input image will appear in the output mosaic (it replaces the output mosaic
              pixel).  Invalid input <def>Special Pixels</def>
              (<def>NULL</def>,<def>HRS</def>,<def>HIS</def>,<def>LRS</def>,<def>LIS</def>) will NOT
              replace an existing Valid output mosaic pixel unless the optional flags are set. Refer
              to parameters HIGHSATURATION,LOWSATURATION, and NULL to override replacement of Valid
              output mosaic pixels. 
              <p>
                <b>NOTE:</b> When using this priority with multi-band mosaics and with the TRACK
                option set, all Special Pixel flags must be set as well. This is because the same
                pixel within different bands of a single input image may hold both Valid and Special
                Pixel values, and since our Tracking capabilities can only track one input image per
                pixel (as it is a single band), it must accept the values for that particular pixel
                from <b>every</b> band in the input image being placed on top.
              </p>
            </td>
          </tr>
          <tr>
            <td>BENEATH</td>
            <td>
              The current input image will be placed beneath the output mosaic. Thus in
              any area of overlap, the Valid pixel values for the current mosaic will remain in
              the output mosaic. The Valid pixel values for the current input image will only
              replace the NULL pixels values in the output mosaic.  The HRS,HIS,LRS and LIS  special
              pixel values in the output mosaic will NOT be replaced by the Valid input pixel.
              The parameters HIGHSATURATION, LOWSATURATION and NULL are not supported under this
              priority.
            </td>
          </tr>
          <tr>
            <td>BAND</td>
            <td>
              The input image pixels will be placed in the output mosaic based on the "Lesser" or
              "Greater" criteria of a priority band defined by the user.  Parameters that apply to
              this priority feature are TYPE, NUMBER, KEYNAME, KEYVALUE, CRITERIA.
            </td>
          </tr>
          <tr>
            <td>AVERAGE</td>
            <td>
              Overlapping Valid pixel values from the current input image and output mosaic will be
              averaged for the new mosaic pixel values. A count-band is created with the output
              mosaic file.  The count-band keeps track of the number of images involved in the
              averaging of the input DN values for each pixel in the mosaic. Invalid input pixel
              values will not be included in the average.  In the case where only one Valid pixel
              exists between the input image pixels or the current mosaic pixel, the Valid pixel is
              retained in the current output mosaic. Refer to parameters HIGHSATURATION,
              LOWSATURATION, and NULL to override replacement of valid output mosaic pixels.
              <p>
                Choosing this priority will cause the mosaic to have twice the number of bands of
                the input image. <b>Hence the file (byte) size of the mosaic is increased due to
                the count-bands.</b>
              </p>
              <p>
                <b>NOTE</b>: If an existing mosaic does not already contain a count-band, an error
                will be encountered.
              </p>
            </td>
          </tr>
        </table>
      </p>
      
      <p>
        Each of the following priority option tables indicates the resulting output pixel for a
        particular input pixel, given the selected special pixel options  (parameters
        HIGHSATURATION for HRS, HIS;  LOWSATURATION for LRS, LIS; and NULL) in each table row.

        <!--
          *******************************************************************************
          The graphics below are commented out because they are no longer correct.
          *******************************************************************************
        -->
        <!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u>  Priority OnTop</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/OnTop.jpg" alt="Priority OnTop" />  </td>
              <td class="td"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="1" border="1" width="1000">
                  <tr><th colspan="6" align="center">PRIORITY=ONTOP</th></tr>
                  <tr><th colspan="3" align="center">Options</th>
                      <th colspan="3" align="center">Images</th></tr>
                  <tr><th>High Saturation</th>
                      <th>Low Saturation</th>
                      <th>Null</th>
                      <th>Input Pixel Value Type</th>
                      <th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">High Saturation or Low Saturation or Valid</td>
                      <td class="td2">Mosaic</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Null</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                </table>
    <!--              </td>
          </tr>
        </table>-->
        <br></br><br></br><br></br>
    <!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u>Priority Beneath</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/Beneath.jpg" alt="Priority Beneath" />  </td>
              <td class="td" width="30"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="1" border="1">
                  <tr><th colspan="3" align="center">PRIORITY=BENEATH</th></tr>
                  <tr><th>Input Pixel Value Type</th>
                      <th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th>
                  </tr>
                  <tr><td class="td2">Special or Valid</td>
                      <td class="td2">Null</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">Special or Valid</td>
                      <td class="td2">High Saturation or Low Saturation or Valid</td>
                      <td class="td2">Mosaic</td>
                  </tr>
                </table>
              <!--</td>
          </tr>
        </table>-->

        <br></br><br></br><br></br>
    <!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u> Priority Band</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/Band.jpg" alt="Priority Band" />  </td>
              <td class="td"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="0" border="1" width="1000">
                  <tr><th colspan="6" align="center">PRIORITY=BAND</th></tr>
                  <tr><th colspan="3" align="center">Options</th><th colspan="3" align="center">
                    Images</th></tr>
                  <tr><th>High Saturation</th><th>Low Saturation</th><th>Null</th>
                      <th>Input Pixel Value Type</th><th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Criteria based</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">High Saturation or Low Saturation or Valid</td>
                      <td class="td2">Mosaic</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Null</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Criteria based</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td></tr>
                </table>
    <!--              </td>
          </tr>
        </table>-->
        <br></br><br></br><br></br>
    <!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u>Priority Average</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/Average.jpg" alt="Priority Average" /></td>
              <td class="td"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="0" border="1" width="1000">
                  <tr><th colspan="7" align="center">PRIORITY=AVERAGE</th></tr>
                  <tr><th colspan="3" align="center">Options</th><th colspan="4" align="center">
                    Images</th></tr>
                  <tr><th>High Saturation</th><th>Low Saturation</th><th>Null</th>
                      <th>Input Pixel Value Type</th><th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th>
                      <th>Count Band Pixel Value (# of images used for average)</th></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Average</td>
                      <td class="td2">increment count by 1</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td>
                      <td class="td2">count = 1</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special</td>
                      <td class="td2">Mosaic</td>
                      <td class="td2">count = 0</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Mosaic</td>
                      <td class="td2">count unchanged</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td>
                      <td class="td2">count = 0</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Average</td>
                      <td class="td2">increment count by 1</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td>
                      <td class="td2">count = 1</td></tr>
                </table>
                <!--</td></tr>
        </table>
      -->
        </p>
        <p>
          Refer to <b>automos</b> for additional information and examples.
        </p>
      </font></body>
    </html>
  </description>

  <category>
    <categoryItem>Mosaicking</categoryItem>
  </category>
  <seeAlso>
    <applications>
      <item>automos</item>
      <item>handmos</item>
    </applications>
  </seeAlso>

  <history>
    <change name="Eric Eliason" date="1986-01-02">
       Original version 
    </change>
    <change name="Jeff Anderson" date="2004-02-24">
       Converted to Isis 3.0 
    </change>
    <change name="Jeff Anderson" date="2004-02-26">
       Modified to not propagate input labels to the output mosaic
    </change>
    <change name="Jeff Anderson" date="2005-11-15">
       Fixed bug with mapping groups not properly initialized or copied 
    </change>
    <change name="Jacob Danton" date="2005-12-05">
       Added appTest 
    </change>
    <change name="Elizabeth Miller" date="2006-05-18">
      Depricated CubeProjection and ProjectionManager to ProjectionFactory
    </change>
    <change name="Elizabeth Miller" date="2006-09-01">
      Added the MATCHBANDBIN option that checks to make sure the input cube bandbin group
      matches the mosaic bandbin group. The default is true.
    </change>
    <change name="Steven Lambright" date="2008-05-13">
      This program now utilizes ProcessMapMosaic
    </change>
    <change name="Christopher Austin" date="2008-09-19">
      If the given cube falls outside the provided the mosaic, it will now be
      logged.  (Removed some unused header files.)
    </change>
    <change name="Christopher Austin" date="2008-12-11">
      Changed the parameters SLAT, ELAT, SLON, ELON to MINLAT, MAXLAT, MINLON,
      MAXLON in correlation with automos.
    </change>
    <change name="Sharmila Prasad" date="2009-10-15">
      Added option "TRACK" to track pixel origin. Also added new priority called BAND where
      specified input and mosaic band is compared for moving input to mosaic and to track the
      pixel origin. Added parameter "TYPE" to choose Band "NUMBER" or PVL "KEYWORD" from the
      BandBin group. If "BANDNUMBER" is chosen, then "NUMBER" is activated to enter band number.
      If "KEYWORD" is chosen then parameter "KEYNAME" and "KEYVALUE" are activated to enter key
      name and value from the BandBin group for band comparison. Band comparison "CRITERIA" are
      "LESSER" or "GREATER" than.  Also there are options "HIGHSATURATION", "LOWSATURATION" and
      "NULL", set to true will cause HS, LS and NULL input pixels to be copied to the mosaic
      regardless of the priorities and criteria. These options are not supported for  "BENEATH"
      priority.
    </change>
    <change name="Sharmila Prasad" date="2010-10-27">
      Process Input File Attributes
    </change>
    <change name="Sharmila Prasad" date="2011-01-19">
      Added "AVERAGE" priority where the mosaic will be average of valid input and mosaic pixels.
    </change>
    <change name="Sharmila Prasad" date="2011-01-24">
      Option to match DEM and also added new group "mosaic" to hold ShapeModel attributes for the
      mosaic.
    </change>
    <change name="Sharmila Prasad" date="2011-11-07">
      Updated documentation for Average priority. Fixes #553.
    </change>
    <change name="Kimberly Oyama" date="2012-09-18">
      When an image is placed twice (usually because the longitude range is greater than 360 and
      encompasses the image more than once) only the last occurance was written to the log file.
      This has been fixed so that there is an entry in the log file for every image placement.
      References #976.
    </change>
    <change name="Kimberly Oyama" date="2013-04-15">
      Made the default for the TYPE parameter BANDNUMBER because, when running the GUI and
      PRIORITY=BAND, a blank "TYPE=" was added to the command line string. This no longer
      occurs, there is either no TYPE parameter or it is set to "TYPE=BANDNUMBER". Fixes #1549.
    </change>
    <change name="Kimberly Oyama" date="2014-02-14">
      Removed the requirement that all four lat/lon extents be entered by the user. The user can
      now enter as little as none if the input cube Mapping group has the extents. However, if
      the input cube is missing any of the extents, the user must enter them. If any of the 
      extents are missing, an error will be thrown. Fixes #1550.
    </change>
    <change name="Kimberly Oyama and Tammy Becker" date="2014-04-05">
      Updated Documentation. Updated unit test for priority=band. Fixes #1620. References #1623. References #1550.
    </change>
    <change name="Summer Stapleton" date="2018-08-13">
      Updated documentation to reflect new handling of tracking capabilities with an external
      tracking cube as well as clarify why special pixel flags are required when priority=ontop for
      multiband mosaics. References #2092
    </change>
  </history>

  <oldName>
    <item>mosaic</item>
  </oldName>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>cube</type>
        <fileMode>input</fileMode>
        <brief>
          Cube to be placed in the mosaic
        </brief>
        <description>
          This cube will be placed in the mosaic. It must have the same ProjectionName,
          PixelResolution, EquatorialRadius, PolarRadius, LatitudeType, and LongitudeDirection as
          the mosaic. The projection specific keywords, such as CenterLatitude and CenterLongitude,
          must match as well. 
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>

      <parameter name="MOSAIC">
        <type>cube</type>
        <fileMode>output</fileMode>
        <brief>
          Mosaic cube
        </brief>
        <description>
          The output mosaic cube which will have the input cube placed in it. If the selected cube does
          not already exist as a mosaic, the CREATE option must be selected and it will be created.
          In this case the latitude and longitude range parameters must be entered.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>
    
      <parameter name="PRIORITY">
        <type>string</type>
        <default>
          <item>ONTOP</item>
        </default>
        <brief>
          The priority of pixel placement
        </brief>
        <description>
          This parameter determines how the pixels from the input cube will be placed
          in the mosaic.
        </description>

        <list>
          <option value="ONTOP">
            <brief>
              Input cube will be placed on top of the mosaic
            </brief>
            <description>
              Valid input pixels will always be copied onto the mosaic. Any input pixel will be
              placed onto a NULL mosaic pixel. If the mosaic pixel is not NULL and the input pixel 
              is special, it will only be copied onto the mosaic if the special pixel flags are set.
            </description>
            <exclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
              <item>NUMBER</item>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
           </exclusions>
          </option>
          <option value="BENEATH">
            <brief>
              Input cube will be placed beneath the mosaic
            </brief>
            <description>
               If the mosaic pixel is NULL, then the input pixel will be placed on top of the
               mosaic. Otherwise, it remains unchanged.
            </description>
            <exclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
              <item>NUMBER</item>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
              <item>HIGHSATURATION</item>
              <item>LOWSATURATION</item>
              <item>NULL</item>
           </exclusions>
          </option>
          <option value="BAND">
            <brief>
              Input pixel is placed based on the CRITERIA parameter
            </brief>
            <description>
              If the input and mosaic pixel of the priority band, specified by NUMBER or KEYNAME
              and KEYVALUE, are valid, a less than or greater than comparison is done. Depending on
              the CRITERIA selected, the lower or higher of the two pixels is placed on top.
              Special and NULL pixels are not placed on top unless their flags are set. So, if the
              comparison of the priority band says that the input pixel should be on top but the
              input pixel on any other band is null, without the null option being selected, the
              mosaic pixel will remain unchanged for that band.
            </description>
             <inclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
           </inclusions>
          </option>
          <option value="AVERAGE">
            <brief>
              Average of valid input and the mosaic pixels
            </brief>
            <description>
              If the Input and Mosaic pixels are valid, the output will be the average of
              the 2 values. A count band is created for each corresponding band in the mosaic and
              holds the count of the images corresponding to the Average DN value of each pixel in
              the  mosaic.
            </description>
            <exclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
              <item>NUMBER</item>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
              <item>TRACK </item>
           </exclusions>
          </option>
        </list>
      </parameter>
    </group>
    <group name="Band Priority">
      <parameter name="TYPE">
        <type>string</type>
        <default>
          <item>
            BANDNUMBER
          </item>
        </default>
        <brief>
          Indicate the Band name or number to be used for comparison
        </brief>
        <description>
          This option allows you to select the method to specify the band
          to use for the pixel comparison. 
        </description>
        <list>
          <option value="BANDNUMBER">
            <brief>Band Number </brief>
            <description>
              You can enter the band number to use in the pixel comparison.
            </description>
            <inclusions>
              <item>NUMBER</item> 
              </inclusions>
            <exclusions>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
            </exclusions>
          </option>
          <option value="KEYWORD">
            <brief>
              PVL Keyword in "BandBin" group
            </brief>
            <description>
              Selecting this option allows you to enter the Keyword name and value
              corresponding to the band to use in the pixel comparison.
            </description>
           <exclusions>
              <item>NUMBER</item> 
            </exclusions>
            <inclusions>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
            </inclusions>
          </option>
        </list>
      </parameter>

      <parameter name="NUMBER">
        <type>integer</type>
        <default><item>1</item></default>
        <brief>
          Enter the Band Number
        </brief>
        <description>
          This is the number of the band to use for the pixel comparison.
        </description>
      </parameter>

      <parameter name="KEYNAME">
        <type>string</type>
        <default><item>OriginalBand</item></default>
        <brief>
          Enter the Keyword name as it appears in the BandBin Group
        </brief>
        <description>
          This is the keyword string. The entered keyword name must match the name in the
          BandBin group in the image labels.
        </description>
      </parameter>

      <parameter name="KEYVALUE">
        <type>string</type>
        <default>
          <item>1</item>
        </default>
        <brief>
          Enter the value associated with the "KEYNAME"
        </brief>
        <description>
          This value must match the value associated with the KEYNAME parameter.
        </description>
      </parameter>

      <parameter name="CRITERIA">
        <type>string</type>
        <default>
           <item>LESSER</item>
        </default>
        <brief>
          Determines pixel placement given a band
        </brief>
        <description>
          Select which type of comparison to do on the pixels. You can choose whether the lesser
          or greater of the two pixels will be placed on top of the mosaic.
        </description>
        <list>
          <option value="LESSER">
            <brief>
              The lower DN value between the input and mosaic pixels will be placed on top
            </brief>
            <description>
              The lower DN value between the input and mosaic pixels will be placed on top of
              the mosaic.
            </description>
          </option>
          <option value="GREATER">
           <brief>
             The larger DN value between the input and mosaic pixels will be placed on top
           </brief>
            <description>
              The larger DN value between the input and mosaic pixels will be placed on top of
              the mosaic.
            </description> 
        </option>
      </list>
      </parameter>
    </group>

    <group name="Initialization">
      <parameter name="CREATE">
        <type>boolean</type>
        <default>
          <item>NO</item>
        </default>
        <brief>
          Create the output mosaic
        </brief>
        <description>
          Select this parameter if the mosaic does not already exist.
        </description>
        <inclusions>
            <item>MINLAT</item>
            <item>MAXLAT</item>
            <item>MINLON</item>
            <item>MAXLON</item>
            <item>TRACK</item>
        </inclusions>
      </parameter>

      <parameter name="TRACK">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Track the source filename for each mosaic pixel</brief>
        <description>
          <p>
            The Track feature creates a separate tracking cube containing the index values for
            the source of every pixel in the output mosaic. The tracking cube can only be used
            appropriately through the  QVIEW-AdvancedTracking tool. As the user pans across the
            displayed mosaic, for every mosaic pixel location QVIEW-AdvancedTracking will
            interactively report the filename, the serial number and the index of the input cube
            that was input to mapmos for that specific pixel location. The tracking cube cannot
            be used outside the QVIEW-AdvancedTracking tool except as a visual representation of
            the source cubes for the different pixels. TRACK must be set to TRUE at the time of
            mosaic creation only and cannot be turned on after the mosaic is created. When a
            mosaic is created with TRACK=TRUE, all subsequent runs will default to TRACK=TRUE.
            When a mosaic is created with TRACK=FALSE, an error will be encountered if subsequent
            runs have TRACK=TRUE. <b>The tracking cube will always be of type unsigned integer.
            Depending on the bit-type of the mosaic cube and/or the number of bands it contains,
            the tracking cube may be as much as four times the size of the mosaic cube itself.</b>
          </p>
          <p>
            WARNING:
            If Tracking is turned on in a mosaic, any subsequent applications that modify DN
            values, such as the application<def>reduce</def>, will corrupt the DN values in the
            tracking cube.
          </p>
        </description>
      </parameter>

      <parameter name="MINLAT">
        <type>double</type>
        <minimum inclusive="yes">-90.0</minimum>
        <brief>
          Minimum Latitude
        </brief>
        <description>
          This parameter specifies the minimum latitude of the mosaic.
        </description>
        <internalDefault>Use Map Value</internalDefault>
      </parameter>

      <parameter name="MAXLAT">
        <type>double</type>
        <maximum inclusive="yes">90.0</maximum>
        <brief>
          Maximum Latitude
        </brief>
        <description>
            This parameter specifies the maximum latitude of the mosaic.
        </description>
        <greaterThan>
            <item>MINLAT</item>
        </greaterThan>
        <internalDefault>Use Map Value</internalDefault>
      </parameter>

      <parameter name="MINLON">
        <type>double</type>
        <brief>
          Minimum Longitude
        </brief>
        <description>
            This parameter specifies the minimum longitude of the mosaic.
        </description>
        <internalDefault>Use Map Value</internalDefault>
      </parameter>

      <parameter name="MAXLON">
        <type>double</type>
        <brief>
          Maximum Longitude
        </brief>
        <description>
            This parameter specifies the maximum longitude of the mosaic.
        </description>
        <greaterThan>
            <item>MINLON</item>
        </greaterThan>
        <internalDefault>Use Map Value</internalDefault>
      </parameter>
    </group>

     <group name="Options">
      <parameter name="MATCHBANDBIN">
        <type>boolean</type>
        <brief>
          Enforce BandBin Group Match
        </brief>
        <description>
          This option causes the application to fail if the input
	  BandBin Group keywords do not 
          match the mosaic BandBin Group.
        </description>
        <default><item>TRUE</item></default>
      </parameter>
        <parameter name="MATCHDEM">
        <type>boolean</type>
        <brief>
          Enforce DEM Match
        </brief>
        <description>
          This option causes the application to fail if the input DEM
	  shapemodel file does not
          match the filename value in the output mosaic ShapeModel.
        </description>
        <default><item>FALSE</item></default>
      </parameter>
      <parameter name="HIGHSATURATION">
        <type>boolean</type>
        <default><item> FALSE</item></default>
        <brief>
          Copy Input HS (Instrument and Representation) values
        </brief>
        <description>
          This option causes an input High Saturation special pixel value
          (both Instrument and Representation) to replace the output mosaic pixel
          regardless of the priority set or the original value of the mosaic pixel.
        </description>
      </parameter>
      <parameter name="LOWSATURATION">
        <type>boolean</type>
        <default><item> FALSE</item></default>
        <brief>
          Copy Input LS (Instrument and Representation) values
        </brief>
        <description>
          This option causes input NULL pixel values to replace the output mosaic pixel
          regardless of the priority set or the original value of the mosaic pixel.
        </description>
      </parameter>
      <parameter name="NULL">
        <type>boolean</type>
        <default><item> FALSE</item></default>
        <brief>
          Copy Input NULL values
        </brief>
        <description>
          This option causes NULL values  in the input image to be automatically 
          copied to the mosaic regardless of the priority.
        </description>
      </parameter>
    </group>
  </groups>
</application>
