<?xml version="1.0" encoding="UTF-8"?>

<application name="equalizer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>
    Tone matches map projected cubes
  </brief>

  <description>
    <p>
      This program tone matches or equalizes the brightness and/or contrast of a list of
      input cubes prior to mosaicking. All the input cubes, including mosaics, must be in identical
      map projection since equalizer uses the mapping information to gather statistics in
      overlapping areas.
    </p>
    <p>
      Statistic gathering is done on a band-by-band basis. The statistics
      are used in a least squares solution to determine multiplicative (GAIN or MULT) and additive
      (OFFSET or BASE) corrections for each image. In addition to simply calculating corrective
      factors and applying said factors to each image (BOTH), the user has the option to only
      calculate statistics (CALCULATE) and then examine these gathered statistics in a text file
      (OUTSTATS). Then, equalizer can be run again using that statistics file as input (INSTATS)
      to apply correction to any or all of the images without the need to calculate corrective
      factors again.
    </p>
    <p>
      Corrective factors will be undetermined if there are insufficient valid overlaps or if there
      are any images that have no overlaps. If an output statistics file is provided (OUTSTATS),
      images that do not overlap will appear in the file.
    </p>
    <p>
      When corrective factors are undetermined, the user can use the RECALCULATE process option
      to try to solve them. To do this, images can be added to the input list to try to create
      more overlaps or images without overlaps can be removed. An input statistics file (INSTATS)
      containing previously calculated image statistics must be provided. These statistics will be
      reloaded so overlap statistics will only be recalculated for new images in the modified input
      list. If all the images have overlaps and sufficient valid overlaps exist, corrective factors
      will be determined. Statistics can be recalculated as many times as desired by repeating the
      above steps.
    </p>
    <p>
      Additionally, the RETRYBOTH process option may be used to recalculate statistics and then
      apply corrective factors. This requires the user to provide an INSTATS file containing
      previously calculated statistics. It is also suggested that the user provide an OUTSTATS file
      in case corrective factors cannot be determined. If the corrective factors are determined,
      they will then be applied to the input images.
    </p>
    <p>
      The addition of these RETRYBOTH and RECALCULATE parameters has modified the content of
      the output statistics. Additional information is included in the output statistics
      so that previously calculated overlap statistics can be reloaded when using these parameters.
      Note that statistics files created with previous versions of ISIS can still be used as
      input statistics.
    </p>
    <p>
      The actual equation to be used for equalization, for ADJUST=BRIGHTNESS, CONTRAST or BOTH, on
      each band in each cube is as follows:
      <pre>
        newdn(s,l,b)   =   (olddn(s,l,b) - avg(b)) * GAIN(b) + (avg(b) + OFFSET(b))
      </pre>
      where
      <pre>
        s = sample index
        l = line index
        b = band index
      </pre>

      The actual equation to be used for equalization, for ADJUST=GAIN, on
      each band in each cube is
      <pre>
        newdn(s,l,b)   =   olddn(s,l,b) * GAIN(b)
      </pre>
      where
      <pre>
        s = sample index
        l = line index
        b = band index
      </pre>
    </p>

    <p>
      Prior to equalizing, the user can choose whether to adjust the
      brightness and/or contrast of the cubes. The default is to adjust both;
      however, if the brightness (average) of all the cubes is the same,
      then simply adjusting the contrast may suffice.   Likewise, if the
      standard deviation of all the cubes is similar, then a contrast
      adjustment is not necessary.  Adjusting for contrast only implies
      the OFFSET values will be held to zero.  Similarly, adjusting for
      brightness implies the GAIN values will be held to one.
    </p>

    <p>
      The OFFSET and GAIN values are computed independently for each image,
      therefore we have two least squares computations with N unknowns,
      where N is the number of cubes to be equalized. The overlaps, M,
      between all the cubes are computed, and in some cases M &lt; N.
      This implies an underdetermined system, and the program will report
      an error if this occurs.  You can hold one or more images to alleviate
      this problem.  Holding an image forces GAIN and OFFSET to 1.0 and 0.0
      for that image, respectively.
    </p>

    <p>
      If the user chooses to apply correction to the images, then a list
      of output file names can be specified with the TOLIST parameter.  If no
      TOLIST is specified, the equalized cubes will be named the same as the
      input cubes with the addition of '.equ' prior to the '.cub'
      extension, and placed in the same directories as their input files.
    </p>

    <p>
      For the sake of efficiency, the user may choose to set the "sampling
      percent" to be less than its default value of 100.0.  By doing so, the
      program will likely perform its statistic gathering noticeably faster,
      but at the risk of losing accuracy in the results.  It should
      be noted that the user also runs the risk of encountering an error if
      decreasing the sampling percent results in the amount of valid data in
      the calculated overlaps being less than the minimum set by the
      MINCOUNT parameter (default value of 1000).  Sampling percent must be
      a decimal value between 0.0 (exclusive) and 100.0 (inclusive).
    </p>

    <p>
      This program defaults to solving the least-squares system using the
      SPARSE matrix method. This method is able to find valid solutions, even
      when no hold list is provided.

      <!-- The following is commented out since SVD is not currently
         implemented:

      Two other solution methods are also
      available, a QR decomposition (QRD) method or single value decompostion
      (SVD) method.

      -->

      The QRD method is fairly accurate and fast, but does not
      produce valid results in all cases, especially if no images are held.
      Previous versions of equalizer used this method to solve.

      <!-- The following is commented out since SVD is not currently
         implemented:

      The SVD method
      tends to be slower than QRD, but it tends to return more accurate results
      and will sometimes produce valid results when no hold list is provided.

      -->
    </p>
  </description>

  <category>
    <categoryItem>Mosaicking</categoryItem>
  </category>

  <oldName>
    <item>b4equal</item>
  </oldName>

  <history>
    <change name="Kay Edwards" date="1994-05-24">
      Original version.
    </change>
    <change name="Elizabeth Ribelin" date="2005-06-25">
      Ported to Isis 3.0.
    </change>
    <change name="Elizabeth Ribelin" date="2005-10-04">
      Changed categoryItem to Photometry and Radiometry.
    </change>
    <change name="Brendan George" date="2005-11-07">
      Added application test.
    </change>
    <change name="Elizabeth Miller" date="2006-01-12">
      Made SD default contrast mode (PCA may have errors).
    </change>
    <change name="Jeff Anderson" date="2007-07-16">
      Fixed memory leak.
    </change>
    <change name="Jeff Anderson" date="2008-04-09">
      Modified to solve system using QRD which is faster the SVD.
    </change>
    <change name="Steven Lambright" date="2008-05-12">
      Removed references to CubeInfo.
    </change>
    <change name="Tracie Sucharski" date="2008-06-12">
      Modified call LeastSquares Solve due to change to LeastSquares
      Solve method.
    </change>
    <change name="Travis Addair" date="2009-03-12">
      Added user feedback during statistic gathering, modified existing progress
      information, and moved error checking on number of bands and projection
      parameters to be done prior to statistic gathering.
    </change>
    <change name="Travis Addair" date="2009-06-24">
      Refactored for use with the new OverlapNormalization class, thus removing
      the option to use the broken PCA contrast mode; the PVL output has been
      modified to print all normalization information for a cube in one group
      with OverlapStatistics information coming last in the file; added an
      option to decrease the percentage of lines sampled in statistic gathering.
    </change>
    <change name="Travis Addair" date="2009-07-17">
      Added a TOLIST parameter, allowing the user to specify a unique output
      file name and location for each input file.  The default is now to
      place each output file in the same directory as its input file, not in
      the current working directory.
    </change>
    <change name="Travis Addair" date="2009-07-30">
      Added functionality allowing the user to run the program applying
      corrections based off of previously gathered statistics obtained from
      the program's output PVL file.  The output PVL has also been changed
      from "PVL" to "OUTSTATS".  Results will now be placed into the print
      file.
    </change>
    <change name="Travis Addair" date="2009-11-19">
      Updated documentation and examples to reflect the most recent changes to
      using the program.
    </change>
    <change name="Jeannie Backer" date="2013-01-29">
      Added parameter SOLVEMETHOD to allow user to choose the method in which
      the system of equations will be solved. Removed unnecessary error throws
      from implementation file, now use xml to require OUTSTATS when
      PROCESS=CALCULATE and require the PERCENT entered to be in the interval
      (0, 100]. Improve test coverage to 100%. Fixes #962.
    </change>
    <change name="Jeannie Backer" date="2013-02-04">
      Removed SVD option from the  SOLVEMETHOD parameter since this option is
      not producing correct results on MAC OS, see mantis ticket #1472.
      If this bug is fixed and the option is reimplemented, the noHoldCalculateSparse
      test data can be used to test the SVD method. Also, the documentation about
      this method should be uncommented in the general description of the program,
      in the QRD description. References #962.
    </change>
    <change name="Steven Lambright" date="2013-02-06">
      Added the option "ADJUST=GAIN" based on a prototype developed by Jeff
      Anderson. Fixes #911.
    </change>
    <change name="Jeannie Backer" date="2013-02-27">
      Fixed user documentation. References #962.
    </change>
    <change name="Ian Humphrey" date="2016-07-15">
      Added RETRYBOTH and RECALCULATE parameters to allow user to fix any non-overlapping images
      in the input image list and recalculate statistics for any new images in the input list,
      reusing previously calculated statistics for the rest of the images. Fixes #2282.
    </change>
    <change name="Christopher Combs" date="2017-05-19">
      Changed pvl.DIFF of input for app tests nonOverlapRecalculate and nonOverlapRetryBoth to
      ignore file names. Allows test to pass when not using default data area. Fixes #4738.
    </change>
    <change name="Jesse Mapel" date="2020-09-01">
      Reported formula and variables now match the formula selected by the ADJUST
      argument. Fixes #3987.
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="FROMLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of cubes to equalize
        </brief>
        <description>
          A list of map projected cubes to equalize.  The Mapping groups
          must match in order to do the equalization.
        </description>
      </parameter>

      <parameter name="HOLDLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of filenames to hold
        </brief>
        <description>
          List of cubes that are to be held in the equalization.
          An additive and a multiplicative factor of 0 and 1 will be applied
          to all cubes that were held.  All cubes listed in this file must
          also be contained in FROMLIST.
        </description>
        <internalDefault>None</internalDefault>
        <filter>
          *.txt *.lis *.lst
        </filter>
      </parameter>

      <parameter name="TOLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of the equalized cubes to be created
        </brief>
        <description>
          This list of output files must contain a file name to correspond to
          each input file in the FROMLIST.  Input files will be associated
          with output files by index, so that the equalized product of the
          first file in the FROMLIST will be written to the name and location
          of the first file in the TOLIST, and so on.  Each output file will
          be written to the exact location with the exact name specified,
          unless the location and name happen to be identical to those of its
          corresponding input file, in which case an error will be thrown.  If
          this list is not specified, but the APPLY option is still selected,
          the output files will be placed in the directories of their input
          files, and named the same with the exception of an added ".equ"
          extension (e.g., "foobar.cub" becomes "foobar.equ.cub").
        </description>
        <internalDefault>Automatic</internalDefault>
      </parameter>

      <parameter name="OUTSTATS">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
          Output text file containing thorough equalization-related
          statistics
        </brief>
        <description>
          This file will contain the statistics of all of the overlapping areas
          in every band along with the computed equalizing factors
          (OFFSET and GAIN).  Specifying this output file is optional.
        </description>
        <internalDefault>None</internalDefault>
        <filter>
          *.txt *.pvl *.lis *.lst *.dat
        </filter>
      </parameter>

      <parameter name="INSTATS">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input text file containing thorough equalization-related
          statistics, used for applying correction
        </brief>
        <description>
          This file must contain the statistics of all the overlapping
          areas in every band along with the computed equalizing factors
          (OFFSET and GAIN) for every image in the FROMLIST.
        </description>
        <filter>
          *.txt *.pvl *.lis *.lst *.dat
        </filter>
      </parameter>
    </group>

    <group name="ProcessingOptions">
      <parameter name="PROCESS">
        <type>string</type>
        <brief>
          Calculate statistics, apply correction, or do both
        </brief>
        <description>
          This option allows the user to decide whether they want to do the
          equalization calculations and then go on to apply correction
          afterwards, apply correction to the images off previously
          gathered statistics, or do the calculations but not apply
          correction.  If the APPLY option is not selected, you must
          specify an OUTSTATS file.  If it is selected, you can still
          optionally specify an OUTSTATS file and the GAIN/OFFSET values
          will be applied to each input cube.  The names and locations of
          the output cubes are specified by the TOLIST file.
        </description>
        <default><item>BOTH</item></default>
        <list>
          <option value="BOTH">
            <brief>
              Calculate statistics and apply correction
            </brief>
            <description>
              This option will calculate image statistics and then apply
              corrections from the results.
            </description>
            <exclusions>
              <item>INSTATS</item>
            </exclusions>
          </option>
          <option value="RETRYBOTH">
            <brief>
              Recalculate statistics and apply correction
            </brief>
            <description>
              This option will load previously calculated image statistics, calculate statistics
              for any new images in FROMLIST and then apply corrections from the results (if
              the corrections can be determined).
            </description>
            <inclusions>
              <item>INSTATS</item>
            </inclusions>
            <exclusions>
              <item>ADJUST</item>
              <item>MINCOUNT</item>
              <item>WEIGHT</item>
              <item>PERCENT</item>
              <item>SOLVEMETHOD</item>
            </exclusions>
          </option>
          <option value="CALCULATE">
            <brief>
              Calculate statistics only
            </brief>
            <description>
              This option will calculate image statistics and write them to an
              output PVL file. Image corrections will not be applied.
            </description>
            <inclusions>
              <item>OUTSTATS</item>
            </inclusions>
            <exclusions>
              <item>TOLIST</item>
              <item>INSTATS</item>
            </exclusions>
          </option>
          <option value="RECALCULATE">
            <brief>
              Recalculate statistics using previously calculated statistics
            </brief>
            <description>
              This option will load previously calculated image statistics, calculate statistics
              for any new images in FROMLIST and then write them to an output PVL file. Image
              corrections will not be applied.
            </description>
            <inclusions>
              <item>INSTATS</item>
              <item>OUTSTATS</item>
            </inclusions>
            <exclusions>
              <item>TOLIST</item>
              <!--<item>HOLDLIST</item>-->
              <item>ADJUST</item>
              <item>MINCOUNT</item>
              <item>WEIGHT</item>
              <item>PERCENT</item>
              <item>SOLVEMETHOD</item>
            </exclusions>
          </option>
          <option value="APPLY">
            <brief>
              Apply correction only
            </brief>
            <description>
              This option will use previously generated statistics to
              apply correction to the images.
            </description>
            <inclusions>
              <item>INSTATS</item>
            </inclusions>
            <exclusions>
              <item>HOLDLIST</item>
              <item>OUTSTATS</item>
              <item>ADJUST</item>
              <item>MINCOUNT</item>
              <item>WEIGHT</item>
              <item>PERCENT</item>
              <item>SOLVEMETHOD</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="SOLVEMETHOD">
        <type>string</type>
        <brief>
          The solve method to be used to calculate the equalization statistics
        </brief>
        <description>
          This option allows the user to choose the solve method for the least-squares system.
          The default is SPARSE.
        </description>
        <default><item>SPARSE</item></default>
        <list>
          <option value="QRD">
            <brief>
              The QR Decomposition method is least accurate when no
              hold list is provided.
            </brief>
            <description>
              Solve the least-squares system using QR decomposition.

              <!-- The following is commented out since SVD is not currently
                 implemented:

              This solve method is faster than SVD and good to use when
              the user can provide a hold list. However, it is likely to
              result in invalid values when no hold list is provided.
              -->
               This method is likely to result in invalid values when no
               hold list is provided.
            </description>
          </option>

          <!-- The following is commented out since SVD is not currently
             implemented:

          <option value="SVD">
            <brief>
             The SV Decomposition method is more accurate than QRD when
             no hold list is provided.
            </brief>
            <description>
              Solve the least-squares system using SV (Singular value)
              decomposition. This method is more accurate than QRD when
              no hold list is provided, but slower to run. While this
              method will produce valid values more often than QRD when
              no hold list is provided, it does not always result in valid
              values.
            </description>
          </option>
          -->

          <option value="SPARSE">
            <brief>
              The SPARSE is the most accurate when no hold list is provided.
            </brief>
            <description>
              Solve the least-squares system using a sparse matrix
              formulation of the LU decomposition. This is the best method
              to use if no hold list is provided.
            </description>
          </option>
        </list>
      </parameter>
    </group>

    <group name="CalculationOptions">
      <parameter name="ADJUST">
        <type>string</type>
        <brief>
          Algorithm type used to adjust the pixel values
        </brief>
        <description>
          This option allows the user  to select the algorithm that will be
          used to adjust the pixel values.  The BRIGHTNESS mode will equalize
          using only an offset (the gain will be set to 1.0), and the
          CONTRAST mode will equalize using only a gain (the offset will
          be set to 0.0) but keeping the images around their current
          average. The GAIN option will equalize using only a gain and
          will not normalize the output values. The BOTH option will
          equalize using both an offset and a gain.  In most cases this
          option will give you the best results.
        </description>
        <default><item>BOTH</item></default>
        <list>
          <option value="BOTH">
            <brief>
              Adjust the brightness and contrast of the images.
            </brief>
            <description>
              This option will use an algorithm that equalizes
              both the brightness and contrast of the images.

              The equation this option uses is:
              <pre>
                output = (input - average(input)) * gain + offset + average(input)
              </pre>
            </description>
          </option>
          <option value="BRIGHTNESS">
            <brief>
              Adjust the brightness of the images using calculated offsets
            </brief>
            <description>
              This option will use an algorithm that only equalizes
              the brightness of the images by calculating the offset
              for each. This option should be used only if the
              variances/standard deviations of the images are close.

              The equation this option uses is:
              <pre>
                output = offset + average(input)
              </pre>
            </description>
          </option>
          <option value="CONTRAST">
            <brief>
              Adjust the contrast of the images only using calculated gains
            </brief>
            <description>
              This option will use an algorithm that only equalizes
              the contrast of the images by calculating the gain for
              each.  This option should only be used if the brightnesses
              of the images are already close.

              The equation this option uses is:
              <pre>
                output = input * gain + average(input) * gain
              </pre>
            </description>
          </option>
          <option value="GAIN">
            <brief>
              Adjust the contrast of the images without normalization
            </brief>
            <description>
              This option will use an algorithm that only equalizes
              the contrast of the images by calculating the gain for
              each. No offsets will be applied; the resulting image will
              only have a gain adjustment and no normalization. This option
              should only be used if the brightnesses of the images are already
              close.

              The equation this option uses is:
              <pre>
                output = input * gain
              </pre>
            </description>
          </option>
        </list>
      </parameter>

      <parameter name="MINCOUNT">
        <type>integer</type>
        <brief>
          Minimum number of points in overlapping area required to be used
          in the solution
        </brief>
        <description>
          If the number of points in the overlapping area meets or exceeds
          this value, the area will go into the least-squares solution as
          a "known."  Otherwise it will not be included in the
          calculations.
        </description>
        <default><item>1000</item></default>
      </parameter>

      <parameter name = "WEIGHT">
        <type>boolean</type>
        <brief>
          Whether or not overlaps should be weighted
        </brief>
        <description>
          This option allows the user to decide whether they want to
          weight the least squares solution based on how large the overlap
          area is, or if they want no weighting at all.  If this parameter
          is set to "true," then larger overlapping areas will have more
          of an impact on the corrective factors than smaller overlaps.
        </description>
        <default><item>FALSE</item></default>
      </parameter>

      <parameter name="PERCENT">
        <type>double</type>
        <minimum inclusive="no">0.0</minimum>
        <maximum inclusive="yes">100.0</maximum>
        <brief>
          Percentage of the lines to consider when gathering overall cube
          statistics and overlap statistics
        </brief>
        <description>
          The percentage of the lines in each area to consider in the
          process-by-line solutions for finding overall cube statistics
          and overlap statistics.  This value must be a decimal value
          between 0.0 (exclusive) and 100.0 (inclusive).
        </description>
        <default><item>100.0</item></default>
      </parameter>
    </group>
  </groups>

  <examples>
    <example>
      <brief>Calculate Statistics and Apply Correction</brief>
      <description>
        This example shows the most typical use of the equalizer application.
        The defaults are to perform both calculation and adjustment for both the
        gain and offset.
      </description>
      <terminalInterface>
      <commandLine> fromlist= FromList.lst holdlist= HoldList.lst
      </commandLine>
      <description>
        Specify a list of images to equalize along with a holding list that enables the necessary
        calculations to be performed.  All other options are at default
        values.
      </description>
      </terminalInterface>

      <guiInterfaces>
        <guiInterface>
          <image width="614" height="750" src="assets/images/bothGui.jpg">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to calculate the gain
              and offset and then to apply corrections.  Because the TOLIST
              parameter is set to its default value of "Automatic," each output
              image will be placed into the directory of its corresponding input
              image.  Also, because the OUTSTATS parameter is set to its default
              value of "None", a record of the calculations performed will only be
              written to the print file.
            </description>
            <thumbnail width="164" height="200" caption="Equalizer GUI" src="assets/thumbs/bothGui.jpg" />
          </image>
        </guiInterface>
      </guiInterfaces>

      <inputImages>
        <image src="assets/images/nonEqualizedMosaic.jpg" width="512" height="512">
          <brief> Mosaic of the input images for equalizer</brief>
          <description>
            This is a small section of the input images for the equalizer example mosaicked together.
          </description>
          <thumbnail caption=" Mosaic of unequalized input images" src="assets/thumbs/nonEqualizedMosaic.jpg" width="200" height="200"/>
          <parameterName>FROMLIST</parameterName>
        </image>
      </inputImages>

      <dataFiles>
        <dataFile path="assets/FromList.lst">
          <brief>Click here to see the list of input images to be equalized</brief>
          <description>
            This list contains the names of three files to calculate
            statistics upon, and then equalize.  The file names are
            separated by new lines.
          </description>
        </dataFile>
        <dataFile path="assets/HoldList.lst">
          <brief>Click here to see the list of input images to be held</brief>
          <description>
            This list contains the name of one file from the FROMLIST to
            be held during calculations.  When multiple images are held,
            their file names are likewise separated by new lines.
          </description>
        </dataFile>
      </dataFiles>

      <outputImages>
      <image src="assets/images/EqualizedMosaic.jpg" width="512" height="512">
        <brief> Mosaic of the output images for equalizer</brief>
        <description>
          This is a small section of the equalized output images mosaicked together.
        </description>
        <thumbnail caption="Mosaic showing results of the equalizer application." src="assets/thumbs/EqualizedMosaic.jpg" width="200" height="200"/>
        <parameterName>TOLIST</parameterName>
      </image>
      </outputImages>
    </example>

    <example>
      <brief>Calculate Statistics</brief>
      <description>
        This example shows how to use the equalizer application to calculate
        equalization statistics and write them to a file, without applying the
        corrections to the input images.
      </description>
      <terminalInterface>
        <commandLine> fromlist= FromList.lst holdlist=/HoldList.lst
          outstats= stats.pvl process= calculate
        </commandLine>
        <description>
          In addition to specifying a fromlist and a holdlist, we must also
          specify a location to write the output statistics PVL file, and set the
          process type to "calculate."  Since no output images will be created,
          we do not (and cannot), specify a tolist.  All other options are at
          default values.
        </description>
      </terminalInterface>

      <guiInterfaces>
        <guiInterface>
          <image width="614" height="750" src="assets/images/calcGui.jpg">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to calculate
              equalization statistics on a set of input images.
            </description>
            <thumbnail width="164" height="200" caption="Equalizer GUI" src="assets/thumbs/calcGui.jpg" />
          </image>
        </guiInterface>
      </guiInterfaces>

      <inputImages>
        <image src="assets/images/nonEqualizedMosaic.jpg" width="512" height="512">
          <brief> Mosaic of the input images for equalizer</brief>
          <description>
            This is a small section of the input images for the equalizer example mosaicked together.
          </description>
          <thumbnail caption=" Mosaic of unequalized input images." src="assets/thumbs/nonEqualizedMosaic.jpg" width="200" height="200"/>
          <parameterName>FROMLIST</parameterName>
        </image>
      </inputImages>

      <dataFiles>
        <dataFile path="assets/FromList.lst">
          <brief>Click here to see the list of images to calculate statistics upon</brief>
          <description>
            This list contains the names of three files to calculate
            statistics upon.  The file names are
            separated by new lines.
          </description>
        </dataFile>
        <dataFile path="assets/HoldList.lst">
          <brief>Click here to see the list of input images to be held</brief>
          <description>
            This list contains the name of one file from the FROMLIST to
            be held during calculations.  When multiple images are held,
            their file names are likewise separated by new lines.
          </description>
        </dataFile>
        <dataFile path="assets/stats.pvl">
          <brief>Click here to see the output text file containing statistics for equalizing</brief>
          <description>
            This PVL file contains thorough equalization-related statistics
            that can be used for applying correction to any or all images
            used to generate this file.
          </description>
        </dataFile>
      </dataFiles>
    </example>

    <example>
      <brief>Apply Correction</brief>
      <description>
        This example shows the use of the equalizer application for applying
        correction to a subset of the images used to produce a specified input
        statistics file.
      </description>
      <terminalInterface>
        <commandLine> fromlist= Input.lst tolist= Output.lst instats=
          stats.pvl process= apply
        </commandLine>
        <description>
          Specify a fromlist that is a sublist of the fromlist from Example 2.
          Because calculations have already been performed, no holdlist is
          specified, and since we want to place the output images in a specific
          location with specific names, a tolist is specified. Finally, we set
          the value of the instats parameter to be the output statistics file
          generated in Example 2, and set the process to "apply."  All other
          options are at default values.
        </description>
      </terminalInterface>

      <guiInterfaces>
        <guiInterface>
          <image width="614" height="750" src="assets/images/applyGui.jpg">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to apply correction to a
              subset of the images used to produce a specified input statistics
              file.
            </description>
            <thumbnail width="164" height="200" caption="Equalizer GUI"
                       src="assets/thumbs/applyGui.jpg" />
          </image>
        </guiInterface>
      </guiInterfaces>

      <dataFiles>
        <dataFile path="assets/Input.lst">
          <brief>Click here to see the list of images to be equalized</brief>
          <description>
            This list contains the names of two files to equalize.  Both
            file names appear in the FROMLIST file from the previous
            example, and both file names have calculated gain and offset
            coefficients calculated for them in the INSTATS file. Since we
            do not wish to create a new file for the held image, however,
            we chose not to include it in this new list.  The file names
            are separated by new lines.
          </description>
        </dataFile>
        <dataFile path="assets/Output.lst">
          <brief>Click here to see the list of images to write after equalization</brief>
          <description>
            This list contains the names of two files to be written as
            outputs from the equalization process.  The index of each file
            name corresponds to the index of a file from this example's
            FROMLIST file.  Here, the output images retain their original
            names, but are written to the current directory.
          </description>
        </dataFile>
        <dataFile path="assets/stats.pvl">
          <brief>Click here to see the input text file containing statistics for equalizing</brief>
          <description>
            This PVL file contains thorough equalization-related statistics for
            applying correction to any or all images used to generate this
            file.  In this example, two of the three files used to
            generate these statistics have been selected for equalization.
          </description>
        </dataFile>
      </dataFiles>

      <outputImages>
        <image src="assets/images/EqualizedMosaic.jpg" width="512" height="512">
          <brief> Mosaic of the output images for equalizer</brief>
          <description>
            This is a small section of the equalized output images and the
            held image from Example 2 mosaicked together.  Note that since we
            only chose to omit the held image from Example 2 when
            applying correction, that the results are the same as those in
            Example 1.
          </description>
          <thumbnail caption="Mosaic showing results of the equalizer application."
                     src="assets/thumbs/EqualizedMosaic.jpg" width="200" height="200"/>
          <parameterName>TOLIST</parameterName>
        </image>
      </outputImages>
    </example>

    <example>
      <brief>Recalculate Statistics</brief>
      <description>
        This example shows the use of the equalizer application for recalculating statistics after
        initially calculating statistics where some images do not have any overlaps.
      </description>
      <terminalInterface>
        <commandLine> fromlist=fixedList.lst
          instats=nonOverlapStats.pvl outstats=fixedStats.pvl process=recalculate
        </commandLine>
        <description>
          In addition to specifying a fromlist, we must also specify the previously calculated
          statistics PVL file (instats), specify a location to write the output statistics PVL file
          (outstats), and set the process type to "recalculate."  Since no output images will be
          created, we do not (and cannot), specify a tolist.  All other options are at
          default values.
        </description>
      </terminalInterface>

      <guiInterfaces>
        <guiInterface>
          <image width="610" height="990" src="assets/images/recalculateFirstGui.png">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to initially calculate statistics
              for a set of images with non-overlapping images.
            </description>
            <thumbnail width="123" height="200" caption="Equalizer GUI"
                       src="assets/thumbs/recalculateFirstGui.png" />
          </image>
        </guiInterface>
        <guiInterface>
          <image width ="610" height="990" src="assets/images/recalculateFixedGui.png">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to recalculate statistics
              after calculating statistics for a set of images with non-overlapping images.
            </description>
            <thumbnail width="123" height="200" caption="Equalizer GUI"
                       src="assets/thumbs/recalculateFixedGui.png" />
          </image>
        </guiInterface>
      </guiInterfaces>

      <inputImages>
        <image width="314" height="990" src="assets/images/nonOverlapMosaic.png">
          <brief>
            Mosaic of the input images for equalizer for initial calculation
          </brief>
          <description>
            This is a small section of the input images mosaicked together. Two of the images do not
            have any overlaps.
          </description>
          <thumbnail width="63" height="200" caption="Mosaic of unequalized input images where two
                     images do not have overlaps"
                     src="assets/thumbs/nonOverlapMosaic.png" />
        </image>
        <image width="314" height="990" src="assets/images/nonEqualizedMosaic2.png">
          <brief>
            Mosaic of the input images for equalizer for recalculation
          </brief>
          <description>
            This is a small section of the input images mosaicked together. The non-overlaps have
            been corrected.
          </description>
          <parameterName>FROMLIST</parameterName>
          <thumbnail width="63" height="200" caption="Mosaic of unequalized input images where all
                     images have valid overlaps"
                     src="assets/thumbs/nonEqualizedMosaic2.png" />
        </image>
      </inputImages>

      <dataFiles>
        <dataFile path="assets/fromlist.lis">
          <brief>
            Click here to see the list with non-overlapping images used to calculate statistics
          </brief>
          <description>
            This list contains the names of four files where two images do not have any overlaps.
          </description>
        </dataFile>
        <dataFile path="assets/fixedFromlist.lis">
          <brief>
            Click here to see the corrected list with all overlapping images used to recalculate
            statistics
          </brief>
          <description>
            This list contains the names of five files that all have valid overlaps. The third file,
            I50695002EDR.proj.reduced.cub, was added to fix the non-overlapping areas. (FROMLIST)
          </description>
        </dataFile>
        <dataFile path="assets/firstRunStats.pvl">
          <brief>
            Click here to see the output text file containing the statistics needed for
            recalculating
          </brief>
          <description>
            This PVL file contains equalization-related statistics where corrective factors have not
            been determined (since there were images without overlaps). This can be used to
            recalculate statistics for a corrected input image list. Overlap statistics will only be
            calculated for new overlaps. (INSTATS)
          </description>
        </dataFile>
        <dataFile path="assets/fixedStats.pvl">
          <brief>
            Click here to see the output text file containing the recalculated statistics to be
            used for equalizing
          </brief>
          <description>
            This PVL file contains equalization-related statistics that were recalculated from a
            previous run of equalizer. This can be used for applying
            correction to any or all images used to generate this file. (OUTSTATS)
          </description>
        </dataFile>
      </dataFiles>
    </example>

    <example>
      <brief>Recalculate Statistics and Apply Correction (RETRYBOTH)</brief>
      <description>
        This example shows the use of the equalizer application for recalculating statistics after
        initially trying to calculate and apply corrections on a non-overlapping data set.
      </description>
      <terminalInterface>
        <commandLine>
          fromlist=fixedFromlist.lis tolist=tolist.lis outstats=retryBothStats.pvl
          instats=nonOverlapStats.pvl process=retryboth
        </commandLine>
        <description>
          In addition to specifying a fromlist, we must also specify the previously calculated
          statistics (instats). We should also provide a location to write the output statistics
          PVL file (outstats) if we still have images without overlaps in our fromlist. We will
          also provide a list of output files (tolist).
        </description>
      </terminalInterface>

      <guiInterfaces>
        <guiInterface>
          <image width="610" height="990" src="assets/images/bothFailGui.png">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to calculate statistics and apply
              corrections (BOTH). This fails because some of the images do not have any overlaps
              (see the application log at the bottom of the screenshot).
            </description>
            <thumbnail width="123" height="200" caption="Equalizer GUI"
                       src="assets/thumbs/bothFailGui.png" />
          </image>
        </guiInterface>
        <guiInterface>
          <image width="610" height="990" src="assets/images/retryBothGui.png">
            <brief>
              Example GUI
            </brief>
            <description>
              Screenshot of the GUI with parameters set to recalculate statistics from previously
              calculated statistics and apply corrections (RETRYBOTH) to the input images.
            </description>
            <thumbnail width="123" height="200" caption="Equalizer GUI"
                       src="assets/thumbs/retryBothGui.png" />
          </image>
        </guiInterface>
      </guiInterfaces>

      <inputImages>
        <image width="314" height="990" src="assets/images/nonOverlapMosaic.png">
          <brief>
            Mosaic of the input images for equalizer for initial calculation
          </brief>
          <description>
            This is a small section of the input images mosaicked together. Two of the images do not
            have any overlaps.
          </description>
          <thumbnail width="63" height="200" caption="Mosaic of unequalized input images where two
                     images do not have overlaps"
                     src="assets/thumbs/nonOverlapMosaic.png" />
        </image>
        <image width="314" height="990" src="assets/images/nonEqualizedMosaic2.png">
          <brief>
            Mosaic of the input images for equalizer before corrections are applied
          </brief>
          <description>
            This is a small section of the input images mosaicked together. The non-overlaps have
            been corrected by adding I50695002EDR.proj.reduced.cub to the input list.
          </description>
          <parameterName>FROMLIST</parameterName>
          <thumbnail width="63" height="200" caption="Mosaic of unequalized input images where all
                     images have valid overlaps"
                     src="assets/thumbs/nonEqualizedMosaic2.png" />
        </image>
      </inputImages>

      <dataFiles>
        <dataFile path="assets/fixedFromlist.lis">
          <brief>
            Click here to see the corrected list with all overlapping images used to recalculate
            statistics
          </brief>
          <description>
            This list contains the names of five files that all have valid overlaps. The third file,
            I50695002EDR.proj.reduced.cub, was added to fix non-overlapping areas from a previous
            run. (FROMLIST)
          </description>
        </dataFile>
        <dataFile path="assets/tolist.lis">
          <brief>
            Click here to see the list of the output images to be created.
          </brief>
          <description>
            This list contains the names of the five equalized output files that will be created.
            (TOLIST)
          </description>
        </dataFile>
        <dataFile path="assets/firstRunStats.pvl">
          <brief>
            Click here to see the output text file containing the statistics needed for
            recalculating and then applying.
          </brief>
          <description>
            This PVL file contains equalization-related statistics where corrective factors have not been
            determined (since there were images without overlaps). This can be used to recalculate
            statistics for a corrected input image list. Overlap statistics will only be calculated
            for new overlaps. (INSTATS)
          </description>
        </dataFile>
        <dataFile path="assets/fixedStats.pvl">
          <brief>
            Click here to see the output text file containing the recalculated statistics.
          </brief>
          <description>
            This PVL file contains equalization-related statistics that were recalculated from a
            previous run of equalizer. (OUTSTATS)
          </description>
        </dataFile>
      </dataFiles>

      <outputImages>
        <image width="314" height="990" src="assets/images/equalizedMosaic2.png">
          <brief>
            Mosaic of the equalized output images
          </brief>
          <description>
            This is a small section of the equalized output images mosaicked together.
          </description>
          <parameterName>TOLIST</parameterName>
          <thumbnail width="63" height="200" caption="Mosaic of equalized output images"
                     src="assets/thumbs/equalizedMosaic2.png" />
        </image>
      </outputImages>
    </example>

  </examples>
</application>
