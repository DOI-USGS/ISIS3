<?xml version="1.0" encoding="UTF-8"?>

<application name="automos" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
  <brief>
    Create a mosaic using a list of map projected cubes
  </brief>

  <description>
    <html>
      <head>
        <style>
          .td {
            padding-left: 20px; width:70px; align:center;
          }
          .td1 {
            padding-left: 5px; width:70px; align:left;
          }
          .td2 {
            padding-top: 8px; padding-bottom: 8px; padding-left: 10px; padding-right: 10px; align:center;
          }
        </style>
      </head>
      <body>
          <p>
            This application mosaics together ISIS cubes from a user-entered text file containing the
            input cube filenames (FROMLIST). If the output file (MOSAIC) does not already exist, the
            program will create it from the input cubes. Otherwise, the input cubes will be placed
            into the existing mosaic cube.
          </p>
          <p>
            REQUIREMENT: The listed input cubes must be map projected (<def>Level2</def>).
            The input cubes are required to be projected to the EXACT SAME ProjectionName,
            PixelResolution (or MapScale), EquatorialRadius, PolarRadius, LatitudeType,
            LongitudeDirection, as well as specific map projection keywords (e.g., CenterLatitude,
            CenterLongitude).  If these map projection requirements are not met, an error will be
            encountered.
          </p>
          <b>Note</b>: The latitude and longitude range of the individual input cubes may vary.
          <p>
            By default, the input cubes are placed into the mosaic in the order in which they appear
            in the input list.   <b>Automos</b> automatically determines the size of the new output
            mosaic by examining the latitude and longitude range of each input cube. The user may
            override this by entering their own latitude/longitude extents for the output mosaic
            cube by setting the GRANGE parameter.
          </p>
          <p>
            <b>Integrity-check Parameters</b>:
            <p>
              MATCHBANDBIN = TRUE, the default is to require all the bandbin group and wavelength
              keywords of the input cube files exactly match the output mosaic.
            </p>
            <p>
              MATCHDEM = FALSE, the default does not check the SHAPEMODEL keyword of the input cube
              files and does not propagate what DEM Shapemodel that was used when the input files were
              projected.
            </p>
          </p>
          <p>
            The PRIORITY parameter will determine how each input cube is combined with the current
            output mosaic cube. The process involves replacing an output mosaic pixel (or not) with
            an input pixel at the same location. There are many user options and criteria that
            influence the pixel replacement. Use of the PRIORITY parameter with and without other
            options is explained in the tables and descriptions below.
          </p>
          <p>
            The TRACK feature creates a separate tracking cube in addition to the mosaic cube, and
            contains information for the source files of every pixel within the output mosaic.
            This cube will have the same base-name as the mosaic cube but will end in 
            "_tracking.cub". The tracking cube must always reside in the same directory as the
            mosaic cube to be properly accessed; this means that if the mosaic cube is copied or
            moved, then its associated tracking cube must be copied or moved to the same location.
            <b>The tracking cube will always be of type unsigned integer. Depending on the
            bit-type of the mosaic cube and/or the number of bands it contains, the tracking cube
            may be as much as four times the size of the mosaic cube itself.</b>
          </p>
          <p>
            The tracking cube can be used appropriately through the QVIEW-AdvancedTracking
            tool. As the user pans across the displayed mosaic, for every mosaic pixel location,
            QVIEW-AdvancedTracking will interactively report the index, the filename and the
            serial number of the input cube that was input to automos for that specific pixel
            location. Since the tracking cube is of bit-type unsigned integer, the DN values of
            0, 1 and 2 are reserved for NULL, LRS and LIS, respectively, so valid pixel DN values
            will begin at an offset of 3. In other words, a pixel of DN value 3 in the tracking
            cube means that this same pixel within the mosaic was taken from the first input
            image. The tracking cube cannot be used outside of the QVIEW-AdvancedTracking tool
            except as a visual representation of the source cubes for the different pixels. 
          </p>
          <p>
            The TRACK feature works with Priority options ONTOP and BENEATH for single band input
            cubes. It works for multiband cubes for PRIORITY=ONTOP only when the NULL,
            HIGHSATURATION and LOWSATURATION options are set to true. It also works for multiband
            cubes when PRIORITY=BAND. Furthermore, this feature is NOT supported when
            PRIORITY=AVERAGE.
          </p>
          <p>
            <b>Please Note: Prior to ISIS version 3.6.0, tracking for the various mosaicking apllications
              was being handled with an internal tracking band. Tracking is now being handled by an
              external tracking cube that contains the associated tracking information. This application
              can no longer add to mosaics of the old format. In order to continue to use these
              older mosaics with the updated mosaicking applications, you must first use the
              <def>trackextract</def> utility application to extract the tracking band and the associated
              tracking information into an external tracking cube.</b>
          </p>
          <p>
            <b>
              The following table describes how the program will determine the pixel value in the output
              mosaic for areas of image overlap.
            </b>
            <table cellspacing="0" border="1" >
              <tr><th>PRIORITY</th><th>RESULT</th></tr>
              <tr>
                <td>ONTOP</td>
                <td>
                  This is the default.  The current input image will be placed on top of the
                  output mosaic. Thus in any area of overlap, the Valid pixel values for the
                  current input image will appear in the output mosaic (it replaces the output mosaic
                  pixel).  Invalid input <def>Special Pixels</def>
                  (<def>NULL</def>,<def>HRS</def>,<def>HIS</def>,<def>LRS</def>,<def>LIS</def>) will NOT
                  replace an existing Valid output mosaic pixel unless the optional flags are set. Refer
                  to parameters HIGHSATURATION,LOWSATURATION, and NULL to override replacement of Valid
                  output mosaic pixels. 
                  <p>
                    <b>NOTE:</b> When using this priority with multi-band mosaics and with the TRACK
                    option set, all Special Pixel flags must be set as well. This is because the same
                    pixel within different bands of a single input image may hold both Valid and Special
                    Pixel values, and since our Tracking capabilities can only track one input image per
                    pixel (as it is a single band), it must accept the values for that particular pixel
                    from <b>every</b> band in the input image being placed on top.
                  </p>
                </td>
              </tr>
              <tr>
                <td>BENEATH</td>
                <td>
                  The current input image will be placed beneath the output mosaic. Thus in
                  any area of overlap, the Valid pixel values for the current mosaic will remain in
                  the output mosaic. The Valid pixel values for the current input image will only
                  replace the NULL pixels values in the output mosaic.  The HRS,HIS,LRS and LIS  special
                  pixel values in the output mosaic will NOT be replaced by the Valid input pixel.
                  The parameters HIGHSATURATION, LOWSATURATION and NULL are not supported under this
                  priority.
                </td>
              </tr>
              <tr>
                <td>BAND</td>
                <td>
                  The input image pixels will be placed in the output mosaic based on the "Lesser" or
                  "Greater" criteria of a priority band defined by the user.  Parameters that apply to
                  this priority feature are TYPE, NUMBER, KEYNAME, KEYVALUE, CRITERIA.
                </td>
              </tr>
              <tr>
                <td>AVERAGE</td>
                <td>
                  Overlapping Valid pixel values from the current input image and output mosaic will be
                  averaged for the new mosaic pixel values. A count-band is created with the output
                  mosaic file.  The count-band keeps track of the number of images involved in the
                  averaging of the input DN values for each pixel in the mosaic. Invalid input pixel
                  values will not be included in the average.  In the case where only one Valid pixel
                  exists between the input image pixels or the current mosaic pixel, the Valid pixel is
                  retained in the current output mosaic. Refer to parameters HIGHSATURATION,
                  LOWSATURATION, and NULL to override replacement of valid output mosaic pixels.
                  <p>
                    Choosing this priority will cause the mosaic to have twice the number of bands of
                    the input image. <b>Hence the file (byte) size of the mosaic is increased due to
                    the count-bands.</b>
                  </p>
                  <p>
                    <b>NOTE</b>: If an existing mosaic does not already contain a count-band, an error
                    will be encountered.
                  </p>
                </td>
              </tr>
            </table>
          </p>
          <p>
            Each of the following priority option tables indicates the resulting output pixel for a
            particular input pixel, given the selected special pixel options  (parameters
            HIGHSATURATION for HRS, HIS;  LOWSATURATION for LRS, LIS; and NULL) in each table row.

            <!--
              *******************************************************************************
              The graphics below are commented out because they are no longer correct.
              *******************************************************************************
            -->
            <!--
            <table cellspacing="0" cellpadding="1" border="0">
              <tr><th colspan="3" align="center"><u>  Priority OnTop</u></th></tr>
              <tr height="15"><th colspan="3"></th></tr>
              <tr><td class="td"><img src="assets/OnTop.jpg" alt="Priority OnTop" />  </td>
                  <td class="td"></td>
                  <td class="td">-->
                <table cellspacing="0" cellpadding="1" border="1">
                  <tr><th colspan="6" align="center">PRIORITY=ONTOP</th></tr>
                  <tr><th colspan="3" align="center">Options</th>
                      <th colspan="3" align="center">Images</th></tr>
                  <tr><th>High Saturation</th>
                      <th>Low Saturation</th>
                      <th>Null</th>
                      <th>Input Pixel Value Type</th>
                      <th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">High Saturation or Low Saturation or Valid</td>
                      <td class="td2">Mosaic</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Null</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                </table>
<!--              </td>
          </tr>
        </table>-->
        <br></br><br></br><br></br>
<!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u>Priority Beneath</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/Beneath.jpg" alt="Priority Beneath" />  </td>
              <td class="td" width="30"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="1" border="1">
                  <tr><th colspan="3" align="center">PRIORITY=BENEATH</th></tr>
                  <tr><th>Input Pixel Value Type</th>
                      <th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th>
                  </tr>
                  <tr><td class="td2">Special or Valid</td>
                      <td class="td2">Null</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">Special or Valid</td>
                      <td class="td2">High Saturation or Low Saturation or Valid</td>
                      <td class="td2">Mosaic</td>
                  </tr>
                </table>
              <!--</td>
          </tr>
        </table>-->

        <br></br><br></br><br></br>
<!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u> Priority Band</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/Band.jpg" alt="Priority Band" />  </td>
              <td class="td"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="0" border="1">
                  <tr><th colspan="6" align="center">PRIORITY=BAND</th></tr>
                  <tr><th colspan="3" align="center">Options</th><th colspan="3" align="center">
                    Images</th></tr>
                  <tr><th>High Saturation</th><th>Low Saturation</th><th>Null</th>
                      <th>Input Pixel Value Type</th><th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Criteria based</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">High Saturation or Low Saturation or Valid</td>
                      <td class="td2">Mosaic</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Null</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Criteria based</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td></tr>
                </table>
<!--              </td>
          </tr>
        </table>-->
        <br></br><br></br><br></br>
<!--
        <table cellspacing="0" cellpadding="1" border="0">
          <tr><th colspan="3" align="center"><u>Priority Average</u></th></tr>
          <tr height="15"><th colspan="3"></th></tr>
          <tr><td class="td"><img src="assets/Average.jpg" alt="Priority Average" /></td>
              <td class="td"></td>
              <td class="td">-->
                <table cellspacing="0" cellpadding="0" border="1">
                  <tr><th colspan="7" align="center">PRIORITY=AVERAGE</th></tr>
                  <tr><th colspan="3" align="center">Options</th><th colspan="4" align="center">
                    Images</th></tr>
                  <tr><th>High Saturation</th><th>Low Saturation</th><th>Null</th>
                      <th>Input Pixel Value Type</th><th>Current Mosaic Pixel Value Type</th>
                      <th>Output Mosaic Pixel Value Source</th>
                      <th>Count Band Pixel Value (# of images used for average)</th></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Average</td>
                      <td class="td2">increment count by 1</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td>
                      <td class="td2">count = 1</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special</td>
                      <td class="td2">Mosaic</td>
                      <td class="td2">count = 0</td></tr>
                  <tr><td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">False</td>
                      <td class="td2">Special</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Mosaic</td>
                      <td class="td2">count unchanged</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Special</td>
                      <td class="td2">Special or Valid</td>
                      <td class="td2">Input</td>
                      <td class="td2">count = 0</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Average</td>
                      <td class="td2">increment count by 1</td></tr>
                  <tr><td class="td2">True or False</td>
                      <td class="td2">True or False</td>
                      <td class="td2">True</td>
                      <td class="td2">Valid</td>
                      <td class="td2">Special</td>
                      <td class="td2">Input</td>
                      <td class="td2">count = 1</td></tr>
                </table>
                <!--</td></tr>
        </table>
     -->
      </p>
     </body>
    </html>
  </description>

  <category>
    <categoryItem>Mosaicking</categoryItem>
  </category>
  <seeAlso>
    <applications>
      <item>handmos</item>
      <item>mapmos</item>
    </applications>
  </seeAlso>

  <history>
    <change name="Jim Mathews" date="1992-01-01">
       Original version
    </change>
    <change name="Jeff Anderson" date="2004-02-26">
       Converted to Isis 3.0
    </change>
    <change name="Jeff Anderson" date="2004-07-28">
       Fixed bug caused by PVL refactor
    </change>
    <change name="Elizabeth Miller" date="2005-11-15">
      Added appTest, and fixed fromlist filter
    </change>
    <change name="Elizabeth Miller" date="2006-05-18">
      Depricated CubeProjection and ProjectionManager to ProjectionFactory
    </change>
    <change name="Elizabeth Miller" date="2006-08-03">
      Added user entered range and helper button
    </change>
    <change name="Elizabeth Miller" date="2006-09-01">
      Added the MATCHBANDBIN option that checks to make sure the input
      cube bandbin group matches the mosaic bandbin group.  The default is true.
    </change>
    <change name="Sean Crosby" date="2007-02-28">
      Added an exception that reports which input cube is causing a problem while mosaicking.
    </change>
    <change name="Sean Crosby" date="2007-03-06">
      Program no longer throws an exception when an input cube does not fit into the output mosaic.
      Instead, any files that are not included in the output are listed in the application log.
    </change>
    <change name="Sean Crosby" date="2007-03-20">
      Corrected bug in determining if an image fits into the output mosaic
    </change>
    <change name="Sean Crosby" date="2007-03-20">
      Fixed one of the application tests
    </change>
    <change name="Stuart Sides" date="2007-04-16">
      Fixed bug where input cubes where incorrectly not processed.
    </change>
    <change name="Steven Lambright" date="2008-05-13">
      This program now utilizes ProcessMapMosaic
    </change>
    <change name="Sharmila Prasad" date="2009-10-19">
      Added option "TRACK" to track pixel origin. Also added new priority called
      BAND where  specified input and mosaic band is compared for moving input
      to mosaic and to track the pixel origin. Added parameter "TYPE" to choose
      Band "NUMBER" or PVL "KEYWORD" from the BandBin group. If "BANDNUMBER" is
      chosen, then "NUMBER" is activated to enter band number. If "KEYWORD"
      is chosen then parameter "KEYNAME" and "KEYVALUE" are activated to enter
      key name and value from the BandBin group for band comparison. Band
      comparison "CRITERIA" are "LESSER" or "GREATER" than.  Also there are
      options "HIGHSATURATION", "LOWSATURATION" and "NULL", set to true will
      cause HS, LS and NULL input pixels to be copied to the mosaic regardless
      of the priorities and criteria. These options are not supported for  "BENEATH" priority.
      Track the origin for  multiband ONTOP priority if all the Special Pixel  flags are set.
      Store the Serial numbers of the input mosaic in the mosaic along with the  file name.
    </change>
    <change name="Sharmila Prasad" date="2011-01-19">
      Added "AVERAGE" priority where the mosaic will be average of valid input
      and mosaic pixels.
    </change>
    <change name="Sharmila Prasad" date="2011-01-24">
      Option to match DEM and also added new group "mosaic" to hold ShapeModel
      attributes for the mosaic
    </change>
    <change name="Sharmila Prasad" date="2011-09-07">
      Fixed bug #0000390 - tracking should continue even if the first image does
      not map onto the mosaic
    </change>
    <change name="Sharmila Prasad" date="2011-10-25">
      Fixed bug #0000464 - add optional list TOLIST containing all the files names
      that were added onto the mosaic.
    </change>
    <change name="Sharmila Prasad" date="2011-11-07">
      Updated documentation for Average priority. Fixes #553
    </change>
    <change name="Steven Lambright and Stuart Sides" date="2012-07-16">
      Fixed a border condition that caused only a few samples of an input image to be put into an
      output mosaic. The trigger for this condition was an input image that spanned more than the
      0-360 domain by just a sample or two on the 0 side (started at -0.000?? degrees longitude
      instead of zero). Other cases of spanning more than the world - or just crossing the seam -
      could have exhibited problems. Fixes #967.
    </change>
    <change name="Kimberly Oyama" date="2012-09-18">
      When an image is placed twice (usually because the longitude range is greater than 360 and
      encompasses the image more than once) only the last occurance was written to the log file.
      This has been fixed so that there is an entry in the log file for every image placement. Also
      modified mapmos and handmos to do the same. Fixes #976.
    </change>
    <change name="Debbie A. Cook" date="2012-12-10">
      Changed to use TProjection instead of Projection.  References #775
    </change>
    <change name="Debbie A. Cook" date="2013-04-03">
      Fixed type in specification of TYPE default in Band Priority group discovered when creating
      ringsautomos.  It was fixed here to make the applications consistent.  References #775
    </change>
    <change name="Jeannie Backer, Tammy Becker, and Kimberly Oyama" date="2014-04-07">
      Updated user documentation. Fixes #1617. Fixes #1620. References #1623. References #1550.
    </change>
    <change name="Cole Neubauer" date="2017-11-20">
      Added parameter checking to XML MAXLON and MAXLAT to check if they are greater than their
      minimum counterpart. Fixes #5148
    </change>
    <change name="Summer Stapleton" date="2018-08-13">
      Updated documentation to reflect new handling of tracking capabilities with an external
      tracking cube as well as clarify why special pixel flags are required when priority=ontop for
      multiband mosaics. References #2092
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="FROMLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of cubes to mosaic
        </brief>
        <description>
          A list of map projected cubes to mosaic (Level2).  Each cube in the list must have
          the same ProjectionName, PixelResolution (or MapScale), EquatorialRadius,
          PolarRadius, LatitudeType, LongitudeDirection and specific map projection keywords
          such as CenterLatitude and CenterLongitude.  This includes the output mosaic
          if it already exists.  The latitude and longitude extents of each input file may
          vary.
        </description>
        <filter>
          *.txt *.lis *.lst
        </filter>
      </parameter>

      <parameter name="MOSAIC">
        <type>cube</type>
        <fileMode>output</fileMode>
        <brief>
          Mosaic output cube
        </brief>
        <description>
          If this mosaic cube already exists, then the cubes listed in the input list will
          be combined with this cube. The Mapping Group keywords must match between the
          existing mosaic and the input cubes.  If this output file does not exist, it will
          be created from the input cubes in the cube list.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>

      <parameter name="TOLIST">
        <type>filename</type>
        <fileMode>output</fileMode>
        <internalDefault>None</internalDefault>
        <brief>
          List of images successfully added to the mosaic
        </brief>
        <description>
          This optional output list contains the names of the images that overlapped within the
          latitude and longitude boundaries of the output mosaic and were added.  <b>Automos</b>
          does not fail and will only display a warning for the input images that fall completely
          outside the boundaries of the mosaic, this list will not include these images.
        </description>
        <filter>
          *.lis
        </filter>
      </parameter>

      <parameter name="PRIORITY">
        <type>string</type>
        <default>
          <item>ONTOP</item>
        </default>
        <brief>The priority of output pixel placement</brief>
        <description>
          This parameter is used to determine the placement of the input pixels
          in the output mosaic.
        </description>

        <list>
          <option value="ONTOP">
            <brief> Input cube will be placed on top of the mosaic </brief>
            <description>
              A Valid input pixel will replace an output mosaic pixel.
              Special input pixels will be copied onto the mosaic only if the
              special pixel flags are set. Refer to HIGHSATURATION, LOWSATURATION and
              NULL for special pixel values.
            </description>
            <exclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
              <item>NUMBER</item>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
           </exclusions>
          </option>
          <option value="BENEATH">
            <brief>Input cube will be placed beneath the mosaic </brief>
            <description>
              If the output mosaic pixel is NULL, then the Valid input pixel
              will be written onto the mosaic, otherwise it remains unchanged.
            </description>
            <exclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
              <item>NUMBER</item>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
              <item>HIGHSATURATION</item>
              <item>LOWSATURATION</item>
              <item>NULL</item>
           </exclusions>
            <inclusions>
              <item>TRACK </item>
             </inclusions>
          </option>
           <option value="BAND">
            <brief>
              Input pixel is placed on top of the mosaic based on the criteria in the selected band
            </brief>
            <description>
              If the Input and Mosaic pixel of the priority band, specified by NUMBER or KEYNAME
              and KEYVALUE, are valid, a less than or greater than comparison is done. Depending on
              the CRITERIA selected, the lower or higher of the two pixels is placed on top
              (i.e., replaces the mosaic pixel). This applies to all the corresponding Valid band
              pixels. Special pixels in the corresponding bands will not replace the output mosaic
              pixel unless the HIGHSATURATION, LOWSATURATION and NULL flags are set to TRUE.  Refer
              to parameters HIGHSATURATION, LOWSATURATION, and NULL. This means, if the results
              of the priority band comparison shows that the input pixel should be on top, but the
              input pixel on any other band is NULL, without the NULL=TRUE, the output mosaic pixel
              will remain unchanged for that band.
            </description>
             <inclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
           </inclusions>
          </option>
          <option value="AVERAGE">
            <brief>Average of valid input and the mosaic pixels</brief>
            <description>
              If the Input and Mosaic pixels are valid then the output will be the average of the
              2 values. A count-band is created in the output mosaic and holds the count of images
              corresponding to the output Average DN value of each pixel in the mosaic.
               <b>NOTE</b>: If an existing mosaic does not already contain a count-band, an error
               will be encountered with Priority=AVERAGE.
            </description>
            <exclusions>
              <item>TYPE</item>
              <item>CRITERIA</item>
              <item>NUMBER</item>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
              <item>TRACK </item>
           </exclusions>
          </option>
        </list>
      </parameter>
    </group>

    <group name="Band Priority">
      <parameter name="TYPE">
        <type>string</type>
        <default>
          <item>
            BANDNUMBER
          </item>
        </default>
        <brief>Indicate the Band Name or Number to be used for comparison</brief>
        <description>
          This option allows you to select the method to specify the band
          to use for the pixel comparison.
        </description>
        <list>
          <option value="BANDNUMBER">
            <brief>Band Number </brief>
            <description>
              You can enter the band number to use in the pixel comparison.
              Refer to the parameter NUMBER.
            </description>
            <inclusions>
              <item>NUMBER</item>
              </inclusions>
            <exclusions>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
            </exclusions>
          </option>
          <option value="KEYWORD">
            <brief>Keyword NAME in "BandBin" Group</brief>
            <description>
              You can select the Keyword name and value that correspond to the priority band
              Refer to the parameters KEYNAME and KEYVALUE.
            </description>
           <exclusions>
              <item>NUMBER</item>
              </exclusions>
            <inclusions>
              <item>KEYNAME</item>
              <item>KEYVALUE</item>
            </inclusions>
          </option>
        </list>
      </parameter>

      <parameter name="NUMBER">
        <type>integer</type>
        <default><item>1</item></default>
        <brief>Enter the Band Number</brief>
        <description>
          This is the band number selected for the pixel comparison
        </description>
      </parameter>

      <parameter name="KEYNAME">
        <type>string</type>
        <default><item>OriginalBand</item></default>
        <brief>Enter the Keyword NAME as it appears in the BandBin Group</brief>
        <description>
          The keyword values can be found on the labels of the input files under
          the "BandBin" Group. For instance, KEYNAME=NAME where the KEYVALUE
          can then be set to "Phase Angle", "Emission Angle", "Incidence Angle",
          "Pixel Resolution".
        </description>
      </parameter>

      <parameter name="KEYVALUE">
        <type>string</type>
        <default><item>1</item></default>
        <brief>Enter the keyword value associated with the "KEYNAME"</brief>
        <description>
          The keyword values can be found on the labels of the input files under
          the "BandBin" Group. For instance, KEYNAME=NAME where the KEYVALUE
          can then be set to "Phase Angle", "Emission Angle", "Incidence Angle",
          "Pixel Resolution".  Refer to the <def>phocube</def> application that will
          create these 'Named' Bands.
          </description>
      </parameter>

      <parameter name="CRITERIA">
        <type>string</type>
         <default><item>LESSER</item></default>
        <brief>The criteria (Lesser or Greater) of pixel placement in a priority band </brief>
        <description>
          Select which type of comparison to perform on the priority band pixels.
          The choice is whether the lesser or greater value between the current input
          priority band pixel or mosaic priority band pixel will replace or retain the output
          mosaic pixel.  The results of this criteria will apply to all corresponding bands
          in the output mosaic.  The special pixel values in the remaining bands will be
          replaced by valid pixels of the corresponding mosaic bands.  Refer to the
          parameters HIGHSATURATION, LOWSATURATION and NULL to override this and propagate
          input special pixel values to all bands in the output mosaic.
        </description>

        <list>
        <option value="LESSER">
          <brief>The lower DN value of the input priority band will replace the mosaic pixel
            </brief>
            <description>
              If the DN value of a pixel in the priority band of the input cube
              is lesser than the corresponding pixel in the mosaic priority band,
              then the output pixel of the mosaic will be replaced by the input
              cube pixel. This will apply to all bands at this pixel location.
            </description>
          </option>
          <option value="GREATER">
           <brief>The greater DN value of the input priority band will replace the mosaic pixel
            </brief>
            <description>
              If the DN value of a pixel in the priority band of the input cube
              is greater than the corresponding pixel in the mosaic priority band,
              then the output pixel of the mosaic will be retained on NOT be
              replaced by the input cube pixel. This will apply to all bands at
              this pixel location.
            </description>
        </option>
      </list>
      </parameter>
    </group>

    <group name="Ground Range">
      <parameter name="GRANGE">
      <type>string</type>
      <default><item>AUTO</item></default>
      <brief>Ground Range Options</brief>
      <description>
        AUTO is the default for this parameter. By default the ground range is
        calculated automatically based on the list of input cubes.  The user can
        override this default. If the USER option is selected, values must be
        entered for the MINLAT, MAXLAT, MINLON, and MAXLON parameters.
      </description>
      <list>
        <option value="AUTO">
          <brief>Automatically Calculate Range</brief>
          <description>
            The program will automatically calculate the ground range for the
            mosaic by examining that latitude and longitude range of all the
            cubes contained in the list passed to FROMLIST.  This is the
            default option.
          </description>
          <exclusions>
            <item>MINLAT</item>
            <item>MAXLAT</item>
            <item>MINLON</item>
            <item>MAXLON</item>
          </exclusions>
        </option>
        <option value="USER">
          <brief>User Entered Range</brief>
          <description>
            The program will apply the ground range values you entered for
            the mosaic.
          </description>
          <inclusions>
            <item>MINLAT</item>
            <item>MAXLAT</item>
            <item>MINLON</item>
            <item>MAXLON</item>
          </inclusions>
        </option>
      </list>
      </parameter>
      <parameter name="MINLAT">
        <type>double</type>
        <brief>Minimum Latitude</brief>
        <description>
          The minimum latitude value boundary extent for the output mosaic.
        </description>
        <helpers>
          <helper name="H1">
            <function>helperButtonCalcRange</function>
            <brief>Calculate Ranges using FROMLIST</brief>
            <description>
              This button will calculate the latitude and longitude range using the files in the
              FROMLIST.
            </description>
	    <icon>$ISISROOT/appdata/images/icons/exec.png</icon>
          </helper>
        </helpers>
      </parameter>
      <parameter name="MAXLAT">
        <type>double</type>
        <brief>Maximum Latitude</brief>
        <description>
          The maximum latitude value boundary extent for the output mosaic.
        </description>
        <greaterThan>
            <item>MINLAT</item>
        </greaterThan>
      </parameter>
      <parameter name="MINLON">
        <type>double</type>
        <brief>Minimum Longitude</brief>
        <description>
          The minimum longitude value boundary extent for the output mosaic.
        </description>
      </parameter>
      <parameter name="MAXLON">
        <type>double</type>
        <brief>Maximum Longitude</brief>
        <description>
          The maximum longitude value boundary extent for the output mosaic.
        </description>
        <greaterThan>
            <item>MINLON</item>
        </greaterThan>
      </parameter>
    </group>

    <group name="Options">
      <parameter name="TRACK">
          <type>boolean</type>
         <default><item>FALSE</item></default>
          <brief>
            Track the filenames for each mosaic pixel
          </brief>
          <description>
            <p>
              The Track feature creates a separate tracking cube containing the index values for
              the source of every pixel in the output mosaic. The tracking cube can only be used
              appropriately through the  QVIEW-AdvancedTracking tool. As the user pans across the
              displayed mosaic, for every mosaic pixel location QVIEW-AdvancedTracking will
              interactively report the filename, the serial number and the index of the input cube
              that was input to automos for that specific pixel location. The tracking cube cannot
              be used outside the QVIEW-AdvancedTracking tool except as a visual representation of
              the source cubes for the different pixels. TRACK must be set to TRUE at the time of
              mosaic creation only and cannot be turned on after the mosaic is created. When a
              mosaic is created with TRACK=TRUE, all subsequent runs will default to TRACK=TRUE.
              When a mosaic is created with TRACK=FALSE, an error will be encountered if subsequent
              runs have TRACK=TRUE. <b>The tracking cube will always be of type unsigned integer.
              Depending on the bit-type of the mosaic cube and/or the number of bands it contains,
              the tracking cube may be as much as four times the size of the mosaic cube itself.</b>
            </p>
            <p>
              WARNING:
              If Tracking is turned on in a mosaic, any subsequent applications that modify DN
              values, such as the application<def>reduce</def>, will corrupt the DN values in the
              tracking cube.
            </p>
          </description>
        </parameter>
      <parameter name="MATCHBANDBIN">
        <type>boolean</type>
        <brief>Input and mosaic BandBin Groups must match</brief>
        <description>
          This option set to TRUE causes the application to fail if the BandBin group keywords
          are not identical for all input cubes and the output mosaic cube.  The default
          for this parameter is TRUE in order to preserve integrity of a multi-band
          (multi-wavelength) mosaic product.  The order of band wavelengths of the input
          cubes must match each other and the mosaic. If MATCHBANDIN is set to FALSE,
          then the BandBin Group keywords of the input images do not have to match the mosaic
          BandBin Group labels.  <b>Note:</b> The output mosaic BandBin Group and number
          of output bands is established with the first input file into the mosaic.
        </description>
        <default><item>TRUE</item></default>
      </parameter>
      <parameter name="MATCHDEM">
        <type>boolean</type>
        <brief>Enforce DEM Match</brief>
        <description>
          The default is FALSE.  If set to TRUE, this application will create a
          Mosaic Group in the keyword labels of the new output mosaic cube including
          a ShapeModel keyword.  The output mosaic is created with the first input
          cube listed in the FROMLIST file, the ShapeModel keyword and its value
          will be propagated to the Mosaic Group of the output mosaic cube file.
          Subsequently, the ShapeModel keyword value of the remaining input cubes will
          be checked against the ShapeModel value in the mosaic cube.   This application
          will fail if the ShapeModel keywords don't match.

          The ShapeModel keyword can be found in the Kernels group of the individual
          input <def>Level2</def> cubes. This keyword is established in <b>spiceinit</b> when a DEM
          radius file is chosen for the image surface reference and orthorectification
          in <b>cam2map</b>-Level2.
        </description>
        <default><item>FALSE</item></default>
      </parameter>
      <parameter name="HIGHSATURATION">
        <type>boolean</type>
        <default><item> FALSE</item></default>
        <brief>Force input High (Instrument and Representation) values </brief>
        <description>
          This option causes an input High Saturation special pixel value
          (both Instrument and Representation) to replace the output mosaic pixel
          irrespective of the priority set or the original value of the mosaic pixel.
        </description>
      </parameter>
      <parameter name="LOWSATURATION">
        <type>boolean</type>
        <default><item> FALSE</item></default>
        <brief>Force input Low (Instrument and Representation) values</brief>
        <description>
          This option causes an input Low Saturation special pixel value
          (both Instrument and Representation) to replace the output mosaic pixel
          regardless of the priority set or the original value of the mosaic pixel.
        </description>
      </parameter>
      <parameter name="NULL">
        <type>boolean</type>
        <default><item> FALSE</item></default>
        <brief>Force input NULL values</brief>
        <description>
          This option causes input NULL pixel values to replace the output mosaic pixel
          irrespective of the priority set or the original value of the mosaic pixel.
        </description>
      </parameter>
    </group>
  </groups>
  <examples>
    <example>
      <brief>
        Example of automos run with two multiband cubes and band priority.
      </brief>

      <description>
        This example shows what happens to the output mosaic when PRIORITY=BAND. Special pixels
        will not be propagated to the output mosaic if the flags are not set, regardless of the
        comparison of the priority band. Also, special pixels are not used in the lesser or
        greater comparison. Special pixels in the mosaic will strictly be replaced by valid input
        pixels and special pixels in the input will not replace valid mosaic pixels, unless the
        special pixel flags are set.

        <p>
          The input list has two two-band cubes. Each band has had special pixels introduced to
          clarify what happens during the mosaic process.
        </p>
        <p>
          The output mosaic shows the result of the second input image being mosaicked with the
          first input image. You can see in band one that none of the special pixels were retained
          because none of the special pixel flags were set. In other words, regardless of whether
          there was a valid comparison at that pixel of the priority band, all other bands will
          try to retain valid data.
        </p>
        <p>
          In band two, you can still see where the special pixels were in the second input image.
          The second image would have been "on top" because in band two, the pixels are less than
          those of the mosaic. However, the valid data in the mosaic was disregarded because the
          special pixel flags were not set. You cannot see the special pixels from the first image
          because the valid pixels from the second image were kept instead.
        </p>
      </description>

      <terminalInterface>
        <commandLine>
          fromlist=example.lis mosaic=exampleMosaic.cub priority=band number=2
        </commandLine>
        <description>
          An example of how to run this program from the command line.
        </description>
      </terminalInterface>

      <guiInterfaces>
        <guiInterface>
          <image width="535" height="550" src="assets/automosGui.jpg">
          <brief>
            Example GUI
          </brief>
            <description>
              An example of how to run this program using the GUI.
            </description>
            <thumbnail width="195" height="200" src="assets/automosGui.jpg"
                       caption="Example of GUI"/>
          </image>
        </guiInterface>
      </guiInterfaces>

      <inputImages>
        <image src="assets/automosInput1.jpg" width="1000" height="500">
          <brief> First image in list</brief>
          <description>
            This is a side-by-side display of the two bands of the first input cube. You can see
            the colorful special pixels in each band.
          </description>
          <thumbnail caption="Input image 1" src="assets/automosInput1.jpg"
                     width="400" height="200"/>
          <parameterName>FROMLIST</parameterName>
        </image>
        <image src="assets/automosInput2.jpg" width="1000" height="500">
          <brief> Input image for mask</brief>
          <description>
            This is a side-by-side display of the two bands of the second input cube. You can see
            the colorful special pixels in each band.
          </description>
          <thumbnail caption="Input image 2" src="assets/automosInput2.jpg"
                     width="400" height="200"/>
          <parameterName>FROMLIST</parameterName>
        </image>
      </inputImages>

      <outputImages>
        <image src="assets/automosMosaic.jpg" width="1000" height="500">
          <brief> Output mosaic</brief>
          <description>
            This is a side-by-side display of the two bands of the resulting mosaic.
          </description>
          <thumbnail caption="Output image of resulting mosaic." src="assets/automosMosaic.jpg"
                     width="400" height="200"/>
          <parameterName>MOSAIC</parameterName>
        </image>
      </outputImages>
    </example>
  </examples>
</application>
