# Checks the MD5 checksum (CHECKSUM=yes) functionality.
# Note that the md5sum.txt is generated by md5sum and should match labels.pvl's CHECKSUM value.
APPNAME = isis2pds

include $(ISISROOT)/make/isismake.tsts

commands:
	$(APPNAME) from=$(INPUT)/ab102401.cub \
	  to=$(OUTPUT)/ab102401.img \
	  bittype=u16bit \
	  checksum=yes \
	  > /dev/null;
	catlab from=$(OUTPUT)/ab102401.img to=$(OUTPUT)/labels.pvl > /dev/null;
	pds2isis from=$(OUTPUT)/ab102401.img to=$(OUTPUT)/ab102401.cub > /dev/null;
	dd if=$(OUTPUT)/ab102401.img \
	bs=`getkey from=$(OUTPUT)/ab102401.img keyword=^IMAGE` \
	count=1 >& $(OUTPUT)/TEMP.txt > $(OUTPUT)/labelsEOL.txt; 
	# do a cubeit to extract only data and perform md5sum on it to compare
	$(LS) -1 $(INPUT)/*.cub > $(OUTPUT)/cube.lis;
	cubeit from=$(OUTPUT)/cube.lis \
	  to=$(OUTPUT)/cubeit.cub+Lsb+BandSequential+Detached \
	  > /dev/null;
	#md5sum $(OUTPUT)/cubeit.cub > $(OUTPUT)/md5sum.txt;
	$(RM) $(OUTPUT)/cube.lis > /dev/null;
	$(RM) $(OUTPUT)/cubeit* > /dev/null;
	$(RM) $(OUTPUT)/ab102401.img > /dev/null;
	$(RM) $(OUTPUT)/TEMP.txt > /dev/null;
