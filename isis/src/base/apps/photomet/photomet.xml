<?xml version="1.0" encoding="UTF-8"?>

<application name="photomet" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>
    Perform photometric corrections on a cube
  </brief>

 <description>
    <p>
    This program performs photometric correction on image pixels acquired under
    different illumination and viewing geometries by adjusting the brightness
    and contrast such that the resulting image appears as if obtained under uniform
    conditions.  The photometric correction is applied to each pixel by computing
    a photometric model based on local photometric angles and a set of parameters
    that defines the model.  Currently, no default values are assigned for any
    parameter names in the ISIS version of <i>photomet</i>.
    </p>
    <p>
    Photometric angles can be computed from the following:
    <ul>
    <li>
      <def>SPICE</def> information stored in the image labels
    </li>
    <li>
      User-entered values for parameter names
    </li>
    <li>
      <def>Incidence angle</def>, <def>emission angle</def>, and
      <def>phase angle</def> backplanes
    </li>
    <li>
       Photometric angle files generated by the user
    </li>
    </ul>
    This program sets all pixels that have an incidence angle and/or emission angle
    greater than or equal to 90 degrees to <def>NULL</def> pixel values, regardless of the
    photometric angles resulting from using a topographic model.
    </p>
    <p>
    The user must select a photometric model and a normalization model, with the
    option of adding an atmospheric model.  Each of these models has a set of
    parameters that specifies its operation, which the user must provide.  The
    different models can be mixed and matched to produce variations of the
    photometric correction.
    <ul>
    <li>
      You may enter the desired parameters by using the program GUI, which is
      recommended
    </li>
    <li>
      A PVL file containing the photometric parmeters may be used if you opt
      to use the "frompvl" parameter
    </li>
    <li>
      Within the GUI you may select a <def>PVL</def> file, and in addition, select the
      "frompvl" drop-down menu and photomet will load the values from the PVL
      file into the appropriate parameter names in the GUI for you.
      Note, if more than one model type for phtname, atmname, or normname parameters
      are in the PVL file, then the parameter values for the first model type
      encountered by the program are loaded.  Review the parameter values to make
      sure the correct options are selected and have correct values before executing
      the program.
    </li>
    <li>
      Values also can be entered manually at the command line
    </li>
    </ul>
    Note: If any parameter names are entered into the GUI after specifying
    "frompvl", the new values entered into the GUI will take precedence
    over the values entered in the PVL file.
    </p>
    <p>
    There are three aspects of a photometric correction that should be
    considered when running the photomet program:
    </p>
    <ol>
      <li>
       The surface photometric function model type that describes the planetary
       surface.  Any one of the surface photometric functions can be used in
       combination with any of the normalization type models and optionally an
       atmospheric photometric model.
      </li>
      <li>
       The atmospheric photometric function model type used when atmospheric
       scattering is present. The models that end with "1" use a first order
       scattering approximation, and those that end with "2" use a second order
       approximation; the second order has slower processing time because it
       uses more iterations and a quadratic equation versus fewer iterations and
       a linear equation used in the first order approximation.
      </li>
      <li>
       The type of normalization applied to the image to equalize the albedo
        or the topographic contrasts, or a combination of the two.  One of
       the available modes must be selected.
      </li>
    </ol>
    <p>
    The intent of topographic normalization is to correct for the variation in
    incidence, emission, and phase angles within and between images.  Topographic
    normalization involves both a multiplicative correction that adjusts the
    contrast for a unit slope to reference conditions, and an additive correction
    to keep the average brightness uniform.
    </p>
    <p>
    In practice, the <def>albedo</def> may be nonuniform, so a multistep process is used:
    <ol>
    <li>
    Photomet is run in albedo mode, which decreases the brightness variations across
    the individual image and removes any additive atmospheric contribution.
    </li>
    <li>
    The output image in step 1 is divided by a low-pass-filtered version of itself,
    which removes the albedo variations if they have broader spatial scales than
    the topographic shading as is often the case.
    </li>
    <li>
    And finally, photomet is run again in topography mode on the output image from
    step 2, which reverses the albedo normalization of the first pass and then applies
    the topographic normalization.
    </li>
    </ol>
    In the absence of an atmosphere, the "albedo mode" is very simple: the image
    is divided by the photometric model evaluated at the actual angles and then
    multiplied by the model at a reference geometry.  If an atmosphere is present,
    the additive component of the atmospheric scattering is subtracted at the real
    conditions before a multiplicative step, and added back as calculated for the
    standard conditions at the end.  The "mixed mode" of normalization is used for
    images that span very large ranges of <def link="Incidence Angle">incidence
    angles</def>. In the mixed mode, the
    albedo correction is applied at small incidence angles where albedo variations
    dominate topographic shading, and the topographic normalization is performed
    at large incidence angles where the reverse is true.  A user-specified
    parameter "incmat" controls the incidence angle at which a smooth transition
    from one type of normalization to the other takes place.
    </p>
    <p>
    The normalization models that use an atmospheric correction are albedoatm, shadeatm,
    and topoatm. If using the GUI interface photomet will automatically exclude
    all atmospheric models for normaliztion types that do not require an atmospheric
    correction.<br/>

    </p>
    <p>
    <b>Question</b>: What happens if the normalization model I chose does not perform
    an atmospheric correction although I have an atmospheric model defined in my PVL
    file?
    <br />
    <b>Answer</b>: If you have chosen a normalization model that does not
    perform atmospheric correction, then the image is normalized without applying
    the atmospheric correction.
    </p>

    <p>
      <strong>New Developments</strong>
    </p>
    <p>
    A new parameter name "chngpar" was added to photomet to allow the user to enter
    a string consisting of parameter names and values outside of the PVL files. This
    string replaces any parameter already defined.  This is useful when one or two
    parameter values change for each image but all the other parameter values remain
    the same.
    </p>
    <p>
    The parameter name "ZEROB0STANDARD" was shortened to "ZEROB0ST," but the longer
    name will still work for backward compatibility.  The default is to get the
    user setting for "ZEROB0ST" from the PVL file.  If no PVL file exists and the
    user does not specify a "FALSE" or "TRUE" option, the program will automatically
    default to "TRUE" to follow the default setting in previous photomet versions.

    PLEASE NOTE: This change was actually not added because the ability to support aliases
    (or deprecated) values has not been fully implemented in ISIS. As a result, you
    must use the full ZEROB0STANDARD parameter name.
    </p>
    <p>
    The parameter name "INCMAT" is no longer required when the "ALBEDO" normalization
    model is selected.  The parameter name will still appear in the GUI for backward
    compatibility, but does not need to be defined by the user in the GUI or on the
    command line.
    </p>
    <p>
    A set of photomet PVL templates for Mars and other planetary bodies
    developed in ISIS2 are now available in $ISISROOT/appdata/templates/photometry/
    directory.  There are also additional examples of PVL files for different
    photometric models under "Example PVL files," later in this document.
    </p>
    <p>
    Note: The NoNormalization model has been removed because it duplicated
    the functionality of the shade model.  Use shade with incref=0 and
    albedo=1.0 instead.
    </p>
    <p>
    The program <i>photemplate</i> can be used to set up the PVL file
    containing the selected options for <i>photomet</i>.
    </p>
    <p>
    The tables below show the models and their related parameter requirements
    along with the ISIS2 default values.  The ISIS2 default values are only meant
    to serve as possible initial values to test backward compatibility since there
    are no default values defined in ISIS.
    </p>

<small>
<br/>
<br/>
<hr>
<br/>
<h2><b><center>SURFACE PHOTOMETRIC FUNCTION MODELS</center></b></h2>
<br/>

</hr>
<table border="1">
<caption><b>Available photometric function models and required parameter names</b></caption>
<tr>
<th>Name</th>
<th>Required parameter names</th>
</tr>
<tr>
<td> Hapkehen </td>
<td>B0, hg1, hg2, hh, theta, wh</td>
</tr>
<tr>
<td> Hapkeleg </td>
<td>Theta, wh, bh, ch, hh, b0, zerob0st</td>
</tr>  <tr>
<td> Lambert </td>
<td>None</td>
</tr>
<tr>
<td> LommelSeeliger </td>
<td>None</td>
</tr>
<tr>
<td> LunarLambert </td>
<td>L</td>
</tr>
<tr>
<td> LunarLambertEmpirical </td>
<td>Phaselist, llist, phasecurvelist</td>
</tr>
<tr>
<td> LunarLambertMcEwen </td>
<td>None</td>
</tr>
<tr>
<td> Minnaert </td>
<td>K</td>
</tr>
<tr>
<td> MinnaertEmpirical </td>
<td>Phaselist, klist, phasecurvelist</td>
</tr>
</table>
<br/>
<br/>

<table border="1">
<caption><b>Photometric model parameter names and settings</b></caption>
<tr>
<th>Name</th>
<th>Description</th>
<th>ISIS2 default</th>
<th>Valid range</th>
</tr>
<tr>
<td>B0</td>
<td>Hapke opposition surge component</td>
<td>0.0</td>
<td>0 &lt;= value</td>
</tr>

<tr>
<td>Bh</td>
<td>Hapke Legendre coefficient for single particle phase function</td>
<td>0.0</td>
<td>-1 &lt;= value &lt;= 1</td>
</tr>

<tr>
<td>Ch</td>
<td>Hapke Legendre coefficient for single particle phase function</td>
<td>0.0</td>
<td>-1 &lt;= value &lt;= 1</td>
</tr>
<tr>
<td>Hg1</td>
<td>Hapke Henyey Greenstein coefficient for single particle phase function</td>
<td>0.0</td>
<td>0 &lt;= value &lt;= 1</td>
</tr>
<tr>
<td>Hg2</td>
<td>Hapke Henyey Greenstein coefficient for single particle phase function</td>
<td>0.0</td>
<td>0 &lt;= value &lt;= 1</td>
</tr>
<tr>
<td>Hh</td>
<td>Hapke opposition surge component</td>
<td>0.0</td>
<td>0 &lt;= value</td>
</tr>
<tr>
<td>K</td>
<td>Minnaert function exponent</td>
<td>1.0</td>
<td>0 &lt;= value</td>
</tr>
<tr>
<td>L</td>
<td>Lunar-Lambert function weight</td>
<td>1.0</td>
<td>No limit</td>
</tr>
<tr>
<td>Theta</td>
<td>Hapke macroscopic roughness component</td>
<td>0.0</td>
<td>0 &lt;= value &lt;= 90</td>
</tr>
<tr>
<td>Wh</td>
<td>Hapke single scattering albedo component</td>
<td>0.5</td>
<td>0 &lt; value &lt;= 1</td>
</tr>
<tr>
<td>Zerob0st</td>
<td>Flag to set opposition surge B0 to zero</td>
<td>True</td>
<td>True or False</td>
</tr>
<tr>
<td>Phaselist</td>
<td>Phase list for empirical functions</td>
<td>None</td>
<td>String</td>
</tr>
<tr>
<td>Llist</td>
<td>Exponent list of limb darkening values</td>
<td>None</td>
<td>String</td>
</tr>
<tr>
<td>Klist</td>
<td>Exponent list of limb darkening values</td>
<td>None</td>
<td>String</td>
</tr>
<tr>
<td>Phasecurvelist</td>
<td>Phase curve list of brightness values</td>
<td>None</td>
<td>String</td>
</tr>
</table>
<br/>
<p>
The functions are defined as follows, where phase is the <def link="Phase Angle">
phase angle</def>, and u0 and u are the cosines of the <def link="Incidence Angle">
incidence</def> and <def link="Emission Angle">emission angles</def>, respectively:
</p>
<dl>
<dt><b>Lambert </b></dt>
<dd>  FUNC=u0 </dd>

<dt><b>LommelSeeliger </b></dt>
<dd>  FUNC=u0/(u0+u)</dd>

<dt><b>Minnaert </b></dt>
<dd>  FUNC=u0**K * u**(K-1)</dd>

<dt><b>LunarLambert (Lunar-Lambert, "lunar" part is Lommel-Seeliger) </b></dt>
<dd>  FUNC=(1-L)*u0 + 2*L*u0/(u0+u)</dd>

<dt><b>MinnaertEmpirical </b></dt>
<dd>  FUNC=B(phase) * u0**K(phase) * u**(K(phase)-1)</dd>

<dt><b>LunarLambertEmpirical </b></dt>
<dd>  FUNC=B(phase) * ((1-L)*u0 + 2*L*u0/(u0+u))</dd>
</dl>

<hr>
<br/>
<h2><b><center>ATMOSPHERIC PHOTOMETRIC FUNCTION MODELS</center></b></h2>
<br/>
</hr>
<table border="1">
<caption><b>Available atmosphereic functions and required parameter names</b></caption>
<tr>
<th>Function model name</th>
<th>Required parameters</th>
</tr>
<tr>
<td> Anisotropic1 </td>
<td>Bha, hnorm, nulneg, tau, tauref, wha</td>
</tr>
<tr>
<td> Anisotropic2 </td>
<td>Bha, hnorm, nulneg, tau, tauref, wha</td>
</tr>
<tr>
<td> HapkeAtm1 </td>
<td>Hga, hnorm, nulneg, tau, tauref, wha</td>
</tr>
<tr>
<td> HapkeAtm2 </td>
<td>Hga, hnorm, nulneg, tau, tauref, wha</td>
</tr>
<tr>
<td> Isotropic1 </td>
<td>Hnorm, nulneg, tau, tauref, wha</td>
</tr>
<tr>
<td> Isotropic2 </td>
<td>Hnorm, nulneg, tau, tauref, wha</td>
</tr>
</table>

<br/>
<br/>

<table border="1">
<caption><b>Atmospheric models parameter names and settings</b></caption>
<tr>
<th>Name</th>
<th>Description</th>
<th>ISIS2 Default</th>
<th>Valid Range</th>
</tr>
<tr>
<td>Bha</td>
<td>Coefficient of the single particle Legendre phase function</td>
<td>0.85</td>
<td>-1 &lt;= value &lt;= 1</td>
</tr>

<tr>
<td>Hga</td>
<td>Coefficient of single particle Henyey Greenstein phase function</td>
<td>0.68</td>
<td>-1 &lt; value &lt; 1</td>
</tr>

<tr>
<td>Hnorm</td>
<td>Atmospheric shell thickness normalized to the planet radius</td>
<td>0.003</td>
<td>0 &lt;= value</td>
</tr>
<tr>
<td>Nulneg</td>
<td>Specifies if negative values after removal of atmospheric effects will be set to NULL</td>
<td>NO</td>
<td>YES or NO</td>
</tr>
<tr>
<td>Tau</td>
<td>Normal optical depth of the atmosphere</td>
<td>0.28</td>
<td>0 &lt;= value</td>
</tr>
<tr>
<td>Tauref</td>
<td>Reference value of tau to which the image will be normalized</td>
<td>0.0</td>
<td>0 &lt;= value</td>
</tr>

<tr>
<td>Wha</td>
<td>Single scattering albedo of atmospheric particles</td>
<td>0.95</td>
<td>0 &lt; value &lt; 1</td>
</tr>
</table>
<br/>
<br/>

<hr>
<br/>
<h2><b><center>PHOTOMETRIC NORMALIZATION MODELS</center></b></h2>
<br/>
</hr>

<table border="1">
<caption><b>Available photometric normalization functions and required parameter names</b></caption>

<tr>
<th>Function name</th>
<th>Normalization function type </th>
<th>Required parameter names </th>
</tr>
<tr>
<td>Albedo </td>
<td>Albedo contrasts uniform </td>
<td>Albedo, incref, thresh</td>
</tr>
<tr>
<td>AlbedoAtm </td>
<td>Albedo with atmosphere </td>
<td>Incref </td>
</tr>
<tr>
<td>Mixed</td>
<td>Albedo at low incidence blended to topo at high incidence </td>
<td>Albedo, incmat, incref, thresh</td>
</tr>
<tr>
<td>MoonAlbedo </td>
<td>Special Lunar model </td>
<td>Bsh1, d, e, f, g2, h, wl, xb1, xb2, xmul</td>
</tr>
<tr>
<td>Shade </td>
<td>Shaded relief model </td>
<td>Albedo, incref</td>
</tr>
<tr>
<td>ShadeAtm </td>
<td>Shaded relief with atmosphere </td>
<td>Albedo, incref</td>
</tr>
<tr>
<td>Topo</td>
<td>Topographic shading uniform </td>
<td>Albedo, incref, thresh</td>
</tr>
<tr>
<td>TopoAtm </td>
<td>Topographic shading with atmosphere </td>
<td>Albedo, incref</td>
</tr>
</table>
<br/>
<br/>

<table border="1">
<caption><b>Normalization model parameter names and settings</b></caption>
<tr>
<th>Name</th>
<th>Description</th>
<th>ISIS2 default</th>
<th>Valid range</th>
</tr>
<tr>
<td>Albedo</td>
<td>Albedo to which the image will be normalized</td>
<td>1.0</td>
<td>No limit</td>
</tr>
<tr>
<td>Bsh1</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>0.08</td>
<td>0 &lt;= value</td>
</tr>
<tr>
<td>D</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>0.14</td>
<td>No limit</td>
</tr>
<tr>
<td>E</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>-0.4179</td>
<td>No limit</td>
</tr>
<tr>
<td>F</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>0.55</td>
<td>No limit</td>
</tr>
<tr>
<td>G2</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>0.02</td>
<td>No limit</td>
</tr>
<tr>
<td>H</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>0.048</td>
<td>No limit</td>
</tr>
<tr>
<td>Incmat</td>
<td>Specifies incidence angle where albedo normalization transitions to incidence normalization</td>
<td>0.0</td>
<td>0 &lt;= value &lt; 90</td>
</tr>
<tr>
<td>Incref</td>
<td>Reference incidence angle to which the image will be normalized</td>
<td>0.0</td>
<td>0 &lt;= value &lt; 90</td>
</tr>
<tr>
<td>Thresh</td>
<td>Sets upper limit on amount of amplification in regions of small incidence angle</td>
<td>30.0</td>
<td>No limit</td>
</tr>
<tr>
<td>Wl</td>
<td>Wavelength in micrometers of the image being normalized</td>
<td>1.0</td>
<td>No limit</td>
</tr>
<tr>
<td>Xb1</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>-0.0817</td>
<td>No limit</td>
</tr>
<tr>
<td>Xb2</td>
<td>Albedo dependent phase function normalization parameter</td>
<td>0.0081</td>
<td>No limit</td>
</tr>
<tr>
<td>Xmul</td>
<td>Used to convert radiance to reflectance or apply a calibration fudge factor</td>
<td>1.0</td>
<td>No limit</td>
</tr>
</table>
</small>
<br/>
<br/>
    Example PVL files:
    <pre>
    Example 1:

    Object = PhotometricModel
      Group = Algorithm
        PhtName = Lambert
      EndGroup
    EndObject
    Object = NormalizationModel
      Group = Algorithm
        NormName = Shade
	Incref = 0.0
	Albedo = 1.0
      EndGroup
    EndObject

    --------------------------------
    Example 2:

    Object = PhotometricModel
      Group = Algorithm
        PhtName = Minnaert
	K = 0.5
      EndGroup
    EndObject
    Object = NormalizationModel
      Group = Algorithm
        NormName = Albedo
	Incref = 0.0
	Incmat = 0.0
	Albedo = 1.0
	Thresh = 30.0
      EndGroup
    EndObject

    --------------------------------
    Example 3:

    Object = PhotometricModel
      Group  = Algorithm
        PhtName = Hapkehen
	Wh = 0.52
	Hh = 0.0
	B0 = 0.0
	Theta = 30.0
	Hg1 = 0.213
	Hg2 = 1.0
      EndGroup
    EndObject
    Object = AtmosphericModel
      Group = Algorithm
        AtmName = hapkeatm2
	Hnorm = 0.003
	Tau = 0.28
	Tauref = 0.0
	Wha = 0.95
	Hga = 0.68
      EndGroup
    EndObject
    Object = NormalizationModel
      Group = Algorithm
        NormName = albedoatm
	Incref = 0.0
      EndGroup
    EndObject

    --------------------------------
    Example 4 (Used to process Clementine UVVIS filter "a" data):

    Object = PhotometricModel
      Group  = Algorithm
        PhtName = LunarLambertMcEwen
      EndGroup
    EndObject
    Object = NormalizationModel
      Group = Algorithm
        NormName = MoonAlbedo
	D = 0.0
	E = -0.222
	F = 0.5
	G2 = 0.39
	H = 0.062
	Bsh1 = 2.31
        Wl = 1.0
        Xb1 = 1.0
        Xb2 = 1.0
      EndGroup
    EndObject

    --------------------------------
    Example 5 (Used to process Clementine UVVIS filter "b" data):

    Object = PhotometricModel
      Group  = Algorithm
        PhtName = LunarLambertMcEwen
      EndGroup
    EndObject
    Object = NormalizationModel
      Group = Algorithm
        NormName = MoonAlbedo
	D = 0.0
	E = -0.218
	F = 0.5
	G2 = 0.4
	H = 0.054
	Bsh1 = 1.6
        Wl = 1.0
        Xb1 = 1.0
        Xb2 = 1.0
      EndGroup
    EndObject

    --------------------------------
    Example 6 (Used to process Clementine UVVIS filter "cde" data):

    Object = PhotometricModel
      Group  = Algorithm
        PhtName = LunarLambertMcEwen
      EndGroup
    EndObject
    Object = NormalizationModel
      Group = Algorithm
        NormName = MoonAlbedo
	D = 0.0
	E = -0.226
	F = 0.5
	G2 = 0.36
	H = 0.052
	Bsh1 = 1.35
        Wl = 1.0
        Xb1 = 1.0
        Xb2 = 1.0
      EndGroup
    EndObject

    --------------------------------
    Example 7 (Used for Mars red filter data to apply empirical photometric models):

    Object = PhotometricModel
    # For Mars red filter images
    # The phase angles at which the coefficient values for the Lunar Lambert
    # Empirical (LunarLambertEmpirical) L and the Minnaert Empirical K approximation are
    # calculated, along with the brightness (phase curve) values at those
    # points (ALL ON ONE LINE!)

      Group = Algorithm
	PhtName = LunarLambertEmpirical
	PhaseList = "0.,10.,20.,30.,40.,50.,60.,70.,80.,90.,100.,110.,120.,130.,140.,150.,160.,170.,180."
	LList = "0.946,0.748,0.616,0.522,0.435,0.350,0.266,0.187,0.118,0.062,0.018,-0.012,-0.027,
	   -0.035,-0.036,-0.037,-0.031,-0.012,-0.010"
	PhaseCurveList = "0.1578,0.1593,0.1558,0.1484,0.1391,0.1292,0.1194,0.1099,0.1008,0.09176,
	   0.08242,0.07234,0.06165,0.05106,0.04091,0.03137,0.02171,0.01038,0."
      EndGroup

      Group = Algorithm
	PhtName = MinnaertEmpirical
	PhaseList = "0.,10.,20.,30.,40.,50.,60.,70.,80.,90.,100.,110.,120.,130.,140.,150.,160.,170.,180."
	KList = "0.518,0.595,0.660,0.709,0.753,0.796,0.837,0.875,0.904,0.922,0.926,0.935,0.954,0.986,
	   1.019,1.063,1.099,1.095,1.090"
	PhaseCurveList = "0.1574,0.1582,0.1546,0.1470,0.1375,0.1273,0.1174,0.1077,0.09797,0.08750,
	   0.07594,0.06466,0.05471,0.04665,0.03935,0.03339,0.02642,0.01482,0."
      EndGroup
    EndObject


  <b>References:</b>

  Chandrasekhar, S., 1960.  Radiative Transfer. Dover, 393 pp.
  Hapke, B. W., 1981. Bidirectional reflectance spectroscopy 1: Theory. J.
     Geophys. Res., pp. 86,3039-3054.
  Hapke, B., 1984. Bidirectional reflectance spectroscopy3: Corrections for
     macroscopic roughness. Icarus, 59, pp. 41-59.
  Hapke, B., 1986. Bidirectional reflectance spectroscopy 4: The extinction
     coefficient and the opposition effect. Icarus, 67, pp. 264-280.
  Johnson, J. R., et al., 1999, Preliminary Results on Photometric Properties of
     Materials at the Sagan Memorial Station, Mars, J. Geophys. Res., 104, 8809.
  Kirk, R. L., Thompson, K. T., Becker, T. L., and Lee, E. M., 2000.
     Photometric modelling for planetary cartography. Lunar Planet. Sci., XXXI,
     Abstract #2025, Lunar and Planetary Institute, Houston (CD-ROM).
  Kirk, R. L., Thompson, K. T., and Lee, E. M., 2001. Photometry of the martian
     atmosphere:  An improved practical model for cartography and photoclinometry.
     Lunar Planet. Sci., XXXII, Abstract #1874, Lunar and Planetary Institute,
     Houston (CD-ROM).
  McEwen, A. S., 1991. Photometric functions for photoclinometry and other
     applications.  Icarus, 92, pp. 298-311.
  Thorpe, T. E., 1973, Mariner 9 Photometric Observations of Mars from November
     1971 through March 1972, Icarus, 20, 482.
  Tomasko, M. G., et al., 1999, Properties of Dust in the Martian Atmosphere from
     the Imager on Mars Pathfinder, J. Geophys. Res., 104, 8987.
  </pre>

  </description>

  <oldName>
    <item>photomet</item>
  </oldName>

  <history>
    <change name="Tammy Becker" date="1989-02-15">
      Original version - based on Tammy Becker's
      photom/photompr programs which were later
      converted to Randy Kirk's photomet
    </change>
    <change name="Janet Barrett" date="2008-03-07">
      Added code to acquire the BandBin Center keyword from the
      input image. This value is needed in case the user chooses
      the MoonAlbedo normalization method.
    </change>
    <change name="Steven Lambright" date="2008-05-13">
      Removed references to CubeInfo
    </change>
    <change name="Jeannie Walldren" date="2009-01-08">
      Added MAXEMISSION and MAXINCIDENCE parameters.  Modified code to set
      off-target pixels to NULL.  Added appTests for new parameters.  Added user
      documentation examples.
    </change>
    <change name="Eric Hyer" date="2010-11-10">
      Added USEDEM parameter.
    </change>
    <change name="Janet Barrett" date="2010-11-22">
      Added error check for situations where there is not an intersection with
      the DEM and the local photometric angles are requested.
    </change>
    <change name="Janet Barrett" date="2010-11-23">
      Added capability to use both ellipsoid and DEM photometric angles in
      atmospheric corrections. This provides the ability to do shading using a
      DEM surface.
    </change>
    <change name="Janet Barrett" date="2011-02-22">
      The USEDEM parameter has been removed and the ANGLESOURCE parameter has
      been added. The ANGLESOURCE parameter lets you specify the source where the
      photometric angles will come from: ellipsoid, DEM, or center of image.
    </change>
    <change name="Janet Barrett" date="2011-03-29">
      The CENTER option of the ANGLESOURCE parameter has been removed and the
      CENTER_FROM_IMAGE, CENTER_FROM_LABEL and CENTER_FROM_USER options have been
      added. This allows the user to determine where the center photometric angles
      will come from.
    </change>
    <change name="Janet Barrett" date="2011-09-23">
      The following changes were made to the program for the ISIS3.3.0 release:
      1) The PHOPAR parameter name was changed to FROMPVL - this was done to have
         consistent parameter names throughout the photometry software.
      2) All radio button options are now accessed through drop down menus. The
         only radio button options that existed prior to this release were those for
         choosing the ANGLESOURCE. In order to use any of the drop down menus, click
         on the drop down menu and hold the mouse button down while navigating to
         the choice that you want.
      3) Added a USEDEM option which will let you determine how the trim is performed.
         If you don't check the USEDEM box, then trimming is performed based on the
         photometric angles of the ellipsoid. If you check the USEDEM box, then the
         trimming is performed based on the photometric angles of the DEM (if one is
         specified in the image labels). If there is no DEM associated with your FROM
         file, then the default is to use the ellipsoid.
      4) The program now lets you specify the photometric model, atmospheric model,
         and normalization model through the PHTNAME, ATMNAME, and NORMNAME drop down
         menus. Prior to this release, you were forced to provide an input PVL file with
         all of the model information in it. You can now provide the model information
         through the PVL, the GUI, or a combination of both. If you provide a FROMPVL
         file, then you need to use the GUI to specify which model(s) to use from that
         file. If you change any of the model-specific parameters in the GUI, then they
         will override the values in the FROMPVL file.
      5) The BHAREF, HGAREF, and WHAREF parameters have been removed because they were
         obsolete.
      6) The NONORMALIZATION model was removed because it duplicated the functionality
         of the SHADE model.
      7) More photometric models have been added. The Hapke Legendre, Minnaert Empirical,
         and Lunar Lambert Empirical models have been added. The Minnaert Empirical
         model has parameters PHASELIST, PHASECURVELIST, and KLIST associated with it.
         The information for the new parameters is a list of comma delimited values
         (phase angle goes in PHASELIST, brightness values go in PHASECURVELIST, and
         limb darkening values go in KLIST). The Lunar Lambert Empirical model has
         parameters PHASELIST, PHASECURVELIST, and LLIST where LLIST is similar to the
         KLIST parameter for Minnaert Empirical.
      8) A USEDEM parameter has been added which allows the user to determine which
         photometric angles to use for trimming. If the USEDEM parameter is set to false,
         then the photometric angles of the ellipsoid are used. If USEDEM is set to true,
         then the photometric angles of the DEM shape model are used for trimming.
      9) Helper buttons were added to the FROMPVL to allow you to View a PVL or to Load
         a PVL. PLEASE NOTE: When loading a Minnaert Empirical or Lunar Lambert Empirical
         model from a PVL, only the first value will be loaded into the GUI. This is
         a known problem and will be fixed in the next patch or release to ISIS.
      10) ***NOTE*** The Minnaert Empirical and Lunar Lambert Empirical models do not
         load properly from a PVL file when using the Load PVL helper button. This is
         a known problem and will be fixed in the next patch or release of ISIS.
    </change>
    <change name="Janet Barrett" date="2011-11-04">
      The ZEROB0STANDARD parameter for the Hapke models was not added to the new
      update of photomet during the last release. This parameter is responsible for
      determining if the Hapke opposition surge component B0 is set to zero when
      calculations are based on standard conditions. This parameter has been added
      to the new interface to photomet.
    </change>
    <change name="Janet Barrett" date="2012-01-10">
      The program was fixed to make it backwards compatible with older PVL files. If
      you tried running this program with an older PVL, then you most likely got the
      following error message "A Normalization model must be specified before running
      this program." This message would have occurred even if you had a Normalization
      model specified in your FROMPVL file. This problem has been fixed. If your FROMPVL
      file specifies a Normalization model, then you aren't required to specify one through
      the program interface as well.
    </change>
    <change name="Janet Barrett" date="2012-05-04">
      A new BACKPLANE option was added to ANGLESOURCE. This BACKPLANE option allows you
      to input photometric angle information using separate ISIS cube files. Files
      containing geometric, photometric, etc. information pixel by pixel for the input
      image file are normally referred to as backplanes. This option was added to support
      image data that does not have a camera model associated with it. If you have a
      way to generate the photometric angles for such data, then you will be able to
      do photometric correction on it. This option is also very useful for speeding up
      the processing done by photomet. If you have all the photometric information
      pre-computed, then this information no longer needs to be generated every time
      the program is run. You can input photometric information using a combination of
      files and photometric angle constants. For example, if you have a file containing
      the phase angle for every pixel, a file containing the incidence angle for every
      pixel, and you know that the emission angle is 0.0 for every pixel, then you can
      use the PHASE_ANGLE_FILE, INCIDENCE_ANGLE_FILE, and EMISSION_ANGLE fields to input
      the 2 file names and the emission angle constant.
    </change>
    <change name="Ella Mae Lee" date="2012-10-05">
      Improved the documentation, reference Mantis issue #453, #843
    </change>
    <change name="Janet Barrett" date="2012-10-24">
      The following changes were made to the program:
      1) Added a new parameter, CHNGPAR, which allows the user to change any of the model-
         related parameter settings without having to specify the model name on the command
         line or in the GUI. Before the CHNGPAR parameter was added, you could only change
         a model-related parameter on the command line or in the GUI if you also specified
         the model name using the PHTNAME, ATMNAME, or NORMNAME parameter. Any value you
         set using the CHNGPAR parameter will override changes that are specified in the
         GUI. Any value that is changed through the GUI will override values specified in
         the FROMPVL file.
         **PLEASE NOTE**: Any parameter that you type into the CHNGPAR string MUST be spelled
         correctly and using the full name (no partial parameter names). Otherwise, the
         program will not recognize the parameter and it won't get used.
      2) Added new output groups to the print.prt log file so that the user can see exactly
         which values were used to run photomet. The new groups that get written to the
         print.prt file include NormalizationModelParametersUsed, AtmosphericModelParametersUsed,
         and PhotometricModelParametersUsed.
      3) Fixed photomet so that the INCMAT parameter is no longer required for the ALBEDO
         normalization model. The INCMAT parameter is not used by the ALBEDO normalization
         model, so the user is no longer required to input an INCMAT value for that model.
      4) Fixed a problem which was causing the NULNEG and ZEROB0STANDARD parameters to be
         loaded incorrectly if specified in the FROMPVL file.
      5) Added a more meaningful error message when a normalization model is not specified by
         the user either through the GUI, command line, or FROMPVL file.
      6) Changed the ZEROB0STANDARD parameter name to ZEROB0ST. This was to help prevent the
         user from needing to resize the GUI each time they opened it because the parameter
         name was too long. We are maintaining backwards compatibility by supporting both
         ZEROB0STANDARD and ZEROB0ST in the photomet code. This will allow you to run a
         script with the old parameter name without any problems.
    </change>
    <change name="Janet Barrett" date="2012-12-07">
      PLEASE NOTE (in reference to change made on 2012-10-24): The backwards compatibility for
      the shorter ZEROB0ST parameter name has not been fully implemented in ISIS. As a result,
      this change has been removed and the full ZEROB0STANDARD parameter name must be used.
      Support for aliases (deprecated values) must be fully implemented in ISIS before the shorter
      parameter name (ZEROB0ST) will be available. Fixes #1288.
    </change>
    <change name="Lynn Weller" date="2013-02-25">
      Removed links to applications imbedded in text and replaced with
      italicized application name.  Added application links to the
      "Related Objects and Documents" section of the documentation.
      Fixes mantis ticket #1525.
    </change>
    <change name="Kelvin Rodriguez" date="2016-08-24">
      Added cast to void on 'changePar.simplified()' function call to silience unused return
      value warnings on OS X
    </change>
    <change name="Curtis Rose" date="2016-11-16">
      Decoupled ANGLESOURCE and USEDEM parameters. They were working incorrectly before
      and were tangled together a bit. They are separated now and working as expected.
      Anglesource DEM makes the photometric calculations based on the DEM of the image
      if it exists. Anglesource ELLIPSOID makes the photometric calculations based on the radius
      obtained from the DEM shape model. Usedem true trims the image using the photometric
      calculations on the radius obtained from the DEM shape model. Usedem false trims the image
      using the from the IAU/NAIF target body file, which is defined within the cube's kernel group
      as the TargetAttitudeShape. Fixes #4180.
    </change>
    <change name="Lauren Adoram-Kershner" date="2019-11-07">
      Added a warning when the 'DEM' angle source option is used with 'mixed'
      or 'topo' normalization method. Fixes #3451 and #3452.
    </change>
  </history>

  <category>
    <categoryItem>Radiometric and Photometric Correction</categoryItem>
    <categoryItem>Cameras</categoryItem>
  </category>

  <seeAlso>
    <applications>
      <item>photemplate</item>
      <item>fx</item>
      <item>stats</item>
    </applications>
  </seeAlso>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>cube</type>
        <fileMode>input</fileMode>
        <brief>
          Input cube file
        </brief>
        <description>
          This is the input filename that will be photometrically corrected.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>
      <parameter name="TO">
        <type>cube</type>
        <pixelType>real</pixelType>
        <fileMode>output</fileMode>
        <brief>
          Output cube file
        </brief>
        <description>
          This output file will contain the results of the photometric
          correction.
        </description>
      </parameter>
      <parameter name="FROMPVL">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input PVL file
        </brief>
        <defaultPath>$ISISROOT/appdata/templates/photometry</defaultPath>
        <internalDefault>None Specified</internalDefault>
        <description>
          This text file contains the parameter names and values to be used
          to perform the photometric correction.
        </description>
         <helpers>
          <helper name="H1">
            <function>PrintPvl</function>
            <brief>View Input PVL File</brief>
            <description>
              This helper button will extract the contents of the input PVL
              file and display the information to the session log of the application,
              see text box in bottom portion of GUI
             </description>
	     <icon>$ISISROOT/appdata/images/icons/labels.png</icon>
          </helper>
          <helper name="H2">
            <function>LoadPvl</function>
            <brief>Load Input PVL File values into the GUI</brief>
            <description>
              This helper button will take the values in the FROMPVL file and
              load them into their correct locations in the GUI
             </description>
	     <icon>$ISISROOT/appdata/images/icons/exec.png</icon>
          </helper>
         </helpers>
        <filter>
          *.pvl
        </filter>
      </parameter>
    </group>

    <group name="Change Parameters">
      <parameter name="CHNGPAR">
        <type>string</type>
        <brief>
          Change parameter string
        </brief>
        <default><item>None</item></default>
        <internalDefault>None</internalDefault>
        <description>
          Chngpar is used to enter a string of parameter names and values enclosed in
          quotes that will be added to or replaces the pre-defined parameter values.
          PLEASE NOTE: Any parameter names used in the CHNGPAR string input MUST be
          spelled out completely and without any errors. Otherwise, they will be ignored
          by the program.
          <blockquote>
          Example:<br/>
          photomet from=f1.cub to=pho.cub frompvl=my.pvl chngpar="tau=0.5 tauref=30"
          </blockquote>
        </description>
      </parameter>
    </group>

    <group name="Trim Parameters">
      <parameter name="MAXEMISSION">
        <type>double</type>
        <brief>Maximum emisson angle to trim image</brief>
        <description>
          The maximum number of degrees allowed for the
          <def link="Emission Angle">emission angle</def> in
          order to retain the data.  This number must be between 0.0 and 90.0.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">90.0</maximum>
        <default><item> 90.0</item></default>
      </parameter>
      <parameter name="MAXINCIDENCE">
        <type>double</type>
        <brief>Maximum incidence angle to trim image</brief>
        <description>
          The maximum number of degrees allowed for the
          <def link="Incidence Angle">incidence angle</def> in
          order to retain the data.  This number must be between 0.0 and 90.0.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">90.0</maximum>
        <default><item> 90.0</item></default>
      </parameter>
      <parameter name="USEDEM">
        <type>boolean</type>
        <brief>
          Specify if DEM photometric angels will be used to trim image
        </brief>
        <default>
          <item>FALSE</item>
        </default>
        <description>
          <p>
            This specifies if the image will be trimmed based on the photometric
            angles obtained from the ellipsoid (default) or the DEM surface.
          </p>
           <p>
            The ellipsoid is retrieved from the IAU/NAIF target body file,
            which is defined within the cube's kernel group as the TargetAttitudeShape.
            If this parameter is set to false, then the photometric angles will be obtained
            from the ellipsoidal surface.
          </p>
          <p>
            The photometric angles obtained from the DEM surface (shape model)
            for each pixel are obtained using an ellipsoid
            defined by the radius obtained from the DEM shape model.
            <i>Note that photomet does not trim using local slopes.</i>
          </p>
        </description>
      </parameter>
    </group>

    <group name="Angle Source Options">
      <parameter name="ANGLESOURCE">
        <type>combo</type>
        <internalDefault>ELLIPSOID</internalDefault>
        <default><item>ELLIPSOID</item></default>
        <brief>
          Source of photometric angles: ELLIPSOID, DEM, CENTER, or FILE
        </brief>
        <description>
          The incidence, emission, and phase angles are determined based on
          the source defined by the user.  The available options are listed
          below:
          <br />
          <dl>
          <dt><b>ELLIPSOID (default)</b></dt>
          <dd>
            The photometric angles for each pixel are obtained using an ellipsoid
            defined by the radius obtained from the DEM shape model.
          </dd>
          <dt><b>DEM</b></dt>
          <dd>
            The photometric angles for each pixel are obtained using the DEM shape
            model (if one is defined in the image labels).  The surface roughness
            is taken into account to calculate a surface normal, which is used to
            calculate the photometric angles. i.e. slope, local emission, local incidence.
          </dd>
          <dt><b>CENTER_FROM_IMAGE</b></dt>
          <dd>
            The photometric angles are obtained from the center of the input image
            using the ellipsoid shape model. These angles are applied to every
            pixel in the input file. This option is best for images where the
            photometric angles do not vary much and when faster processing is desired.
          </dd>
          <dt><b>CENTER_FROM_LABEL</b></dt>
          <dd>
            The photometric angle keywords are obtained from the label of the input
            image, and applied to every pixel in the file.  The keywords
            "IncidenceAngle," "EmissionAngle," and "PhaseAngle" must be in the image
            labels.  This option is best for images where the photometric angles do
            not vary much and when faster processing is desired.
          </dd>
          <dt><b>CENTER_FROM_USER</b></dt>
          <dd>
            The photometric angles are obtained from the values defined for
            IncidenceAngle, EmissionAngle, and PhaseAngle parameter names. These
            angles are applied to every pixel in the file.  This option is best
            for images where the photometric angles do not vary much and when faster
            processing is desired.
          </dd>
          <dt><b>BACKPLANE</b></dt>
          <dd>
            The photometric angles are obtained from separate cube files, which
            contain the information for each pixel in the input file. These angles
            are applied to every pixel in the file. This option is best for images
            that will be processed through the same steps many times with different
            photometric settings because the photometric angles are not recomputed
            each time for every pixel.  This option is also used for images that
            do not have a camera model associated with them. If no camera model is
            available, then create files that contain the photometric angle
            information for each pixel in the input file with <i>fx</i> or another
            program.  It is very important that the new files have the same
            number of samples and lines as the input file.
          </dd>
          </dl>
         <br/>
        </description>
        <list>
          <option value="ELLIPSOID">
            <brief>Get angles from ELLIPSOID</brief>
            <description>
              The photometric angles for each pixel are obtained using an ellipsoid
              defined by the radius obtained from the DEM surface (shape model).
            </description>
            <exclusions>
              <item>PHASE_ANGLE_FILE</item>
              <item>INCIDENCE_ANGLE_FILE</item>
              <item>EMISSION_ANGLE_FILE</item>
              <item>PHASE_ANGLE</item>
              <item>INCIDENCE_ANGLE</item>
              <item>EMISSION_ANGLE</item>
            </exclusions>
          </option>
          <option value="DEM">
            <brief>Get angles from DEM</brief>
            <description>
              The photometric angles for each pixel are obtained using the DEM surface (shape
              model).
            </description>
            <exclusions>
              <item>PHASE_ANGLE_FILE</item>
              <item>INCIDENCE_ANGLE_FILE</item>
              <item>EMISSION_ANGLE_FILE</item>
              <item>PHASE_ANGLE</item>
              <item>INCIDENCE_ANGLE</item>
              <item>EMISSION_ANGLE</item>
            </exclusions>
          </option>
          <option value="CENTER_FROM_IMAGE">
            <brief>Get angles from center of image</brief>
            <description>
              The photometric angles are obtained from the center of the input image
              using the ellipsoid shape model.
            </description>
            <exclusions>
              <item>PHASE_ANGLE_FILE</item>
              <item>INCIDENCE_ANGLE_FILE</item>
              <item>EMISSION_ANGLE_FILE</item>
              <item>PHASE_ANGLE</item>
              <item>INCIDENCE_ANGLE</item>
              <item>EMISSION_ANGLE</item>
            </exclusions>
          </option>
          <option value="CENTER_FROM_LABEL">
            <brief>Get angles from image label</brief>
            <description>
              The keyword values for "IncidenceAngle," "EmissionAngle," and
              "PhaseAngle" are extracted from the image labels and used for the
              photometric angles to apply to every pixel.
            </description>
            <exclusions>
              <item>PHASE_ANGLE_FILE</item>
              <item>INCIDENCE_ANGLE_FILE</item>
              <item>EMISSION_ANGLE_FILE</item>
              <item>PHASE_ANGLE</item>
              <item>INCIDENCE_ANGLE</item>
              <item>EMISSION_ANGLE</item>
            </exclusions>
          </option>
          <option value="CENTER_FROM_USER">
            <brief>Get the angles from user</brief>
            <description>
              The photometric angles are obtained from the user and applied to every
              pixel in the file.
            </description>
            <exclusions>
              <item>PHASE_ANGLE_FILE</item>
              <item>INCIDENCE_ANGLE_FILE</item>
              <item>EMISSION_ANGLE_FILE</item>
            </exclusions>
            <inclusions>
              <item>PHASE_ANGLE</item>
              <item>INCIDENCE_ANGLE</item>
              <item>EMISSION_ANGLE</item>
            </inclusions>
          </option>
          <option value="BACKPLANE">
            <brief>Get the angles from separate file(s)</brief>
            <description>
              The photometric angles are obtained from separate backplane band(s)
              or file(s) which contain the angle information for each pixel in the
              input image file.
            </description>
            <exclusions>
              <item>PHASE_ANGLE</item>
              <item>INCIDENCE_ANGLE</item>
              <item>EMISSION_ANGLE</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="PHASE_ANGLE_FILE">
        <type>cube</type>
        <pixelType>real</pixelType>
        <fileMode>input</fileMode>
        <internalDefault>No file</internalDefault>
        <brief>
          Phase angle cube file
        </brief>
        <description>
          This file must contain the <def link="Phase Angle">phase angle</def>
          information for the input cube.
        </description>
      </parameter>
      <parameter name="INCIDENCE_ANGLE_FILE">
        <type>cube</type>
        <pixelType>real</pixelType>
        <fileMode>input</fileMode>
        <internalDefault>No file</internalDefault>
        <brief>
          Incidence angle cube file
        </brief>
        <description>
          This file must contain the <def link="Incidence Angle">incidence
          angle</def> information for the input cube.
        </description>
      </parameter>
      <parameter name="EMISSION_ANGLE_FILE">
        <type>cube</type>
        <pixelType>real</pixelType>
        <fileMode>input</fileMode>
        <internalDefault>No file</internalDefault>
        <brief>
          Emission angle cube file
        </brief>
        <description>
          This file must contain the <def link="Emission Angle">emission
          angle</def> information for the input cube.
        </description>
      </parameter>
      <parameter name="PHASE_ANGLE">
        <type>double</type>
        <brief>
          Center phase angle
        </brief>
        <description>
          The center phase angle to use if the CENTER_FROM_USER option is chosen.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">180.0</maximum>
        <default><item> 0.0</item></default>
      </parameter>
      <parameter name="INCIDENCE_ANGLE">
        <type>double</type>
        <brief>
          Center incidence angle
        </brief>
        <description>
          The center <def link="Incidence Angle">incidence angle</def> to use
          if the CENTER_FROM_USER option is chosen.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">90.0</maximum>
        <default><item> 0.0</item></default>
      </parameter>
      <parameter name="EMISSION_ANGLE">
        <type>double</type>
        <brief>
          Center emission angle
        </brief>
        <description>
          The center <def link="Emission Angle">emission angle</def> to use
          if the CENTER_FROM_USER option is chosen.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">90.0</maximum>
        <default><item> 0.0</item></default>
      </parameter>
    </group>

    <group name="Photometric Model">
      <parameter name="PHTNAME">
        <type>combo</type>
        <brief>
          Photometric model to be used
        </brief>
        <description>
          Specify the name of the surface photometric function model to apply
          to the input image.  The available options are the following: <br/><br/>
          <dl>
          <dt><b>FROMPVL </b></dt>
          <dd>
            Gets the photometric model from the <def>PVL</def> file.  If the
            required parameter names and values are missing from the PVL file,
            either add them to the PVL file, or enter the values at the command
            line or use the GUI to enter the values.
          </dd>
          <dt><b>LAMBERT </b></dt>
          <dd>
            A simple photometric model which predicts that light incident on a
            surface is scattered uniformly in all directions; the total amount
            of reflected light depends on the incidence angle of the illumination.
            This function does not depend upon the outgoing light direction.
          </dd>
          <dt><b>HAPKEHEN</b></dt>
          <dd>
            Derive model albedo using the complete Hapke model with Henyey-Greenstein
            single-particle phase function whose coefficients are hg1 and hg2,
            plus single scattering albedo wh, opposition surge parameters hh and
            b0, and macroscopic roughness theta.  For a smooth model with opposition
            effect use theta=0. <br/>
            <br/>
            The table below shows the Hapke parameters for Mars from Johnson et
            al. (1999) for IMP data  of Photometry Flats (soil) and may be reasonably
            representative of Mars as a whole.  Note that (hg1, hg2=1.0) is
            equivalent to (-hg1, hg2=0.0). <br/>
            <br/>
            <table border="1">
            <caption><b>Parameter settings for Mars</b></caption>
            <tr>
            <th>Band</th>
            <th>Wh</th>
            <th>B0</th>
            <th>Hh</th>
            <th>Hg1</th>
            <th>Hg2</th>
            </tr>
            <tr>
            <td>Red</td>
            <td>0.52</td>
            <td>0.025</td>
            <td>0.17</td>
            <td>0.213</td>
            <td>1.0</td>
            </tr>
            <tr>
            <td>Green</td>
            <td>0.29</td>
            <td>0.29</td>
            <td>0.17</td>
            <td>0.19</td>
            <td>1.0</td>
            </tr>
            <tr>
            <td>Blue</td>
            <td>0.16</td>
            <td>0.995</td>
            <td>0.17</td>
            <td>0.145</td>
            <td>1.0</td>
            </tr>
            </table>
          </dd>
          <dt><b>HAPKELEG</b></dt>
          <dd>
              Derive model albedo using complete Hapke model with Henyey Legendre
              two-term Legendre polynomial phase function whose coefficients are bh
              and ch, plus single scattering albedo wh, opposition surge parameters
              hh and b0, and macroscopic roughness theta.
          </dd>
          <dt><b>LOMMELSEELIGER</b></dt>
          <dd>
              This model takes into account the <def>radiance</def> that results from
              single scattering (scattering of collimated incident light) and
              does not take into account the radiance that results from multiple
              scattering (scattering of diffuse light which has made its way
              indirectly to the same position by being scattered one or more
              times). This model depends on the incidence and emission angles.
          </dd>
          <dt><b>LUNARLAMBERTMCEWEN</b></dt>
          <dd>
              This model was developed specifically for use with the Moon, and
              designed to be used in conjunction with the MoonAlbedo
              normalization model.
          </dd>
          <dt><b>LUNARLAMBERTEMPIRICAL</b>, <b>LUNARLAMBERT</b>,
          <b>MINNAERTEMPIRICAL</b>, and <b>MINNAERT</b>
          </dt>
          <dd>
              These models combine a weighted sum of the LommelSeeliger and
              Lambert models. Given a suitable value for the LunarLambert
              function weight, L, these models fit the true
          <def link="Reflectance">reflectance</def> behavior
              of many planetary surfaces equally well as the Hapke model. These
              models also depend on the incidence and emission angles.
          </dd>
          </dl>
        <br/>
        </description>

        <internalDefault>FROMPVL</internalDefault>
        <default>
          <item>FROMPVL</item>
        </default>
        <list>
          <option value="FROMPVL">
            <brief>Get from photomet PVL</brief>
            <description>
              Get photometric model from the <def>PVL</def> file.  Add missing
              parameters to the PVL file, or enter the values at the command line
              or use the GUI to enter the values.
            </description>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>BH</item>
              <item>CH</item>
              <item>L</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>

          <option value="LAMBERT">
            <brief>
              Lambert Photometric Model
            </brief>
            <description>
              Simple photometric model which predicts that light
              incident on a surface is scattered uniformly in all directions.
            </description>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>BH</item>
              <item>CH</item>
              <item>L</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
          <option value="HAPKEHEN">
            <brief>
              Hapke-Henyey-Greenstein Photometric Model
            </brief>
            <description>
              Derive model albedo using complete Hapke model with Henyey-Greenstein
              single-particle phase function.
            </description>
            <inclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
            </inclusions>
            <exclusions>
              <item>BH</item>
              <item>CH</item>
              <item>L</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
          <option value="HAPKELEG">
            <brief>
              Hapke Legendre Polynomial Photometric Model
            </brief>
            <description>
              Derive model albedo using complete Hapke model with Henyey Legendre
              two-term Legendre polynomial phase function.
            </description>
            <inclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
            </inclusions>
            <exclusions>
              <item>HG1</item>
              <item>HG2</item>
              <item>L</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
          <option value="LOMMELSEELIGER">
            <brief>
              Lommel-Seeliger Photometric Model
            </brief>
            <description>
              This model takes into account the <def link="Radiance">radiance</def>
              that results from single scattering (scattering of collimated
              incident light).
            </description>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>L</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
          <option value="LUNARLAMBERTEMPIRICAL">
            <brief>
              Lunar Lambert Empirical Photometric Model
            </brief>
            <description>
              This model combines a weighted sum of the LommelSeeliger and
              Lambert models.
            </description>
            <inclusions>
              <item>PHASELIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </inclusions>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>K</item>
              <item>L</item>
              <item>KLIST</item>
            </exclusions>
          </option>
          <option value="LUNARLAMBERTMCEWEN">
            <brief>
              Lunar Lambert-McEwen Photometric Model
            </brief>
            <description>
              This model was designed for the Moon to be used in conjunction with the
              MoonAlbedo normalization model.
            </description>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>L</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
          <option value="LUNARLAMBERT">
            <brief>
              Lunar Lambert Photometric Model
            </brief>
            <description>
              This model combines a weighted sum of the LommelSeeliger and
              Lambert models.
            </description>
            <inclusions>
              <item>L</item>
            </inclusions>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>K</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
         <option value="MINNAERTEMPIRICAL">
            <brief>
              Minnaert Empirical Photometric Model
            </brief>
            <description>
              This model combines a weighted sum of the LommelSeeliger and
              Lambert models.
            </description>
            <inclusions>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>PHASECURVELIST</item>
            </inclusions>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>K</item>
              <item>L</item>
              <item>LLIST</item>
            </exclusions>
          </option>
          <option value="MINNAERT">
            <brief>
              Minnaert Photometric Model
            </brief>
            <description>
              This model combines a weighted sum of the LommelSeeliger and
              Lambert models.
            </description>
            <inclusions>
              <item>K</item>
            </inclusions>
            <exclusions>
              <item>THETA</item>
              <item>WH</item>
              <item>HG1</item>
              <item>HG2</item>
              <item>BH</item>
              <item>CH</item>
              <item>HH</item>
              <item>B0</item>
              <item>ZEROB0STANDARD</item>
              <item>L</item>
              <item>PHASELIST</item>
              <item>KLIST</item>
              <item>LLIST</item>
              <item>PHASECURVELIST</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="THETA">
        <type>string</type>
        <brief>
          Macroscopic roughness angle
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The "macroscopic roughness" of the surface as it affects
          the photometric behavior, used for Hapkehen or Hapkeleg.
          This is the RMS slope at scales larger than the distance
          photons penetrate the surface but smaller than a pixel.
          See Hapke (1986).  The roughness correction, which is
          evaluated if theta is given any value other than 0.0, but
          is extremely slow.  See Hapke (1986).
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">90.0</maximum>
      </parameter>

      <parameter name="WH">
        <type>string</type>
        <brief>
          Single scattering albedo
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Hapke single scattering albedo of surface particles,
          see Hapke (1981).
        </description>
        <minimum inclusive="no">0.0</minimum>
        <maximum inclusive="yes">1.0</maximum>
      </parameter>

      <parameter name="HG1">
        <type>string</type>
        <brief>
          Hapke Henyey Greenstein coefficient
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          Asymmetry parameter used in Hapke Henyey Greenstein model
          for the scattering phase function of single particles in the
          surface.  See Hapke (1981).  The two parameter Henyey Greenstein
          function is:
          <blockquote>
          P(phase)=(1-hg2) * (1-hg1**2)/(1+hg1**2+2*hg1*cos(phase))**1.5
          + hg2  * (1-hg1**2)/(1+hg1**2-2*hg1*cos(phase))**1.5
          </blockquote>
        </description>
        <minimum inclusive="no">-1.0</minimum>
        <maximum inclusive="no">1.0</maximum>
      </parameter>

      <parameter name="HG2">
        <type>string</type>
        <brief>
          Hapke Henyey Greenstein Coefficient
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Hapke Henyey Greenstein coefficient for single particle phase
          function.  The second parameter of the two-parameter Henyey-Greenstein
          model for the scattering phase function of single particles in the
          surface.  This parameter controls the proportions in a linear
          mixture of ordinary Heneyey Greenstein phase functions with asymmetry
          parameters equal to +hg1 and -hg1.  See HG1 for the full formula.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="yes">1.0</maximum>
      </parameter>

      <parameter name="BH">
        <type>string</type>
        <brief>
          Hapke Legendre coefficient
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Hapke Legendre coefficient for single particle phase
          function.  A two-term Legendre polynomial is used for the scattering
          phase function of single particles in the surface:
          <blockquote>
          P(phase) = 1 + bh * p1(cos(phase)) + ch * p2(cos(phase)) <br/>
          </blockquote>
          Bh is not to be confused with the Legendre coefficient bha
          of the phase function for atmospheric particles, used when
          atmname=anisotropic1 or anisotropic2.
        </description>
        <minimum inclusive="no">-1.0</minimum>
        <maximum inclusive="no">1.0</maximum>
      </parameter>

      <parameter name="CH">
        <type>string</type>
        <brief>
          Hapke Legendre coefficient
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Hapke Legendre coefficient for single particle phase
          function.  A two-term Legendre polynomial is used for the scattering
          phase function of single particles in the surface: <br/>
          <blockquote>
                P(phase) = 1 + bh * p1(cos(phase)) + ch * p2(cos(phase))
          </blockquote>
        </description>
        <minimum inclusive="no">-1.0</minimum>
        <maximum inclusive="no">1.0</maximum>
      </parameter>

      <parameter name="HH">
        <type>string</type>
        <brief>
          Hapke opposition surge
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Hapke opposition surge component.  The width parameter for the opposition
          effect for the surface if Hapkehen or Hapkeleg is used.  See Hapke (1984).
        </description>
        <minimum inclusive="yes">0.0</minimum>
      </parameter>

      <parameter name="B0">
        <type>string</type>
        <brief>
          Hapke opposition surge
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Hapke opposition surge component.  The magnitude of the opposition
          effect for the surface if Hapkehen or Hapkeleg is used.  See Hapke (1984).
        </description>
        <minimum inclusive="yes">0.0</minimum>
      </parameter>

      <parameter name="ZEROB0STANDARD">
        <type>string</type>
        <brief>
           Specifies if opposition surge is set to zero under standard conditions
        </brief>
        <default><item>READFROMPVL</item></default>
        <description>
          This specifies if the opposition surge component B0 is set to zero
          during the standard conditions phase.  The program will automatically
          default to "true" if "ZEROB0STANDARD" is not defined in the PVL FILE when the
          "READFROMPVL" option is selected, and the user did not choose either
          "FALSE" or "TRUE" option.
        </description>
        <list>
          <option value="READFROMPVL">
            <brief>
              Get ZEROB0STANDARD value from the FROMPVL file
            </brief>
            <description>
              Retrieve and set the ZEROB0STANDARD parameter from the FROMPVL file. If
              a FROMPVL file is not provided, then an error will occur.
            </description>
          </option>
          <option value="FALSE">
            <brief>
              B0 will not be set to zero for standard conditions phase
            </brief>
            <description>
              This option specifies that the opposition surge B0 will not be set to zero
              during the standard conditions phase.
            </description>
          </option>
          <option value="TRUE">
            <brief>
              B0 will be set to zero for standard conditions phase
            </brief>
            <description>
              This option specifies that the opposition surge B0 will be set to zero
              during the standard conditions phase.
            </description>
          </option>
        </list>
      </parameter>

      <parameter name="L">
        <type>string</type>
        <brief>
          Lunar-Lambert function weight
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Lunar Lambert function weight that governs limb-darkening
          in the lunar lambert photometric function:
          <blockquote>
            Func=(1-L)*u0 + 2*L*u0/(u0+u)
          </blockquote>
          The values generally fall in the range from 0 (Lambert function) to 1
          (Lommel-Seeliger or "lunar" function).
        </description>
      </parameter>

      <parameter name="K">
        <type>string</type>
        <brief>
          Minnaert function exponent
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The Minnaert function exponent that governs limb-darkening in the
          Minnaert photometric function:
          <blockquote>
            Func=u0**K * u**(K-1)
          </blockquote>
          The values generally fall in the range from 0.5 ("lunar-like",
          almost no limb darkening) to 1.0 (Lambert function).
        </description>
        <minimum inclusive="yes">0.0</minimum>
      </parameter>

      <parameter name="PHASELIST">
        <type>string</type>
        <brief>
          Empirical functions phase angle list
        </brief>
        <description>
          The Minnaert Empirical and Lunar Lambert Empirical function phase
          angle list entered as a comma delimited string describing how the
          parameters of the empirical function vary with <def>phase angle</def>.
          See "$ISISROOT/appdata/templates/photometry/marsred.pvl" for an example.
        </description>
        <default><item>No List</item></default>
        <internalDefault>
          No List
        </internalDefault>
      </parameter>

      <parameter name="KLIST">
        <type>string</type>
        <brief>
          Minnaert Empirical function limb darkening parameter list
        </brief>
        <description>
          The Minnaert Empirical function exponent list of limb darkening values
          entered as a comma delimited string that describes how the parameters
          of the empirical function vary with phase angle.
          See "$ISISROOT/appdata/templates/photometry/marsred.pvl" for an example.
        </description>
        <default><item>No List</item></default>
        <internalDefault>
          No List
        </internalDefault>
      </parameter>

      <parameter name="LLIST">
        <type>string</type>
        <brief>
          Lunar Lambert Empirical function limb darkening parameter list
        </brief>
        <description>
          The Lunar Lambert Empirical function parameter list of limb darkening
          values entered as a comma delimited string that describes how the
          parameters of the empirical function vary with phase angle.  See
          "$ISISROOT/appdata/templates/photometry/marsred.pvl" for an example.
        </description>
        <default><item>No List</item></default>
        <internalDefault>
          No List
        </internalDefault>
      </parameter>

      <parameter name="PHASECURVELIST">
        <type>string</type>
        <brief>
          Empirical functions phase curve (brightness) value list
        </brief>
        <description>
          The Minnaert Empirical or Lunar Lambert Empirical function phase curve
          list of brightness values corresponding to a set of phase angles
          defined in the PHASELIST parameter.  See
          "$ISISROOT/appdata/templates/photometry/marsred.pvl" for an example.
        </description>
        <default><item>No List</item></default>
        <internalDefault>
          No List
        </internalDefault>
      </parameter>
    </group>

    <group name="Atmospheric Model">
      <parameter name="ATMNAME">
        <type>combo</type>
        <brief>
          Atmospheric model to be used
        </brief>
        <description>
          This is the name of the atmospheric photometric function model to be
          applied. The models ending with "1" use a first order scattering
          approximation. Those ending with "2" use a second order scattering
          approximation, and are slower but more accurate than the first order
          scattering approximation.  The atmospheric correction can be used with
          only three atmospheric normalization models: albedoatm, shadeatm, and topoatm. See
          Kirk et al. (2001).
          <br/>
          <br/>
          <b>
            The table below are photometric parameter values for Mars,
            adopted from Tomasko et al. (1999):
          </b><br/>
          <table border="1">
            <tr>
            <th>Band</th>
            <th>Wha</th>
            <th>Hga</th>
            </tr>
            <tr>
            <td>Red</td>
            <td>0.95</td>
            <td>0.68</td>
            </tr>
            <tr>
            <td>Blue</td>
            <td>0.76</td>
            <td>0.78</td>
            </tr>
          </table>
          <br/>
        </description>
        <internalDefault>NONE</internalDefault>
        <default>
          <item>NONE</item>
        </default>
        <list>
          <option value="NONE">
            <brief>No Atmospheric Model</brief>
            <description>
              No atmospheric correction will be applied.
            </description>
            <exclusions>
              <item>HNORM</item>
              <item>BHA</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
              <item>HGA</item>
              <item>NULNEG</item>
            </exclusions>
          </option>

          <option value="ANISOTROPIC1">
            <brief>
              Anisotropic 1 atmospheric model
            </brief>
            <description>
              Uses Chandrasekhar's solution for anisotropic scattering described
              by a one-term Legendre polynomial.
            </description>
            <inclusions>
              <item>HNORM</item>
              <item>BHA</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
            </inclusions>
            <exclusions>
              <item>HGA</item>
            </exclusions>
          </option>
          <option value="ANISOTROPIC2">
            <brief>
              Anisotropic 2 atmospheric model
            </brief>
            <description>
              Uses Chandrasekhar's solution for anisotropic scattering described
              by a one-term Legendre polynomial.
            </description>
            <inclusions>
              <item>HNORM</item>
              <item>BHA</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
            </inclusions>
            <exclusions>
              <item>HGA</item>
            </exclusions>
          </option>
          <option value="HAPKEATM1">
            <brief>
              Hapke 1 Atmospheric Model
            </brief>
            <description>
              Provides an approximation for strongly anisotropic scattering that
              is similar to Hapke's model for a planetary surface. The
              Chandrasekhar solution for isotropic scattering is used for the
              multiple scattering terms, and a correction is made to the singly
              scattered light for anisotropic particle phase function. A
	      one-term Henyey Greenstein function is used.
            </description>
            <inclusions>
              <item>HNORM</item>
              <item>HGA</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
            </inclusions>
            <exclusions>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="HAPKEATM2">
            <brief>
             Hapke 2 atmospheric model
            </brief>
            <description>
              Provides an approximation for strongly anisotropic scattering that
              is similar to Hapke's model for a planetary surface. The
              Chandrasekhar solution for isotropic scattering is used for the
              multiple scattering terms, and a correction is made to the singly
              scattered light for anisotropic particle phase function. A one-term
	      Henyey Greenstein function is used.
            </description>
            <inclusions>
              <item>HNORM</item>
              <item>HGA</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
            </inclusions>
            <exclusions>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="ISOTROPIC1">
            <brief>
              Isotropic 1 atmospheric model
            </brief>
            <description>
              Uses Chandrasekhar's solution for isotropic scattering.
            </description>
            <inclusions>
              <item>HNORM</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
            </inclusions>
            <exclusions>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="ISOTROPIC2">
            <brief>
              Isotropic 2 atmospheric model
            </brief>
            <description>
              Uses Chandrasekhar's solution for isotropic scattering.
            </description>
            <inclusions>
              <item>HNORM</item>
              <item>TAU</item>
              <item>TAUREF</item>
              <item>WHA</item>
            </inclusions>
            <exclusions>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="NULNEG">
        <type>string</type>
        <brief>
          Specifies if negative values will be set to NULL
        </brief>
        <default><item>READFROMPVL</item></default>
        <description>
          This specifies if negative values after removal of atmospheric
          effects will be set to NULL.  Negative values are only generated
          in modes that include atmospheric correction and occur when the
          optical depth "tau" is overestimated, so that the atmospheric
          <def>radiance</def> subtracted from the image is brighter than the
          darkest observed pixels.  In this case "tau" should be decreased
          until no negative values are present in the output file.
        </description>
        <list>
          <option value="READFROMPVL">
            <brief>
              Get NULNEG value from the FROMPVL file
            </brief>
            <description>
              Retrieve and set the NULNEG parameter from the FROMPVL file.
	      An error is reported if a PVL file is not provided.
            </description>
          </option>
          <option value="NO">
            <brief>
              Do not set negative values to NULL
            </brief>
            <description>
              This option specifies not to set negative values to NULL after
              the removal of atmospheric effects.
            </description>
          </option>
          <option value="YES">
            <brief>
              Negative values will be set to NULL
            </brief>
            <description>
              This option specifies to set negative values to
              NULL after the removal of atmospheric effects.
            </description>
          </option>
        </list>
      </parameter>

      <parameter name="TAU">
        <type>string</type>
        <brief>
          Optical depth of atmosphere
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The normal optical depth of the atmosphere.
        </description>
        <minimum inclusive="yes">0.0</minimum>
      </parameter>

      <parameter name="TAUREF">
        <type>string</type>
        <brief>
          Reference value of tau
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The reference value of tau to which the image will be normalized.  This
          would normally be 0.0 unless one is interested in simulating a hazy
          atmosphere scene.
        </description>
        <minimum inclusive="yes">0.0</minimum>
      </parameter>

      <parameter name="HGA">
        <type>string</type>
        <brief>
          Henyey Greenstein coefficient
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The coefficient of single particle Henyey Greenstein phase
          function.  Henyey-Greenestein asymmetry parameter for atmospheric
          particle phase function, used in hapkeatm1 and hapkeatm2 atmospheric models.
          Not to be confused with corresponding parameter hg1 for the
          surface particles.
        </description>
        <minimum inclusive="no">-1.0</minimum>
        <maximum inclusive="no">1.0</maximum>
      </parameter>

      <parameter name="WHA">
        <type>string</type>
        <brief>
          Single scattering albedo
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The single scattering albedo of atmospheric particles.
        </description>
        <minimum inclusive="no">0.0</minimum>
        <maximum inclusive="yes">1.0</maximum>
      </parameter>

      <parameter name="BHA">
        <type>string</type>
        <brief>
          Legendre coefficient
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The coefficient of the single particle Legendre phase function.
          Coefficient of p1 (cosine) term of atmospheric particle phase
          function, used in anisotropic1 and anisotropic2 atmospheric models. Not to be confused
          with corresponding coefficient bh for the surface particles.
        </description>
        <minimum inclusive="yes">-1.0</minimum>
        <maximum inclusive="yes">1.0</maximum>
      </parameter>

      <parameter name="HNORM">
        <type>string</type>
        <brief>
          Atmospheric shell thickness
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The atmospheric shell thickness normalized to the planet
          radius, used to modify angles to get more accurate path lengths
          near the terminator (Ratio of scale height to the planetary
          radius).  For Mars MDIM2.1 mosaic "0.003" was defined, which is
          the only planet for which the atmospheric modes are currently
          used.
        </description>
        <minimum inclusive="yes">0.0</minimum>
      </parameter>
    </group>

    <group name="Normalization Model">
      <parameter name="NORMNAME">
        <type>combo</type>
        <brief>
          Normalization model to be used
        </brief>
        <description>
          This is the name of the normalization model to be performed
        <dl>
        <dt><b>FROMPVL </b></dt>
          <dd>
            Get normalization model from the PVL file.  If the parameter
            names and values are missing in the PVL file, then either add
            them to the PVL file, or enter the values at the command line,
            or use the GUI to enter the parameter values.
          </dd>
        <dt><b>ALBEDOATM </b></dt>
          <dd>
            Normalization with atmosphere. For each pixel, a model of
            atmospheric scattering is subtracted and a surface model is
            divided out, both evaluated at the actual geometry of the pixel.
            Then, the resulting value is multiplied by the surface function at
            the reference conditions and the atmospheric model at reference
            conditions is added. In normal usage, the reference condition has
            normal incidence (incref=0) and no atmosphere (tauref=0), but in
            some cases it may be desirable to normalize images to a different
            incidence angle or a finite optical depth to obtain a more uniform
            appearance. As with the albedo model, if topographic shading is
            present, it will be amplified more at high incidence angles and
            will not appear uniform.
          </dd>
        <dt><b>ALBEDO </b></dt>
          <dd>
              Normalization without atmosphere. Each pixel is divided by the
              model photometric function evaluated at the geometry of that
              pixel, then multiplied by the function at reference geometry with
              incidence and phase angles equal to incref and emission angle at 0
              degree. This has the effect of removing brightness variations due to
              incidence angle and showing relative albedo variations with the
              same contrast everywhere. If topographic shading is present, it
              will be amplified more in regions of low incidence angle and will
              not appear uniform.
          </dd>
        <dt><b>MIXED </b></dt>
          <dd>
              Normalization without atmosphere. This option is used to perform
              albedo normalization over most of the planet, but near the
              terminator it will normalize the topographic contrast to avoid
              the seams that can occur with the usual albedo normalization.
              The two effects will be joined seamlessly at the incidence angle set
              for incmat. Incmat must be adjusted to give the best equalization
              of contrast at all incidence angles.  The albedo parameter must
              also be adjusted so the topographically normalized regions at
              high incidence angle are set to an albedo compatible with the
              albedo-normalized data at lower incidence.
          </dd>
        <dt><b>MOONALBEDO </b></dt>
          <dd>
              Normalization without atmosphere specifically designed to work
              with lunar data using the LunarLambertMcEwen photometric function model.
              A photometric correction plus an albedo-dependent phase angle
              correction which varies with the value of each input DN will be
              applied.  The final output value is the reflectance at
              incidence and phase angles of 30 degrees, and emission angle of
              0 degrees. <br/><br/>
              The following are ISIS2 default values used in the past, but may
              be obsolete:<br/>
              <small><ul>
                <li>D = 0.14 </li>
                <li>E = -0.3575 * wavelength(WL) - 0.0607 if WL is less than 1.0:
                    otherwise -0.4179 </li>
                <li>F = 0.55 </li>

                <li>G2 = -0.9585 * WL + 0.98 if WL is less than 1.0:
                  otherwise 0.02 </li>
                <li>Xmul = 1.0 </li>
                <li>WL = get WL from labels </li>
                <li>H = 0.048 </li>
                <li>BSH1 = 19.89 - 59.58 * WL + 59.86 * WL**2 - 20.09 * WL**3 </li>
                <li>XB1 = -0.0817 </li>
                <li>XB2 = 0.0081 </li>
               </ul></small>
          </dd>
        <dt><b>SHADEATM </b></dt>
          <dd>
              Normalization with atmosphere. The surface photometric function is
              used to simulate an image by relief shading, just like the shade
              model, but the effects of atmospheric scattering are also included
              in the calculation.
          </dd>
        <dt><b>SHADE </b></dt>
          <dd>
              Normalization without atmosphere. The surface photometric function
              is evaluated at the geometry of the image in order to calculate a
              shaded relief image of the ellipsoid or DEM. The <def>radiance</def>
              of the model surface is set to albedo at incidence angle defined by
              incref and zero phase. The image data are not used.
           </dd>
        <dt><b>TOPOATM </b></dt>
          <dd>
              Normalization with atmosphere. As with the topo model, this option
              is used in the final step of a three-step  process: (1) normalize
              with the albedoatm model, incref=0, and tauref=0 to temporarily
              remove atmosphere and normalize albedo variations; (2) use
              divide filter to remove albedo variations and emphasize features;
              and (3) normalize with the topoatm model to undo the temporary
              normalization and equalize topographic shading.
          </dd>
        <dt><b>TOPO </b></dt>
          <dd>
              Normalization without atmosphere. This option is used to normalize
              the topographic shading to uniform contrast regardless of the
              incidence angle, and exagerates the albedo variations at large
              incidence angles. So, this model is used as part of a three-step
              process in which (1) the image is temporarily normalized for albedo;
              (2) a divide filter is applied to remove regional albedo variations and
              emphasize features; and (3) the image is renormalized with the
              topographic mode to reverse the first normalization and equalize
              topographic shading.  The reference state in the first step must
              have incref=0 because this is what is reversed in the final step.
              If there are no significant albedo variations, step (2) can be
              skipped but step (1) must not be skipped.
          </dd>
        </dl>
        <br />
        </description>
        <internalDefault>FROMPVL</internalDefault>
        <default>
          <item>FROMPVL</item>
        </default>
        <list>
          <option value="FROMPVL">
            <brief>Get model from PVL file</brief>
	          <description>
              Get the normalization model from the PVL file.  Add missing parameters to
              the PVL file, or enter the values at the command line, or use the GUI
	            to enter the values.
            </description>
            <exclusions>
              <item>INCREF</item>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>ALBEDO</item>
              <item>ATMNAME</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
              <item>HNORM</item>
              <item>TAU</item>
              <item>WHA</item>
              <item>NULNEG</item>
              <item>TAUREF</item>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="ALBEDOATM">
            <brief>
              Albedo normalization model with atmosphere
            </brief>
            <description>
              Albedo normalization with atmosphere. In normal usage, the reference
              condition has normal incidence (incref=0) and no atmosphere
              (tauref=0), but in some cases it may be desirable to normalize
              images to a different incidence angle or a finite optical depth to
              obtain a more uniform appearance.
            </description>
            <inclusions>
              <item>ATMNAME</item>
              <item>INCREF</item>
            </inclusions>
            <exclusions>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>ALBEDO</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
            </exclusions>
          </option>
          <option value="ALBEDO">
            <brief>
              Albedo normalization model
            </brief>
            <description>
              Albedo normalization without atmosphere. This has the effect of
              removing brightness variations due to incidence angle and showing
              relative albedo variations with the same contrast everywhere.
            </description>
            <inclusions>
              <item>INCREF</item>
              <item>THRESH</item>
              <item>ALBEDO</item>
            </inclusions>
            <exclusions>
              <item>ATMNAME</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
              <item>HNORM</item>
              <item>TAU</item>
              <item>WHA</item>
              <item>NULNEG</item>
              <item>TAUREF</item>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>

          <option value="MIXED">
            <brief>
              Mixed normalization model
            </brief>
            <description>
              Mixed normalization without atmosphere. Used for albedo normalization
              over most of the planet, but near the terminator it will normalize
              topographic contrast so the two effects will be joined seamlessly at
              incidence angle defined for the incmat parameter.
            </description>
            <inclusions>
              <item>INCREF</item>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>ALBEDO</item>
            </inclusions>
            <exclusions>
              <item>ATMNAME</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
              <item>HNORM</item>
              <item>TAU</item>
              <item>WHA</item>
              <item>NULNEG</item>
              <item>TAUREF</item>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="MOONALBEDO">
            <brief>
              Moon albedo normalization model
            </brief>
            <description>
              This model was designed specifically for use on lunar data without
              atmosphere. It will compute normalized albedo for the Moon, normalized
              to 0 degrees emission angle and 30 degrees illumination and phase angles.
            </description>
            <inclusions>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
            </inclusions>
            <exclusions>
              <item>ATMNAME</item>
              <item>INCREF</item>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>ALBEDO</item>
              <item>HNORM</item>
              <item>TAU</item>
              <item>WHA</item>
              <item>NULNEG</item>
              <item>TAUREF</item>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="SHADEATM">
            <brief>
              Shade normalization with atmosphere
            </brief>
            <description>
              The surface photometric function is used to simulate an image by
              relief shading, just like the shade model, but the effects of
              atmospheric scattering are also included in the calculation.
            </description>
            <inclusions>
              <item>ATMNAME</item>
              <item>INCREF</item>
              <item>ALBEDO</item>
            </inclusions>
            <exclusions>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
            </exclusions>
          </option>
          <option value="SHADE">
            <brief>
                Shade normalization model
            </brief>
            <description>
              Normalization without atmosphere. The surface photometric function
              is evaluated at the geometry of the image in order to calculate a
              shaded relief image of the ellipsoid or DEM. The <def>radiance</def>
              of the model surface is set to <def>albedo</def> at <def>incidence
              angle</def> defined for incref and zero phase. The image data is not used.
            </description>
            <inclusions>
              <item>INCREF</item>
              <item>ALBEDO</item>
            </inclusions>
            <exclusions>
              <item>ATMNAME</item>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
              <item>HNORM</item>
              <item>TAU</item>
              <item>WHA</item>
              <item>NULNEG</item>
              <item>TAUREF</item>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
          <option value="TOPOATM">
            <brief>
              Topographic normalization with atmosphere
            </brief>
            <description>
              Normalization with atmosphere. As with the topo atmospheric model,
	            this option is used in the final step of a three-step  process.
            </description>
            <inclusions>
              <item>ATMNAME</item>
              <item>INCREF</item>
              <item>ALBEDO</item>
            </inclusions>
            <exclusions>
              <item>INCMAT</item>
              <item>THRESH</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
            </exclusions>
          </option>
          <option value="TOPO">
            <brief>
              Topographic normalization model
            </brief>
            <description>
              Normalization without atmosphere. Used to normalize topographic
              shading to uniform contrast regardless of the incidence angle. Such a
              normalization would exagerate albedo variations at large incidence
              angles, so this model is used as part of a three-step process.
            </description>
            <inclusions>
              <item>INCREF</item>
              <item>THRESH</item>
              <item>ALBEDO</item>
            </inclusions>
            <exclusions>
              <item>ATMNAME</item>
              <item>INCMAT</item>
              <item>D</item>
              <item>E</item>
              <item>F</item>
              <item>G2</item>
              <item>XMUL</item>
              <item>WL</item>
              <item>H</item>
              <item>BSH1</item>
              <item>XB1</item>
              <item>XB2</item>
              <item>HNORM</item>
              <item>TAU</item>
              <item>WHA</item>
              <item>NULNEG</item>
              <item>TAUREF</item>
              <item>HGA</item>
              <item>BHA</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="INCREF">
        <type>string</type>
        <brief>
          Reference incidence angle
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the reference incidence angle to which the image will be
          normalized.  Most normalization modes attempt to normalize the
          appearance of the surface to a set of standard conditions, in
          particular, a fixed incidence angle given by the incref parameter.
          In most cases, a value of 0 degrees is used for albedo and albedoatm normalization
          modes, though 30 degrees is sometimes used.  Incref of 0 degrees is also
          the usual choice for specifying the albedo of shaded relief images
          calculated with shade and shadeatm normalization modes. Incref of 30 degrees
          is the standard value for topographic normalization modes topo and topoatm
          because topographic shading disappears at 0 degree incidence angle and
          cannot be normalized to this value.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="no">90.0</maximum>
      </parameter>

      <parameter name="INCMAT">
        <type>string</type>
        <brief>
          Photometric transition incidence angle
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This specifies the incidence angle where albedo normalization
          transitions to topographic normalization.  When mixed normalization mode
          is selected, the image will be normalized so that albedo variation is
          constant for small incidence angles and topographic shading is constant
          for large incidence angles.  This parameter must be set by trial and
          error to achieve the best appearance, because it depends on the relative
          amount of albedo variations and shading for any given planet or satellite.
          The value of the albedo parameter must also be adjusted for this mode to
          match the mean brightness of the high incidence angle region to that of
          the data at lower incidence angles.
        </description>
        <minimum inclusive="yes">0.0</minimum>
        <maximum inclusive="no">90.0</maximum>
      </parameter>

      <parameter name="THRESH">
        <type>string</type>
        <brief>
          Amplification threshold
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This sets upper limit on the amount of amplification in regions of small
          incidence angle.  Operating modes that involve topographic normalization
          topo, topoatm, and mixed options will amplify variations in the input image
          in regions of small incidence angle where the shading in the input image
          is weak.  Thresh is an upper limit on the amount of amplification that
          will be attempted.  If it is set too low, low-incidence areas of the image
          may appear bland, but if thresh is set too high these regions may contain
          amplified noise rather than useful shading information.
        </description>
      </parameter>

      <parameter name="ALBEDO">
        <type>string</type>
        <brief>
          Albedo
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The <def>albedo</def> to which the image will be normalized.  The value
          of the desired model albedo, used with shade, topo, mixed, shadeatm, and
          topoatm. This is the albedo (<def>I/F</def> value at <def>incidence angle</def>
          defined for incref and zero phase) used to simulate a shaded relief image
          when shade or shadeatm normalization models are used.  For the other modes,
          it is the albedo that the image will be normalized to have.  The program
          <i>stats</i> can be run to get  the average albedo of an input image, but
          for constructing mosaics the same value of albedo should be used for all
          images in order to achieve a uniform result.
        </description>
      </parameter>

      <parameter name="D">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
          phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="E">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
	  phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="F">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
	  phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="G2">
        <type>string</type>
        <brief>
          Albedo Normalization Parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
	  phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="H">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
	  phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="XMUL">
        <type>string</type>
        <brief>
          Radiance to reflectance or calibration factor
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is used to convert <def>radiance</def> to <def>reflectance</def>,
	  or apply a calibration fudge factor.
        </description>
      </parameter>

      <parameter name="WL">
        <type>string</type>
        <brief>
          Wavelength
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          The wavelength in micrometers of the image being normalized.
        </description>
      </parameter>

      <parameter name="BSH1">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
	  phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="XB1">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
          phase function normalization parameter.
        </description>
      </parameter>

      <parameter name="XB2">
        <type>string</type>
        <brief>
          Albedo normalization parameter
        </brief>
        <default><item>None Specified</item></default>
        <internalDefault>None Specified</internalDefault>
        <description>
          This is the empirically derived coefficient for the albedo dependent
          phase function normalization parameter.
        </description>
      </parameter>
      </group>
  </groups>

  <examples>
    <example>
      <brief>Photometric correction with any valid photometric angles</brief>
      <description>
        This example shows the photometric correction of a cube file using the
        hapkehen (Hapkehen) photometric model and the albedo normalization model
        without trimming the image data based on incidence or emission angle.
      </description>
      <terminalInterface>
        <commandLine>
         from=EW0131773041G_cal.cub to=EW0131773041G_cal_hapkehen_albedo.cub
         frompvl=photomG.pvl phtname=hapkehen theta=9 wh=0.218651 hg1=0.178965
         hg2=0.971493 hh=0.085 b0=2.7 normname=albedo incref=0 thresh=1e+31
         albedo=1.0
        </commandLine>
        <description>Run photomet with default maximum angles</description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/photomet_ex1_gui.png" width="600" height="982">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.  The default
              value for the MAXEMISSION and MAXINCIDENCE parameters is 90.0.
              The parameter values were loaded into the appropriate parameter
              names using the drop-down menu for the "FROMPVL" parameter name.
            </description>
            <thumbnail src="assets/thumbs/photomet_ex1_gui_thumb.png" caption="photomet GUI" width="183" height="300"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <dataFiles>
        <dataFile path="assets/photomG.pvl">
          <brief>Example of a PVL file</brief>
          <description>
            The PVL file contains the photometric parameters to be applied to the input
            cube file.  Load the PVL file parameters using the photomet GUI drop-down
            menu and add the additional required parameter value for "ALBEDO."
          </description>
          <parameterName>
            FROMPVL
          </parameterName>
        </dataFile>
      </dataFiles>
      <inputImages>
        <image src="assets/images/EW0131773041G_cal.png" width="496" height="496">
          <brief>Input file </brief>
          <description>
            Screenshot of the input image before the photometric correction has been
            performed.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_thumb.png" caption="Input image" width="200" height="200"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>
      <outputImages>
        <image src="assets/images/EW0131773041G_cal_hapkehen_albedo.png" width="496" height="496">
          <brief>Output file </brief>
          <description>
            Screenshot of the output image after the photometric correction.  Notice
            the features have consistent tones except near the limb where the pixels
            are brighter because it is over-corrected.  A histogram stretch is applied
            automatically when the image is displayed, so the image appears darker due
            to the higher DN values at the terminator.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_hapkehen_albedo_thumb.png" caption="Output image" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>
    <example>
      <brief>Photometric correction with mixed normalization option</brief>
      <description>
        This example shows the photometric correction of a cube file by using the
        hapkehen (Hapkehen) photometric model and mixed normalization model that
        performs an albedo normalization for most of the planet, and transitions
        to a topographic normalization at 75 degrees. Adjust the INCMAT
        parameter value to get the best equalization of contrast at all
        incidence angles.
      </description>
      <terminalInterface>
        <commandLine>
          0131773041G_cal.cub to=EW0131773041G_cal_hapkehen_mixed.cub
         frompvl=photomG.pvl phtname=hapkehen theta=9 wh=0.218651 hg1=0.178965
         hg2=0.971493 hh=0.085 b0=2.7 normname=mixed incref=0 incmat=75
         thresh=30.0 albedo=0.0
        </commandLine>
        <description>Run photomet with hapkehen photometric model and mixed normalization model.</description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/photomet_ex2_gui.png" width="549" height="900">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.  The default
              value for MAXEMISSION and MAXINCIDENCE parameters is 90.0,
              but the INCMAT parameter is set to 75 degrees.
            </description>
            <thumbnail src="assets/thumbs/photomet_ex2_gui_thumb.png" caption="photomet GUI" width="183" height="300"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <dataFiles>
        <dataFile path="assets/photomG.pvl">
          <brief>Example of the PVL file</brief>
          <description>
            The PVL file containing the photometric parameters to be applied to the input
            cube.  Load the PVL file parameters using the photomet GUI and add
            additional required parameter values for "INCMAT" and "ALBEDO."
          </description>
          <parameterName>
            FROMPVL
          </parameterName>
        </dataFile>
      </dataFiles>
      <inputImages>
        <image src="assets/images/EW0131773041G_cal.png" width="496" height="496">
          <brief>Input file </brief>
          <description>
            Screenshot of the input image before the photometric correction has been
            performed.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_thumb.png" caption="Input image" width="200" height="200"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>
      <outputImages>
        <image src="assets/images/EW0131773041G_cal_hapkehen_mixed.png" width="496" height="496">
          <brief>Output file </brief>
          <description>
            Screenshot of the output image after the photometric correction.  Notice
            the limb area was over-corrected in the previous example, but now
            shows more consistent tones in the output image.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_hapkehen_mixed_thumb.png" caption="Output image" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>
    <example>
      <brief>Photometric correction with mixed normalization and trim options</brief>
      <description>
        This example shows the photometric correction of a cube file using the hapkehen
        (Hapkehen) photometric model and a mixed normalization model that
        performs an albedo normalization for most of the planet, but will also
        trim the image data beyond 75.0 degrees incidence angle.  This is to show where the
        transition between the two types of normalization occurred in the previous
        example.
      </description>
      <terminalInterface>
        <commandLine>
          from=EW0131773041G_cal.cub to=EW0131773041G_cal_hapkehen_mixed_trim_at75.cub
          frompvl=photomG.pvl maxincidence=75 phtname=hapkehen theta=9 wh=0.218651
          hg1=0.178965 hg2=0.971493 hh=0.085 b0=2.7 normname=mixed incref=0 incmat=75
          thresh=30.0 albedo=0.0
        </commandLine>
        <description>
          Run photomet with hapkehen photometric model and mixed normalization model,
          and trim at 75.0 degree incidence angle.
        </description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/photomet_ex3_gui.png" width="549" height="900">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.  The MAXEMISSION is set
              to 90.0; the MAXINCIDENCE and INCMAT parameters are set to 75.0 degrees.
            </description>
            <thumbnail src="assets/thumbs/photomet_ex3_gui_thumb.png" caption="photomet GUI settings" width="183" height="300"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <dataFiles>
        <dataFile path="assets/photomG.pvl">
          <brief>Example of the PVL file</brief>
          <description>
            The PVL file containing the photometric parameters to be applied to the input
            cube file.  Load the PVL file parameters using the photomet GUI and add
            additional required parameter values for "INCMAT" and "ALBEDO."
          </description>
          <parameterName>
            FROMPVL
          </parameterName>
        </dataFile>
      </dataFiles>
      <inputImages>
        <image src="assets/images/EW0131773041G_cal.png" width="496" height="496">
          <brief>Input file </brief>
          <description>
            Screenshot of the input image before the photometric correction has been
            performed.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_thumb.png" caption="Input image" width="200" height="200"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>
      <outputImages>
        <image src="assets/images/EW0131773041G_cal_hapkehen_mixed_trim_at75deg.png" width="1024" height="1024">
          <brief>Output file </brief>
          <description>
            Screenshot of the output image after the photometric correction.  Notice
            the limb area, where it was over-corrected in the first example, has been
            trimmed.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_hapkehen_mixed_trim_at75_thumb.png" caption="Output image" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>

   <example>
      <brief>Photometric correction using maximum emission and incidence angle parameters</brief>
      <description>
        This example shows the photometric correction of a cube file by setting the maximum
        emission angle to 75.0 degrees and the maximum incidence angle to 85.0 degrees.  The
        photometric model and normalization model along with the parameter values are
        defined in the input PVL file.  This example uses a PVL file that follows the
        format for a previous ISIS release.  The photomet program will recognize some older
        formats and parameter names, but if an error is returned, then update the settings
        using the latest parameter names and/or options listed in the tables under "DESCRIPTION."
      </description>
      <terminalInterface>
        <commandLine>
          from=input.cub frompvl=input.pvl to=output.cub maxemission=75.0 maxincidence=85.0
        </commandLine>
        <description>
          Run photomet with maximum emission and incidence angles less than the
          default value of 90 degrees.
        </description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/photomet_ex4_gui.png " width="549" height="900">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.  Notice the
              MAXEMISSION and MAXINCIDENCE parameters are changed from the
              default value of 90.0.
            </description>
            <thumbnail src="assets/thumbs/photomet_ex4_gui_thumb.png" caption="photomet GUI" width="183" height="300"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <dataFiles>
        <dataFile path="assets/input.pvl">
          <brief>Input PVL file</brief>
          <description>
            The PVL file contains the input photometric parameters for the input
            file.
          </description>
          <parameterName>
            FROMPVL
          </parameterName>
        </dataFile>
      </dataFiles>
      <inputImages>
        <image src="assets/images/input.jpg" width="547" height="550">
          <brief>Input file </brief>
          <description>
            Screenshot of the input image before the photometric correction has been
            performed.
          </description>
          <thumbnail src="assets/thumbs/inputthumb.jpg" caption="Input image" width="199" height="200"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>
      <outputImages>
        <image src="assets/images/output4.jpg" width="547" height="550">
          <brief>Output file </brief>
          <description>
            Screenshot of the output image after the photometric correction.  Notice
            the output image has been trimmed based on the photometric angles
            defined by the user.
          </description>
          <thumbnail src="assets/thumbs/output4thumb.jpg" caption="Output image" width="199" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>

    <example>
      <brief>Photometric correction using maximum emission and incidence angle parameters as
        well as anglesource and usedem parameters.</brief>
      <description>
        <p>
        This example shows the photometric correction of a cube file by setting the maximum
        emission angle to 75.0 degrees and the maximum incidence angle to 85.0 degrees.  The photometric
        model being used is MINNAERT and the normilization model is ALBEDO.
        The usedem parameter is describing how to trim the image. In this case the trimming is being done using the
        radius obtained from the DEM. The anglesource parameter describes how to calculate the photometric angles. In
        this example the calculation is also being done using the DEM.
      </p>
      </description>
      <terminalInterface>
        <commandLine>
          photomet from=uncropped.cub to=TrimmedTestAngleSourceDemUsedemFalse.cub maxemission=87.0 anglesource=dem
          phtname=minnaert k=0.5 normname=albedo incref=0 incmat=80 thresh=30 albedo=1.0
        </commandLine>
        <description>
          Run photomet with maximum incidence at 90 degrees and maximum emission less than 90 degrees.
          Photometric model is MINNAERT and normilization model is ALBEDO.
          Usedem is false and anglesource is set to DEM.
        </description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/Example5GUI.png " width="772" height="1229">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.  Notice the
              MAXEMISSION has changed from the default value of 90.0, usedem is set to it's default,
              and anglesource is set to DEM.
            </description>
            <thumbnail src="assets/thumbs/Example5GUI_thumb.png" caption="photomet GUI" width="176" height="300"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <inputImages>
        <image src="assets/images/usedemInput.png" width="497" height="497">
          <brief>Input file </brief>
          <description>
            Screenshot of the input image before the photometric correction has been
            performed.
          </description>
          <thumbnail src="assets/thumbs/usedemInput_thumb.png" caption="Input image" width="200" height="200"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>
      <outputImages>
        <image src="assets/images/photometUsedem.png" width="497" height="497">
          <brief>Output file </brief>
          <description>
            Screenshot of the output image after the photometric correction.  Notice
            the output image has been trimmed based on the photometric angles
            defined by the user.
          </description>
          <thumbnail src="assets/thumbs/photometUsedem_thumb.png" caption="Output image" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>

   <example>
      <brief>Photometric corrections using a three-step approach for MDIM2.1 of Mars</brief>
      <description>
        A multistep process is used to apply photometric correction to Mars images:
        <ol>
          <li>
            Photomet is run in albedo mode, which decreases brightness variations across
            the individual image and removes the additive atmospheric contribution, if any;
          </li>
          <li>
            The output image from step 1 is divided by a low-pass-filtered version of itself,
            which removes albedo variations if they have broader spatial scales than topographic
            shading as is often the case; and
          </li>
          <li>
            Photomet is run again on the output image of step 2 in topography mode, which
            undoes the albedo normalization of the first pass and then applies the topographic
            normalization.
          </li>
        </ol>
        The final result would need to be equalized and  mosaicked together.
      </description>
      <dataFiles>
        <dataFile path="assets/photomet_3_steps_processing.cmd">
          <brief>Sample script</brief>
          <description>
            This script contains the three-step processing sequence of programs that need to
            be executed for the three test images.
          </description>
          <parameterName>
            Not applicable
          </parameterName>
        </dataFile>
      </dataFiles>
      <outputImages>
        <image src="assets/images/photomet_ex5_3step_process.png" width="1226" height="1334">
          <brief>Collage of images</brief>
          <description>
            The images shown are subareas at 1:1 scale to emphasize the result of the
            photometric correction at each stage.  There are four rows in the image
            collage containing the following:<br/>
            <ul>
              <li>
                Row 1 - Calibrated images without photometric correction<br/>
              </li>
              <li>
                Row 2 - Applied Hapkehen photometric model, albedoatm normalization
                model and an hapkeatm2 atmospheric model<br/>
              </li>
              <li>
                Row 3 - Applied a divide filter
              </li>
              <li>
                Row 4 - Applied Hapkehen photometric model, topoatm normalization
                model and an hapkeatm2 atmospheric model<br/>
              </li>
            </ul>
         </description>
         <thumbnail src="assets/thumbs/photomet_ex5_3step_process_thumb.png" caption="Input and output images" width="276" height="300"/>
       </image>
      </outputImages>
    </example>

  </examples>
</application>
