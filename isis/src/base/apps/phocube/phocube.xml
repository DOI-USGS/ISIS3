<?xml version="1.0" encoding="UTF-8"?>

<application name="phocube" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:noNamespaceSchemaLocation=
"http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>
    Create photometric and geometric information bands for an image cube
  </brief>

  <description>
  <p>
    This program, phocube, creates backplane bands that contain photometric, geometric, and
    spacecraft instrument information for an image file.  The parameter options
    range from photometric angles (incidence, emission, and phase) to various
    <def line="Azimuth">azimuth</def> angles, and options based on spatial
    (latitude, longitude, and resolution) information. This program will
    not work on <def>Level1</def> images without a camera model, or on mosaics.
    The input image pixels are not propagated to the output file unless the
    user selects the "DN" option. The following is a partial list of how users have made use of
    band output:
    <ul>
      <li>Evaluate the individual bands in order to establish subsequent
          image processing steps</li>
      <li>Specify as input to other ISIS programs such as fx and photomet</li>
      <li>Demonstrate the result of each selected option</li>
      <li>Determine how the images are mosaicked together after the
          Level2 images are created from the Level1 images with backplanes </li>
    </ul>
  </p>
  <p>
    All ISIS applications default to the following geometric reference if a camera model exists:
    <ul>
      <li>Longitude Domain = 360, longitude range reported from 0 to 360</li>
      <li>Latitude System = Ocentric</li>
      <li>Longitude Direction = East, longitude increases to the east</li>
    </ul>
  </p>
  <p>
    There are instances where the local emission angle and the local incidence angle will have
    values over 90 degrees.  ISIS allows the computation of emission and incidence angles greater
    than 90 degrees.   This feature allows representation of viewing and illumination conditions
    where there is actual target body surface data beyond the limb or deep terminator boundary
    areas.  Applications such as photomet that applies photometric functions honor the 90-degree
    boundary.    Applications such as photrim can be applied to the phocube output to replace the
    angle values above 90 degrees to NULL.  There are certain processes that need these data,
    therefore it is allowed.
  </p>
  <p>
    This program requires a <def>Level1</def> file that has a successful
    "<i>spiceinit</i>" applied to it, or a <def>Level2</def> image
    cube file.  For every valid input pixel, an output pixel is computed
    based on either the <def>SPICE</def> information, or the
    <def link="Map Projection">map projected</def> spatial information,
    or a pre-defined equation.
  </p>
  <p>
    The parameters "morphologyRank" and "albedoRank" are specifically designed to be used
    by the ISIS mosaic programs.  A mosaic program will automatically compare
    two pixel values to determine how each pixel is mosaicked into an output
    file, which depends on whether a morphology-based or an albedo-based
    product is desired.  The program computes a
    <def link="Digital Number">DN</def> value for every input pixel based on
    the formulas listed below and outputs the value to a backplane band.
    These backplane bands are used by the ISIS mosaic programs.  The following are
    equations for "morphologyRank" and "albedoRank" options:
  <blockquote>
  <dl>
    <dt>  MorphologyRank </dt>
    <dd>Equation = <def>PixelResolution</def>/cos(EmissionAngle)</dd>
    <dt>  AlbedoRank </dt>
    <dd>Equation = PixelResolution * [(1/cos(<def>EmissionAngle</def>)) +
    (1/cos(<def>IncidenceAngle</def>))]</dd>
  </dl>
  </blockquote>
  </p>
  <p>
    All the options in <i>phocube</i> are applicable if the input file is a Level1
    image and has a camera model associated with the file.  If the input file
    is a map-projected Level2 image, only a few options are appropriate
    and available for selection. <br /><br />

    The following options are available for Level1 images that contain a camera model:
     <ul>

     <li><def link="Digital Number">DN</def></li>
     <li><def link="Emission Angle">EMISSION</def></li>
     <li><def link="Incidence Angle">INCIDENCE</def></li>
     <li><def link="Phase Angle">PHASE</def></li>
     <li><def link="Off Nadir Angle">OFFNADIRANGLE</def></li>

     <li><def link="Local Emission Angle">LOCALEMISSION</def></li>
     <li><def link="Local Incidence Angle">LOCALINCIDENCE</def></li>

     <li><def link="Latitude">LATITUDE</def></li>
     <li><def link="Longitude">LONGITUDE</def></li>
     <li><def link="Detector Resolution">DETECTORRESOLUTION</def></li>
     <li><def link="Oblique Detector Resolution">OBLIQUEDETECTORRESOLUTION</def></li>
     <li><def link="Pixel Resolution">PIXELRESOLUTION</def></li>
     <li><def link="Line Resolution">LINERESOLUTION</def></li>
     <li><def link="Sample Resolution">SAMPLERESOLUTION</def></li>
     <li><def link="North Azimuth">NORTHAZIMUTH</def></li>
     <li><def link="Sun Azimuth">SUNAZIMUTH</def></li>
     <li><def link="Spacecraft Azimuth">SPACECRAFTAZIMUTH</def></li>
     <li><def link="SubSpacecraft Ground Azimuth">SUBSPACECRAFTGROUNDAZIMUTH</def></li>
     <li><def link="Subsolar Ground Azimuth">SUBSOLARGROUNDAZIMUTH</def></li>
     <li>MORPHOLOGYRANK</li>
     <li>ALBEDORANK</li>
     <li><def link="Body Fixed Coordinate">BODYFIXED</def></li>
     <li>RADEC (<def link="Right Ascension">Right Ascension</def>, <def link="Declination">Declination</def> )</li>
     <li><def link="Local Solar Time">LOCALTIME</def></li>
     <li>SUNILLUMINATIONMASK</li>
     <li>SURFACEOBLIQUEDETECTORRESOLUTION</li>
     </ul>
       The following options are available for Level2 images:
     <ul>
     <li>DN</li>
     <li>LATITUDE</li>
     <li>LONGITUDE</li>
     <li>PIXELRESOLUTION</li>
     </ul>
  </p>
  <p>
    The BandBin group keywords are updated in the labels of the output cube
    file. The keyword "Name" within the BandBin group,
    shown below, is populated with the name of each option selected by the
    user as bands.  These bands can be referenced by their names in
    applications such as
    "<i>mapmos</i>"
    and
    "<i>qview</i>."
    <blockquote>
    <pre>
    <b>Example:</b>

    phocube from=EW0131773041G_cal.cub to=EW0131773041G_cal.pho.cub morph=true dn=true

    <b>Sample of image label:</b>

    Group = Dimensions
      Samples = 1024
      Lines   = 1024
      <b>Bands   = 7 </b>
    End_Group
    <b>
    Group = BandBin
      Name   = ("750 BW 5", "Phase Angle", "Emission Angle", "Incidence Angle",
          Latitude, Longitude, Morphology)
      Number = (7, 7, 7, 7, 7, 7, 7)
      Center = (748.7, 748.7, 748.7, 748.7, 748.7, 748.7, 748.7)
      Width  = (5.1, 5.1, 5.1, 5.1, 5.1, 5.1, 5.1)
    End_Group
    </b>

    Note:  The first band retained the BandBin Name value from the input file.
    The program has "Phase Angle," "Emission Angle," "Incidence Angle,"
    "Latitude," and "Longitude" options pre-selected.
    </pre>
   </blockquote>
  </p>
  <p>
    If the backplane bands generated by phocube are used in the mosaic
    programs and the mosaic requires the input image pixel, the "DN"
    parameter name must be set to "true" in phocube.  When backplane
    bands are used in the
    "<i>fx</i>"
    or
    "<i>photomet</i>"
    program, it is not necessary to propagate the input image to the output
    file.
  </p>
  </description>

  <oldName>
    <item>lev1geoplane</item>
    <item>levgeoplane</item>
    <item>geoback</item>
  </oldName>

  <seeAlso>
    <applications>
      <item>spiceinit</item>
      <item>mapmos</item>
      <item>qview</item>
      <item>fx</item>
      <item>photomet</item>
      <item>automos</item>
    </applications>
  </seeAlso>

  <liens>
    <item>Add resolution to possible outputs</item>
    <item>Convert to an IsisProcessBySpectra when it gets written</item>
  </liens>

  <history>
    <change name="Unknown" date="1999-02-11">
      Original version.
    </change>
    <change name="Stuart Sides" date="2003-06-04">
      Converted to ISIS3, and made it create a cube rather than adding
      backplanes.
    </change>
    <change name="Stuart Sides" date="2003-07-29">
      Modified filename parameters to be cube parameters where necessary.
    </change>
    <change name="Stuart Sides" date="2005-09-09">
      Fixed problem where the program threw an error when it tried to propagate
      the pixel type from the input file.
    </change>
    <change name="Stuart Sides" date="2005-09-09">
      Added the bandbin group to the cube labels.
    </change>
    <change name="Jeff Anderson" date="2005-09-20">
      Fixed a bug with switched samples and lines.
    </change>
    <change name="Elizabeth Miller" date="2005-10-05">
      Moved into Photometry and Radiometry category.
    </change>
    <change name="Elizabeth Miller" date="2006-05-23">
      Modified to use ProcessByBrick instead of ProcessByLine to make faster.
    </change>
    <change name="Brendan George" date="2006-09-21">
      Documentation fixes.
    </change>
    <change name="Steven Lambright" date="2008-05-13">
      Removed references to CubeInfo.
    </change>
    <change name="Steven Koechle" date="2008-08-19">
      Added new parameters: PIXELRESOLUTION, LINERESOLUTION,
      SAMPLERESOLUTION, DETECTORRESOLUTION, NORTHAZIMUTH,
      SUNAZIMUTH, SPACECRAFTAZIMUTH, OFFNADIRANGLE.
    </change>
    <change name="Steven Lambright" date="2009-03-06">
      Fixed a bug that occurred when processing band-dependent cubes.
    </change>
   <change name="Kris Becker" date="2009-05-29">
      Added the propagation of the input cube labels, objects, blobs, etc..., so
      the pedigree of the input source is retained.
    </change>
    <change name="Sharmila Prasad" date="2009-07-17">
      Set the defaults for PIXELRESOLUTION, LINERESOLUTION,
      SAMPLERESOLUTION, DETECTORRESOLUTION, NORTHAZIMUTH,
      SUNAZIMUTH, SPACECRAFTAZIMUTH, and OFFNADIRANGLE to FALSE.
    </change>
    <change name="Mackenzie Boyd" date="2010-10-29">
      Added parameters/bands SUBSPACECRAFTGROUNDAZIMUTH and
      SUBSOLARGROUNDAZIMUTH.
    </change>
    <change name="Travis Addair" date="2011-02-10">
      Added parameters LOCALINCIDENCE and LOCALEMISSION.
    </change>
    <change name="Kris Becker" date="2011-08-08">
      Added the option to propagate the input pixel value (DN)
      as the first band (however, this, by default, will not be invoked as default so as to
      preserve pre-existing behavior). Ensure the Center, OriginalBand, Name, and
      Width BandBin  keyword values are populated properly and propagated to
      the output label (should support camera models). Added MORPHOLOGY and
      ALBEDO backplane options for special mosaic options.
    </change>
    <change name="Janet Barrett" date="2012-02-22">
      Added the capability to run this program on image files where the camera
      information is missing. The ability to generate lat/lon bands for
      image files is highly useful when performing fx operations on the files.
      Other bands that can be created for a mosaic file include: Dn and PixelResolution.
      A new parameter, SOURCE, was added so that the user can specify
      if their image does not contain a camera model. This will result in the
      appropriate parameter choices being greyed out. If the user does not specify
      that their file does not contain a camera model, then they will receive an error
      if they choose to create a band that cannot be created for the file.
    </change>
    <change name="Debbie A. Cook" date="2012-07-06">
       Updated Spice members to be more compliant with ISIS coding standards. References #972.
    </change>
    <change name="Ella Mae Lee" date="2012-11-15">
       Improved documentation, fixes #1254.
    </change>
    <change name="Tracie Sucharski" date="2012-12-06">
      Changed to use TProjection instead of Projection.  References #775
    </change>
    <change name="Tracie Sucharski" date="2013-01-10">
      Allow input cubes without the BandBin label group.  Fixes #929.
    </change>
    <change name="Lynn Weller" date="2013-02-25">
      Removed links to applications imbedded in text and replaced with
      italicized application name.  Added application links to the
      "Related Objects and Documents" section of the documentation.
      Fixes mantis ticket #1525.
    </change>
    <change name="Kimberly Oyama" date="2013-11-20">
      The error thrown when the input is a projected image was misleading. It has been fixed to
      be more helpful for the user. Fixes #923.
    </change>
    <change name="Makayla Shepherd" date="2015-02-06">
      Updated documentation. Fixes #1001.
    </change>
    <change name="Makayla Shepherd" date="2015-07-02">
      Added Ra/Dec and Body Fixed Coordinates options to help create new camera models and help
      with mission team operations. References #2277.
    </change>
    <change name="Tyler Wilson" date="2016-08-17">
      Added an ObliqueDetectorResolution band.  This is an improvement over the previous DetectorResolution
      function (particularly for images taken near the limb of the target).  References #476, #4100.
    </change>
    <change name="Kaj Williams" date="2017-06-09">
      Renamed albedo to albedoRank, and morph (or morphology) to morphRank (or MorphologyRank). Ref #4008.
    </change>
    <change name="Kaitlyn Lee" date="2019-02-15">
      Allowed RA and DEC to be exported regardless if the pixel is off body. Fixes #4446.
    </change>
    <change name="Kaitlyn Lee" date="2020-06-04">
      Added SPECIALPIXELS parameter to allow users to skip calculations on special pixels, excluding
      RA and DEC. This changed merged the two process functions, which were created to speed up
      the application when copying over DN values. After a few time tests, it doesn't look like the
      merge causes the application to run longer. Changed the process function to be a lambda function
      to get rid of global variables.
    </change>
    <change name="Kristin Berry" date="2020-06-10">
      Added the LOCALTIME parameter to output a band with the local solar time for each pixel. Fixes #3850
    </change>
    <change name="Kaitlyn Lee" date="2020-03-15">
      Converted application and tests for Gtest conversion.
    </change>
    <change name="Stuart Sides" date="2021-06-01">
      Add ALLDNS parameter to propagate all input bands to the output instead of just one band.
    </change>
    <change name="Adam Paquette" date="2020-08-23">
      Added initial slope and backplane options for the local normal and the
      ellipsoid normal.
    </change>
    <change name="Ken Edmundson" date="2024-04-24">
      Added Sunilluminationmask and SurfaceObliqueDetectorResolution backplanes.
      SurfaceObliqueDetectorResolution is in addition to the existing
      ObliqueDetectorResolution. The difference is that ObliqueDetectorResolution
      uses the local emission angle while SurfaceObliqueDetectorResolution uses
      the emission angle calculated from the ellipsoid. Sunilluminationmask and
      SurfaceObliqueDetectorResolution were added to the U. of Arizona code base
      by the UA/OSIRIS-REx IPWG Team on 2018-09-19 and 2019-03-29 respectively.
    </change>
  </history>

  <category>
    <categoryItem>Radiometric and Photometric Correction</categoryItem>
    <categoryItem>Cameras</categoryItem>
  </category>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>cube</type>
        <fileMode>input</fileMode>
        <brief>
          Input cube file
        </brief>
        <description>
          This is the input filename.  The input image cube can be a <def>Level1</def>
          or <def>Level2</def> file.  For a Level1 image, spiceinit
          must be successfully applied before running phocube.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>

      <parameter name="TO">
        <type>cube</type>
        <pixelType>real</pixelType>
        <fileMode>output</fileMode>
        <brief>
          Output cube file
        </brief>
        <description>
          This is the output file name.  The cube file will contain a band for
          each of the selected options.  The BandBin Group in the image labels
          of the output cube file will be updated with the "Name" keyword
          containing the output band names (options) in the order that they are
          stacked within the cube.
        </description>
      </parameter>

      <parameter name="SOURCE">
        <type>string</type>
        <brief>Specifies the source of the geometric information</brief>
        <default><item>CAMERA</item></default>
        <description>
          Specifies whether the geometric information will be obtained from the
          camera model or from the map projection.  If this parameter is set to CAMERA,
          all band options are available for the user to select. If this
          parameter is set to PROJECTION, then only DN, LATITUDE, LONGITUDE, and
          PIXELRESOLUTION band options are available and all other options
          will be greyed out. If the user sets this parameter to CAMERA and
          the input file does not contain a camera model or SPICE information,
          then an error message will occur.
        </description>
        <list>
          <option value="CAMERA">
            <brief>Get the geometric information from camera model</brief>
            <description>
              The geometric information is obtained from a camera model and
              all band options are available for selection.
            </description>
          </option>
          <option value="PROJECTION">
            <brief>Get the geometric information based on map projection information</brief>
            <description>
              The geometric information is obtained based on the label
              keyword values stored under the "Mapping" group in the image
              labels.  Only DN, LATITUDE, LONGITUDE, and PIXELRESOLUTION
              band options are available.
            </description>
            <exclusions>
              <item>PHASE</item>
              <item>EMISSION</item>
              <item>INCIDENCE</item>
              <item>LOCALEMISSION</item>
              <item>LOCALINCIDENCE</item>
              <item>LINERESOLUTION</item>
              <item>SAMPLERESOLUTION</item>
              <item>DETECTORRESOLUTION</item>
              <item>OBLIQUEDETECTORRESOLUTION</item>
              <item>SUNAZIMUTH</item>
              <item>SPACECRAFTAZIMUTH</item>
              <item>OFFNADIRANGLE</item>
              <item>SUBSPACECRAFTGROUNDAZIMUTH</item>
              <item>SUBSOLARGROUNDAZIMUTH</item>
              <item>MORPHOLOGYRANK</item>
              <item>ALBEDORANK</item>
              <item>NORTHAZIMUTH</item>
              <item>RADEC</item>
              <item>BODYFIXED</item>
              <item>LOCALTIME</item>
              <item>SUNILLUMINATIONMASK</item>
              <item>SURFACEOBLIQUEDETECTORRESOLUTION</item>
            </exclusions>
          </option>
        </list>
      </parameter>
    </group>

    <group name="Photometry">
      <parameter name="SPECIALPIXELS">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>Include special pixels in the output image</brief>
        <description>
          Controls the output of the values phocube calculates based on the DN from the first band.
          If this parameter is true, phocube will always attempt to calculate values for the requested bands.
          If this parameter is false, and the DN is a special pixel value, phocube will not
          calculate values, and will instead place ISIS Null values in all requested photometry bands.
          The DN bands, if requested, will be transferred to the output cube regardless of this setting.
        </description>
      </parameter>
      <parameter name="DN">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Propagate the input pixel to the output file</brief>
        <description>
          This parameter specifies whether the input image pixel value
          (<def link="Digital Number">DN</def>) will be propagated to
          the output file.  The DN parameter must be set to "true,"
          if the output product created is expected to contain the input
          image information.
        </description>
      </parameter>
      <parameter name="ALLDNS">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Propagate all of the input pixel DNs to the output file</brief>
        <description>
          <p>
            If this parameter is true, all the <def link="Digital Number">DN</def> values
            from all of the bands in the input image, subject to the input cube attribute,
            will be propagated to the output file.
            Calculations for the other bands that require a sensor model (e.g., phase) will be
            based on the first band, again subject to the cube attribute.
            This doesn't affect the values calculated for those bands when the
            input image bands are spatially aligned,
            but it is very import when the bands of the input image are not
            spatially aligned (e.g., Level 1, Odyssey, Themis IR).
            Use the input cube attribute to select the band used to calculate
            the other phocube values (e.g., ThemisIR.cub+9,1-5).
            The geometry of the first band or the first band in the input attribute,
            will be used to calculate the phocube values.
            NOTE: If the DN parameter is also set then ALLDNS will take precedence,
            and DN will be ignored.
          </p>
        </description>
      </parameter>
      <parameter name="PHASE">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>Create a phase angle band</brief>
        <description>
          If this parameter is true, the <def>Phase Angle</def> will be
          computed for every pixel and placed in a band in the output cube.
          The output cube labels will contain "Phase Angle" in the BandBin
          group, in band sequence of the output file.  Phase angles are in degrees.
        </description>
      </parameter>
      <parameter name="EMISSION">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>Create an emission angle band</brief>
        <description>
          If this parameter is true, the <def>Emission Angle</def> will be
          computed  for every pixel and placed in a band in the output cube.
          The output cube labels will contain "Emission Angle" in the BandBin
          group, in band sequence of the output file.  Emission angles are in degrees. There are
          certain cases where the emission angle is over 90 degrees. This is allowed as there
          are processes that need these data. See main description for details.
        </description>
      </parameter>
      <parameter name="INCIDENCE">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>Create an incidence angle band</brief>
        <description>
          If this parameter is true, the <def>Incidence Angle</def> will be
          computed for every pixel and placed in a band in the output cube.
          The output cube labels will contain "Incidence Angle" in the BandBin
          group, in band sequence of the output file.  Incidence angles are in degrees. There are
          certain cases where the incidence angle is over 90 degrees. This is allowed as there
          are processes that need these data. See main description for details.
        </description>
      </parameter>
      <parameter name="LOCALEMISSION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a local emission angle band</brief>
        <description>
          If this parameter is true, the <def link="local emission angle"
          >Local Emission Angle</def>  will be computed for every pixel
          and placed in a band in the output cube.  The output cube labels
          will contain "Local Emission Angle" in the BandBin group, in band
          sequence of the output file.  LocalEmissionAngle is in degrees. There are certain
          cases where the local emission angle is over 90 degrees. This is allowed as there
          are processes that need these data. See main description for details.
        </description>
      </parameter>
      <parameter name="LOCALINCIDENCE">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a local incidence angle band</brief>
        <description>
          If this parameter is true, the <def link="Local Incidence Angle">Local
          Incidence Angle</def> will be computed for every pixel and placed in
          a band in the output cube.  The output cube labels will contain
          "Local Incidence Angle" in the BandBin group, in band sequence
          of the output file.  LocalIncidenceAngle is in degrees. There are certain
          cases where the local incidence angle is over 90 degrees. This is allowed as there
          are processes that need these data. See main description for details.
         </description>
      </parameter>
      <parameter name="LATITUDE">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>Create a latitude band</brief>
        <description>
          If this parameter is true, the latitude value will be computed for
          every pixel and placed in a band in the output cube.  The output cube
          labels will contain "Latitude" in the BandBin group, in band sequence
          of the output file.  Latitude is in degrees.
        </description>
      </parameter>
      <parameter name="LONGITUDE">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>Create a longitude band</brief>
        <description>
          If this parameter is true, the longitude value will be computed for
          every pixel placed in a band in the output cube.  The output cube
          labels will contain "Longitude" in the BandBin group, in band
          sequence of the output file.  Longitude is in degrees.
        </description>
      </parameter>
      <parameter name="PIXELRESOLUTION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a pixel resolution band</brief>
        <description>
          If this parameter is true, the <def>Pixel Resolution</def>
          will be computed for every pixel and placed in a band in the output
          cube.  The output cube labels will contain "Pixel Resolution" in the
          BandBin group, in band sequence of the output file. PixelResolution
          is in meters.
        </description>
      </parameter>
      <parameter name="LINERESOLUTION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a line resolution band</brief>
        <description>
          If this parameter is true, the <def>Line Resolution</def> will be
          computed for every pixel and placed in a band in the output cube.
          The output cube labels will contain "Line Resolution" in the BandBin
          group, in band sequence of the output file.  LineResolution is in meters.
        </description>
      </parameter>
      <parameter name="SAMPLERESOLUTION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a sample resolution band</brief>
        <description>
          If this parameter is true, the <def>Sample Resolution</def> will be
          computed for every pixel and placed in a band in the output cube.
          The output cube labels will contain "Sample Resolution" in the
          BandBin group, in band sequence of the output file.  SampleResolution
          is in meters.
       </description>
      </parameter>
      <parameter name="DETECTORRESOLUTION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a detector resolution band</brief>
        <description>
          If this parameter is true, the <def>Detector Resolution</def> will be
          computed for every pixel and placed in a band in the output cube.  The
          output cube labels will contain "Detector Resolution" in the BandBin
          group, in band sequence of the output file.  DetectorResolution is
          in millimeters.
        </description>
      </parameter>

      <parameter name="OBLIQUEDETECTORRESOLUTION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create an oblique detector resolution band</brief>
        <description>
          If this parameter is true, the <def>Oblique Detector Resolution</def> will be
          computed for every pixel and placed in a band in the output cube.  The
          output cube labels will contain "Oblique Detector Resolution" in the BandBin
          group, in band sequence of the output file.  ObliqueDetectorResolution is
          in millimeters.
        </description>
      </parameter>

      <parameter name="NORTHAZIMUTH">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a north azimuth band</brief>
        <description>
          If this parameter is true, the <def>North Azimuth</def> will be
          computed for every pixel and placed in a band in the output cube.  The
          output cube labels will contain "North  Azimuth" in the BandBin group,
          in band sequence of the output file.  NorthAzimuth is in degrees.
        </description>
      </parameter>
      <parameter name="SUNAZIMUTH">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a sun azimuth band</brief>
        <description>
          If this parameter is true, the <def>Sun Azimuth</def> will be computed
          for every pixel and placed in a band in the output cube.  The output
          cube labels will contain "Sun Azimuth" in the BandBin group, in band
          sequence of the output file.  SunAzimuth is in degrees.
        </description>
      </parameter>
      <parameter name="SPACECRAFTAZIMUTH">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a spacecraft azimuth band</brief>
        <description>
          If this parameter is true, the <def>Spacecraft Azimuth</def>  will
          be computed for every pixel and placed in a band in the output cube.
          The output cube labels will contain "Spacecraft Azimuth" in the
          BandBin group, in band sequence of the output file.  SpacecraftAzimuth
          is in degrees.
        </description>
      </parameter>
      <parameter name="OFFNADIRANGLE">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create an offNadir angle band</brief>
        <description>
          If this parameter is true, the <def>Off Nadir Angle</def> will be
          computed for every pixel and placed in a band in the output cube.
          The output cube labels will contain "OffNadir Angle" in the BandBin
          group, in band sequence of the output file.  OffNadirAngle is
          in degrees.
        </description>
      </parameter>
      <parameter name="SLOPE">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a slope band</brief>
        <description>
          If this parameter is true, the slope will be computed for every pixel
          and placed in a band in the output cube. The output cube labels will
          contain "Slope" in the BandBin group, in band sequence of the output
          file. The slope is in degrees with 0 degrees being perfectly flat and
          90 degrees being sheer vertical.

          <p>
            Note: The slope is measured relative to a sphere and not a more
            complex datum like the gravity model
          </p>

          If computing slopes, the input image must be a level1 image. To
          compute slopes for a level2 DEM use
          <a href="../slpmap/slpmap.html" target="_blank">slpmap</a>.
        </description>
      </parameter>
      <parameter name="LOCALNORMAL">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>
          Create X, Y, and Z back planes from the local normal vector
        </brief>
        <description>
          If this parameter is true, a local normal will be computed for
          every pixel based on the shapemodel of the cube, and placed in
          three bands (X, Y, Z) in the output cube. Meaning if your cube has an
          ellipsoid shapemodel rather than a DEM, the local normal and the
          ellipsoid normal will look the same. The output cube labels will contain
          three "Local Normal (coord)" keywords in the BandBin group, in band
          sequence of the output file.

          <p>
            Note: These X, Y, and Z bands are in the body fixed reference frame.
          </p>
        </description>
      </parameter>
      <parameter name="ELLIPSOIDNORMAL">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>
          Create X, Y, and Z back planes from the ellipsoid normal vector
        </brief>
        <description>
          If this parameter is true, the ellipsoid normal will be computed for
          every pixel and placed in three bands (X, Y, Z) in the output cube.
          This normal will always be computed with a triaxial ellipsoid
          regardless of shapemodel. The output cube labels will contain three
          "Ellipsoid Normal (coord)" keywords in the BandBin group, in band
          sequence of the output file.

          <p>
            Note: These X, Y, and Z bands are in the body fixed reference frame.
          </p>
        </description>
      </parameter>
      <parameter name="SUBSPACECRAFTGROUNDAZIMUTH">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a sub spacecraft ground azimuth band</brief>
        <description>
          If this parameter is true, the <def>Spacecraft Ground Azimuth</def>
          will be computed for every pixel and placed in a band in the output
          cube.  The output cube labels  will contain "Sub Spacecraft Ground
          Azimuth" in the BandBin group, in band sequence of the output file.
          SubSpacecraftGround Azimuth is in degrees.
        </description>
      </parameter>
      <parameter name="SUBSOLARGROUNDAZIMUTH">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a sub solar ground azimuth band</brief>
        <description>
          If this parameter is true, the <def>SubSolar Ground Azimuth</def>
          will be computed for every pixel and placed in a band in the output
          cube.  The output cube labels will contain "Sub Solar Ground Azimuth"
          in the BandBin group, in band sequence of the output file.
          SubSolarGroundAzimuth is in degrees.
        </description>
      </parameter>
     <parameter name="MORPHOLOGYRANK">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create a morphology rank band, used for ranking images based on favorable local emission angles.</brief>
        <description>
	        <p>
            This band is computed from the <def link="Pixel Resolution">pixel resolution</def>
            and <def link="Emission Angle">emission angle</def> using the following formula:<br />
            <br />MorphologyRank = PixelResolution / cos(EmissionAngle)<br /> <br />
            The resulting output band can be used by <i>automos</i> to create a
            morphology-based mosaic product.  This option uses the
            <def link="Local Emission Angle">local emission angle</def> if the input file
            is initialized (spiceinit) with an elevation model (DEM); otherwise, it
            uses the default calculation (from the ellipsoid).  All computed cosines are
            tested for zero.  If the result is zero, then the value is set to a constant
            value very close to zero.
          </p>
          <p>
            <dl>
              <dt>
                Append the following parameters to the <i>automos</i> command line to utilize this backplane band:
              </dt>
              <dd>
                <b>priority=band type=keyword keyname=Name keyvalue=morphologyRank criteria=lesser</b>.
              </dd>
            </dl>
            See <i>automos</i> documentation for further details.
          </p>
        </description>
      </parameter>
     <parameter name="ALBEDORANK">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create an albedo rank band, used for ranking images based on favorable emission and incidence angles.</brief>
        <description>
          <p>
            This band is computed from the <def link="Pixel Resolution">pixel resolution</def>,
            <def link="Incidence Angle">incidence angle</def> and <def link="Emission Angle">emission angle</def>
            using the following formula:<br /><br />
            AlbedoRank = PixelResolution * [(1 / cos(EmissionAngle)) + (1 / cos(IncidenceAngle))]<br /><br />
            The resulting output band can be used by <i>automos</i> to create an albedo-based
            mosaic product.  This option always uses the
            <def link="Local Emission Angle">local emission angle</def>  and
            <def link="Local Incidence Angle">local incidence angle</def> if the input file
            is initialized (spiceinit) with an elevation model (DEM); otherwise, it
            uses the default calculation (from the ellipsoid).  All computed cosines are
            tested for zero.  If the result is zero, then the value is set to a constant
            value very close to zero.
          </p>
          <p>
 	          <dl>
              <dt>
                Append the following parameters to the <i>automos</i> command line to utilize this backplane band:
              </dt>
              <dd>
                <b>priority=band type=keyword keyname=Name keyvalue=albedoRank criteria=lesser</b>.
              </dd>
            </dl>
            See <i>automos</i> documentation for further details.
          </p>
        </description>
      </parameter>
      <parameter name="RADEC">
         <type>boolean</type>
         <default><item>FALSE</item></default>
         <brief>Create bands for Right Ascension and Declination</brief>
         <description>
           If this parameter is true, the <def>Right Ascension</def>, and the
           <def>Declination</def> will be calculated for every pixel and each will be placed into
           their respective bands in the output cube. The output cube labels will contain
           "Right Ascension" and "Declination" in the BandBin group, in the band sequence of the
           output file. Right Ascension and Declination are in degrees.
         </description>
       </parameter>
      <parameter name="BODYFIXED">
         <type>boolean</type>
         <default><item>FALSE</item></default>
         <brief>Create bands for the X, Y, and Z Body Fixed Coordinates</brief>
         <description>
           If this parameter is true, the <def>Body Fixed Coordinates</def> will be calculated for
           every pixel and the values for X, Y, and Z will each be placed into their own bands in
           the output cube. The output cube labels will contain "Body Fixed X", "Body Fixed Y",
           and "Body Fixed Z" in the BandBin group, in the band sequence of the output file.
           Body Fixed Coordinates are in kilometers.
         </description>
       </parameter>
      <parameter name="LOCALTIME">
         <type>boolean</type>
         <default><item>FALSE</item></default>
         <brief>Create a band with local solar time</brief>
         <description>
           If this parameter is true, the <def>Local Solar Time</def> will be calculated for
           every pixel in the output cube. The output cube label will contain "Local Solar Time"
           in the BandBin group. Local Solar Time is in hours.
         </description>
       </parameter>
      <parameter name="SUNILLUMINATIONMASK">
         <type>boolean</type>
         <default><item>FALSE</item></default>
         <brief>Create band with pixel values of 1 (illuminated) or 0 (shadowed) indicating
                sun illumination state</brief>
         <description>
            <p>
    	        If this parameter is true, the <b>Solar Illumination Mask</b>
              (or shadow mask), will be determined for every pixel. This option is
              primarily useful for small irregular bodies (e.g. comets, asteroids),
              where terrain is occluded from solar illumination at the surface
              intersection point at a given pixel. This information cannot be provided
              solely by incidence or local incidence angles as the occlusion occurs due
              to foreground terrain, such as lobes in comets, at much larger distances
              than the proximity of the initial surface point of intersection. The
              output cube label will contain "Sun Illumination Mask" in the BandBin group,
              in band sequence of the output file. 
            </p>
            <p>
              The output mask pixel is a boolean value computed using ray trace
              functions. Pixels are either 1 (illuminated) or 0 (shadowed). A look
              direction from the sun is computed to the spacecraft (camera) pixel
              intercept location on the surface. If the solar intercept point on the
              surface is not the same point as seen from the spacecraft/camera
              perspective, it is deemed occluded (shadowed).  For tessellated plate shape
              models, which are often used to represent the shape of irregular bodies, both
              camera and solar surface intercept points must occur on the same triangle at
              approximately the same location.
            </p>
            <p>
              If the surface point is occluded/shadowed, a 0 (false) value is
              written as the output pixel mask value indicating it is not
              illuminated by the sun. All other cases will result in setting
              the output pixel mask value to 1 (true) indicating illumination by
              the sun. Note this mask will also include (i.e., identify pixels in)
              the <b>local</b> incidence backplane where the angles are greater
              than 90 degrees.
            </p>
            <p>
              <b>Note: The computation of this backplane is not supported for all ISIS
              shape models or for the ellipsoid. At this time we know that it functions
              properly using the Bullet ray trace engine.</b>
            </p>
         </description>
       </parameter>
       <parameter name="SURFACEOBLIQUEDETECTORRESOLUTION">
        <type>boolean</type>
        <default><item>FALSE</item></default>
        <brief>Create the surface oblique detector resolution band</brief>
        <description>
            <p>
              If this parameter is true, the <def>Surface Oblique Detector
              Resolution</def> will be computed for every pixel and placed
              in a band in the output cube. This value differs from the
              Oblique Detector Resolution due to use of the local emission
              angle for that data. It is computed using the emission angle
              computed from the ellipsoid, which will produce a smoother
              data plane. The output cube label will contain "Surface Oblique
              Detector Resolution" in the BandBin group, in band sequence of
              the output file. SurfaceObliqueDetectorResolution is in millimeters.
            </p>
            <p>
              <b>Note: The computation of this backplane is not supported for all ISIS
              shape models or for the ellipsoid. At this time we know that it functions
              properly using the Bullet ray trace engine.</b>
            </p>
         </description>
      </parameter>
    </group>
  </groups>

  <examples>
    <example>
      <brief>Create latitude and morphologyRank backplane bands</brief>
      <description>
        Within this example, <i>phocube</i> creates an output file with two bands
        that contain latitude information and computed morphologyRank
        values, which are shown below as separate snapshots under "Output
        Images."  The input image file shown below under "Input Image" was
        not propagated to the <i>phocube</i> output file because DN is set to
        false.  If the <i>phocube</i> output file is projected and mosaicked,
        the mosaic file will contain the latitude information for the first
        band and the "morphologyRank" values for the second band, but no image
        information from the input image will be included.  The "DN"
        parameter must be set to "true" if the output product is expected
        to contain the input image.
      </description>
      <terminalInterface>
        <commandLine>
          from=EW0131773041G_cal.cub to=EW0131773041G_cal.pho.cub phase=no emission=no incidence=no
          longitude=no morphologyRank=yes
        </commandLine>
        <description>Run <i>phocube</i> to create latitude and morphologyRank bands.</description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/phocube_gui.jpg" width="458" height="750">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.<br />  For this example,
              only "LATITUDE" and "MORPHOLOGYRANK" are selected.  The pre-selected
              options "PHASE," "EMISSION," "INCIDENCE," and "LONGITUDE" are
              deselected to avoid creating these unwanted backplanes.
            </description>
            <thumbnail src="assets/thumbs/thumb_phocube_gui.jpg" caption="phocube GUI" width="147" height="243"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <inputImages>
        <image src="assets/images/EW0131773041G_cal.png" width="496" height="496">
          <brief>Input file </brief>
          <description>
            Screenshot of the input cube file.
          </description>
          <thumbnail src="assets/thumbs/EW0131773041G_cal_thumb.png" caption="Input image" width="200" height="200"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>S
      <outputImages>
        <image src="assets/images/phocube_lat_band.png" width="496" height="496">
          <brief>Output file band 1 (Latitude)</brief>
          <description>
            Screenshot of the first band in the output file.  This file contains the
            latitude information with -72.2 degree as the minimum, and 6.27 degree
            as the maximum value.
          </description>
          <thumbnail src="assets/thumbs/thumb_phocube_lat_band.png" caption="Output image band 1 (latitude)" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
        <image src="assets/images/phocube_morph_band.png" width="496" height="496">
          <brief>Output file band 2 (MorphologyRank)</brief>
          <description>
            Screenshot of the second band in the output file.  This file contains the
            computed morphologyRank values with 0.0 as the minimum, and 15.0 as the maximum
            value.  The minimum and maximum values were manually selected to brighten
            the image for visual presentation.  The actual range is between 2.8 and 41.5
            DN values.
          </description>
          <thumbnail src="assets/thumbs/thumb_phocube_morph_band.png" caption="Output image band 2 (morphologyRank)" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>
    <example>
      <brief>Create "sun illumination mask" and "surface oblique detector resolution" backplane bands</brief>
      <description>
        In this example, <i>phocube</i> creates an output cube file with a
        sun illumination backplane and a surface oblique detector resolution
        backplane. These backplanes are shown below as separate snapshots
        under "Output Images." The input image file shown below under "Input
        Image" was not propagated to the <i>phocube</i> output file because DN
        is set to false. The "DN" parameter must be set to "true" if the output
        product is expected to contain the input image.
      </description>
      <terminalInterface>
        <commandLine>
          from=20190425T211232S312_map_iofL2pan.cub to=20190425T211232S312_map_iofL2pan.pho.cub specialpixels=no
          phase=no emission=no incidence=no latitude=no longitude=no sunilluminationmask=yes
          surfaceobliquedetectorresolution=yes
        </commandLine>
        <description>Run <i>phocube</i> to create sunilluminationmask and surfaceobliquedetectorresolution bands.</description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/phocube_gui_example2.jpg" width="458" height="764">
            <brief>Example GUI</brief>
            <description>
              Screenshot of GUI version of the application.<br />  For this example,
              only "SUNILLUMINATIONMASK" and "SURFACEOBLIQUEDETECTORRESOLUTION" are selected.  The pre-selected
              options "PHASE," "EMISSION," "INCIDENCE," "LATITUDE," and "LONGITUDE" are
              deselected to avoid creating these unwanted backplanes.
            </description>
            <thumbnail src="assets/thumbs/thumb_phocube_gui_example2.jpg" caption="phocube GUI" width="147" height="245"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <inputImages>
        <image src="assets/images/20190425T211232S312_map_iofL2pan.png" width="496" height="522">
          <brief>Input file </brief>
          <description>
            Screenshot of the input cube file.
          </description>
          <thumbnail src="assets/thumbs/20190425T211232S312_map_iofL2pan_thumb.png" caption="Input image" width="200" height="210"/>
          <parameterName>
            FROM
          </parameterName>
        </image>
      </inputImages>
      <outputImages>
        <image src="assets/images/phocube_sun_illumination_band.png" width="496" height="522">
          <brief>Output file band 1 (SunIlluminationMask)</brief>
          <description>
            Screenshot of the first band in the output file.  This band contains
            sun illumination information. Occluded and illuminated pixel values
            are 0 and 1 respectively.
          </description>
          <thumbnail src="assets/thumbs/thumb_phocube_sun_illumination_band.png" caption="Output image band 1 (Sun Illumination Mask)" width="200" height="210"/>
          <parameterName>
            TO
          </parameterName>
        </image>
        <image src="assets/images/phocube_surface_oblique_detector_resolution_band.png" width="496" height="496">
          <brief>Output file band 2 (SurfaceObliqueDetectorResolution)</brief>
          <description>
            Screenshot of the second band in the output file containing
            Surface Oblique Detector Resolution information computed using the
            emission angle determined from the ellipsoid. This produces a
            smoother data plane compared to that created with the Oblique
            Detector Resolution option, which is computed using the local
            emission angle from the shape model.
          </description>
          <thumbnail src="assets/thumbs/thumb_phocube_surface_oblique_detector_resolution_band.png" caption="Output image band 2 (Surface Oblique Detector Resolution)" width="200" height="200"/>
          <parameterName>
            TO
          </parameterName>
        </image>
      </outputImages>
    </example>
  </examples>
</application>
