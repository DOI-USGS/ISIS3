<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id$ -->

<application name="hyb2onccal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
  <brief>
    Calibrates Hayabusa 2 ONC-T images. Calibration includes bias and dark current correction as
    well as flat-field correction. No smear or point spread is being currently corrected (lack of
    models to correct for this currently). Also, since no radiance calibration paramters could not
    be determined for the individual filters, the output will be DNs (not radiance or I/F).
    The wide-angle instruments, ONC-W1 and ONC-W2, do not have flat-field correction.
  </brief>

  <description>
  This program calibrates images from the Hayabusa 2 ONC-T instrument.
  The input image is corrected for the following, in order, during
  calibration: <br/>
  <ul>
    <li><a href="#BiasRemoval">Step 1: Bias and dark current removal.</a ></li>
    <li><a href="#Flatfield">Step 2: Uniformity (flat field) correction.</a ></li>
    <li><a href="#Notes">Notes</a></li>
    <li><a href="#References">References</a ></li>
  </ul>

  <p>
    <h1><a id="BiasRemoval:">Step 1: Bias and dark current removal.</a ></h1>
    The signal level of ONC-T is determined by a combination of an electronic offset
    which defines the "zero" level of the analog-to-digital converter (the bias) as well
    as any additional signal due to thermal electrons (the dark current).  With this instrument,
    the bias level depends largely on the electronics package (ONC-AE) and is only slightly affected
    by the instrument's CCD temperature. Therefore, the bias correction has been modeled as a
    function of the ONC-AE temperature. The dark current is modeled as a function of the ONC-T CCD
    temperature.

    <div style="font-size:90%; font-family:monospace; margin:5px; margin-left:30px;">

    <center><strong>BIAS(t) = B<sub>0</sub> + B<sub>1</sub>*t + B<sub>2</sub>*t<sup>2</sup>,
  </strong> where <strong>t</strong> the ONC-AE temparature in degrees Celsius.</center>
    </div>

    The constants <strong>B<sub>0</sub></strong>, <strong>B<sub>1</sub></strong> and
    <strong>B<sub>2</sub></strong> were determined by fitting a quadratic polynomial to the data
    provided in Fig. 3 <em>Bias level and AE temperature</em> on page 22 of
    <a href="#References"><em>Preflight Calibration (S. Kameda et al.)</em></a>


    <div style="font-size:90%; font-family:monospace; margin:5px; margin-left:30px;">
    <center><table border = "1" cellpadding="5">
    <tr>
         <td>Variable</td>
         <td>Value</td>
    </tr>
    <tr>
         <td>B<sub>0</sub></td>
         <td>289.9</td>
    </tr>
    <tr>
          <td>B<sub>1</sub></td>
          <td>-1.5847</td>
    </tr>
    <tr>
          <td>B<sub>2</sub></td>
          <td>0.01211</td>
    </tr>
    </table></center>

    </div>
  </p>
  <p>
    <h1><a id="Flatfield">Step 2: Flat-field correction:</a ></h1>
    Performs a correction for pixel-to-pixel variation in CCD response and vignetting
    (reduction of image brightness near the periphery compared with the center).
    Flat-field images for all filters were acquired from
    <a href="https://www.darts.isas.jaxa.jp/pub/hayabusa2/onc_bundle/browse/l2a/20141211/all.html.">
    JAXA's DARTS</a>.
    The correction is accomplished by dividing each pixel of the output image by the corresponding
    pixel in the flat-field image.
  </p>




  <p>
    <h1><a id="References">References:</a></h1>
    <ol>
      <li>S. Kameda et al.  <i>"Preflight Calibration Test Results for Optical Navigation
      Camera Telescope (ONC-T) Onboard the Hayabusa2 Spacecraft"</i>.
      Space Sci Rev (2017) 208:17-31.
      </li>
      <li>E. Tatsumi et al.  <i>"Updated Inflight Calibration of Hayabusa2â€™s Optical Navigation Camera (ONC) for
      Scientific Observations during the Cruise Phase"</i>.
      https://arxiv.org/abs/1810.11065 [astro-ph.IM] 25 Oct, 2018.
      </li>
      <li>H. Suzuki et al. <i>"Initial inflight calibration for Hayabusa2 optical navigation camera
      (ONC) for science observations of asteroid Ryugu"</i>.
      Icarus. 300. 10.1016/j.icarus.2017.09.011
      </li>
    </ol>

  </p>


  </description>

  <category>
    <missionItem>Hayabusa2</missionItem>
  </category>

  <seeAlso>
    <applications>
      <item>hyb2onccal</item>
    </applications>
  </seeAlso>

  <history>
    <change name="Ian Humphrey and Kaj Williams" date="2017-07-27">
      Original version. Adapted from amicacal.
    </change>
    <change name="Tyler Wilson" date="2019-02-12">
      Modified version to handle the updated calibration values/formulas.
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>cube</type>
        <fileMode>input</fileMode>
        <brief>
          Input cube
        </brief>
        <description>
          This is the ISIS cube to be calibrated.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>
      <parameter name="TO">
        <type>cube</type>
        <fileMode>output</fileMode>
        <pixelType>real</pixelType>
        <brief>
          Corrected Output cube
        </brief>
        <description>
          This is the output file. The output cube will be a calibrated version
          of the input cube.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>

      <parameter name="CONFIG">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input ONC-T calibration config file
        </brief>
        <description>
           This is the PVL file containing the input configuration
           parameters for the hyb2onccal program. Users can modify
           the parameters as needed.
        </description>
        <filter>*.trn</filter>
         <!-->
        <default><item>/scratch/isis3data/hayabusa2/calibration/onc/hyb2oncCalibration????.trn</item></default>
        -->

        <default><item>/usgs/cpkgs/isis3/datalocal/hayabusa2/calibration/onc/hyb2oncCalibration????.trn</item></default>

      </parameter>
      
    </group>

    <!-- Recall no radiance values have been provided for the filters, so radiance and i/f cannot be
    correctly computed.
    <group name="Options">

      <parameter name = "UNITS">
        <type>string</type>
        <default><item>IOF</item></default>
        <brief>
          Convert to specified output calibrated units.
        </brief>
        <description>
        </description>
        <list>
          <option value="DN">
            <brief>
              Convert to DN units
            </brief>
            <description>
            </description>
          </option>

          <option value="RADIANCE">
            <brief>
              Convert to radiance unit
            </brief>
            <description>
            </description>
          </option>

            <option value="IOF">
              <brief>Irradiance over flux</brief>
              <description>
                  Commonly referred to as "I over F", this option selects the
                  output calibration units as irradiance over flux.
              </description>
            </option>

        </list>
      </parameter>
    </group>
  -->
  </groups>
</application>
