<?xml version="1.0" encoding="UTF-8"?>

<application name="messspkgen" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
  <brief>
    Generates MESSENGER SPKs
  </brief>

  <description>
    Generates MESSENGER SPKs from the output of kerneldbgen and the NAIF utility
    commnt.
    <p>
      This program was created to help automate the process of generating new
      SPK DB files for the MESSENGER mission, as the output from the ISIS
      program kerneldbgen requires some further tweaking in order to be fully
      accurate.  Specifically, it sets the end date of the reconstructed time
      period far into the future, which should be moved into a separate
      predicted section.
    </p>
    <p>
      This program creates the predicted section.  In order to determine the
      proper end time for the reconstructed range (and start time for the
      predicted range), a NAIF utilitt known as commnt is used (available as
      part of ISIS).  Prior to running this program, the user should run commnt
      as shown in the following example:
      <pre>
        commnt -r msgr_20040803_20120401_od233sc_0.bsp
      </pre>
      Here, replace the argument with whatever the most recent BSP file happens
      to be.  This will, however, dump far more information than this program is
      actually interested in.  To get the relevant end time, pipe the output of
      commnt into the following:
      <pre>
        grep -A 1 "Orbit" | sed -n "2p"
      </pre>
      An example of all this can be found in the downloadMessengerKernels
      script.
    </p>
    <p>
      This program will typically be run automatically, and update the most
      recent DB file (generated by kerneldbgen) in place.  The user optionally
      specify any UTC time or any output file, not conforming to the process
      laid out above.
    </p>
  </description>

  <history>
    <change name="Travis Addair" date="2011-11-16">
      Original version
    </change>
  </history>

  <category>
    <categoryItem>System</categoryItem>
  </category>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input SPK kernel.xxxx.db file
        </brief>
        <description>
          The incomplete SPK DB file generated by kerneldbgen.  This file will
          be added to in order to make a complete DB file, separating out part
          of the Reconstructed group to a separate Predicted group.  Defaulted
          to use $ISIS3DATA/messenger/kernels/spk/kernels.????.db.
        </description>
        <internalDefault>
          Automatic
        </internalDefault>
        <filter>
          *.db
        </filter>
      </parameter>

      <parameter name="TO">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
          Output SPK kernel.xxxx.db file
        </brief>
        <description>
          The new DB file, the result of extracting parts of the Reconstructed
          group out into a Predicted group.  Defaulted to modify the input file
          in place.
        </description>
        <internalDefault>
          Automatic
        </internalDefault>
        <filter>
          *.db
        </filter>
      </parameter>

      <parameter name="TIME">
        <type>string</type>
        <brief>
          The UTC time marking the transition from Reconstructed to Predicted
        </brief>
        <description>
          This string should be formatted as a UTC time that will then be
          transformed into a TDB time.  This format in particular is expected,
          as this value is expected to come from running the NAIF utility commnt
          on the most recent BSP and extracting the orbit date cut-off time.
          <p>
            This time will be used to take the existing end time from the
            Reconstructed group, set it to be the end time for the Predicted
            group, and then this time will mark the correct end time for the
            Reconstructed group and beginning of the Predicted group.
          </p>
        </description>
      </parameter>
    </group>
  </groups>
</application>
