<?xml version="1.0" encoding="UTF-8"?>

<application name="warp" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>
      Warp an image using a Control Network
  </brief>

  <description>
      <p>
      This application applies a geometric <i>warp</i> to an image using a user 
      supplied Control Network.  The Control Network consists of the input
      (FROM) cube and a second cube for which image-to-image Control Points
      are measured.  Programs, such as coreg, can be used to generate the
      Control Network file for level1 or level2 cubes.
      </p>
      <p>
      The Control Measures of the FROM cube are fit to the corresponding
      Control Measures of the second cube in the Control Network file using
      a weighted or non-weighted least squares fit to a polynomial of
      degree N, where N is specified by the DEGREE parameter.
      </p>
      <p>
      With weighted least squares fit, specific pixel movement (input
      to output location) is based on Control Point distances from a given
      pixel. That is, Control Points closest to a given input pixel will have
      greater weight (influence) on the computed output location than Control
      Points furthest from the input pixel. With non-weighted least squares
      fit, all Control Points will have equal weight toward influencing
      individual pixel movement.
      </p>
  </description>

  <history>
    <change name="Kay Edwards" date="1987-06-08">
      Original version
    </change>
    <change name="Jeff Anderson" date="2004-06-18">
      Converted to Isis 3.0
    </change>
    <change name="Elizabeth Miller" date="2005-10-11">
        Finished  documentation and code
    </change>
    <change name="Elizabeth Miler" date="2005-11-03">
        Added appTest
    </change>
    <change name="Jacob Danton" date="2006-04-05">
        Added error checking for control networks
    </change>
    <change name="Steven Lambright" date="2007-06-22">
        Fixed typo in user documentation
    </change>
    <change name="Steven Lambright" date="2008-05-13"> 
      Removed references to CubeInfo
    </change>
     <change name="Stacy Alley" date="2008-12-19"> 
      Updating documentation and adding examples
    </change>
     <change name="Janet Barrett" date="2010-07-30"> 
      Changed CONTROL parameter name to CNET.
    </change>
    <change name="Kris Becker" date="2011-10-07"> 
        Updated documentation with review and contributions from Chris Isbell 
        and Annie Howington. 
    </change>
    <change name="Jacob Cain" date="2022-11-22">
        Changed CUBE type to cube. Fixes #4780.
    </change>
  </history>

  <oldName>
      <item>random</item>
      <item>warp2</item>
  </oldName>

  <category>
    <categoryItem>Geometry</categoryItem>
  </category>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>cube</type>
        <fileMode>input</fileMode>
        <brief>
          Input cube to warp
        </brief>
        <description>
          Specify the input cube to be warped. This can be a level1 or level2
          cube. All bands within the cube will be warped 
          unless a specific band is specified.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>

      <parameter name="TO">
        <type>cube</type>
        <fileMode>output</fileMode>
        <brief>
          Output cube
        </brief>
        <description>
          This new output cube will contain the results of the warp processing. 
          It will either be a single-band or multi-band cube based on the input 
          bands specified in the FROM cube.
        </description>
      </parameter>

      <parameter name="CNET">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Control Network file
        </brief>
        <description>
          This input Control Network file contains image-to-image Control Points 
          that will be used to apply the warp transformation.  Exactly two 
          images are allowed in this Control Network, one of which must be the 
          FROM cube.  This file is typically generated by the <b>coreg</b> 
          application.
        </description>
        <filter>
          *.net
        </filter>
      </parameter>
    </group>

    <group name="Warp parameters">
      <parameter name="DEGREE">
        <type>integer</type>
        <default><item>1</item></default>
        <brief>Order of polynomial</brief>
        <description>
            The order of the polynomial to be used in the linear regression 
            fit.  Higher order polynomial requires more numerous Control Points. 
        </description>
        <minimum inclusive="yes">1</minimum>
      </parameter>

      <parameter name="WEIGHTED">
        <type>boolean</type>
        <default><item>true</item></default>
        <brief>Weight the Control Points using distance</brief>
        <description>
            With this option selected (default), specific pixel movement
          (input to output location) is based on Control Point distances from
          the pixel. That is, Control Points closest to a given input pixel
          will have greater weight (influence) on the computed output location
          than Control Coints furthest from the input pixel.  Without this 
             selection, all Control Points will have equal weight toward
          influencing individual pixel movement. 
        </description>
      </parameter>

      <parameter name="OSIZE">
        <type>string</type>
        <brief>Output cube size</brief>
        <default><item>MATCH</item></default>
        <description>
          This option determines how the size of the output cube is determined.  
          The  choices are MATCH, COMPUTE, and USER.  The MATCH option 
          (default) matches the output cube size to the size of the cube 
          provided in the CUBE parameter.  The COMPUTE option calculates the 
          output cube size from the Control Network file.  The USER parameter allows 
          the user to set the output cube size by entering sample and line 
          values in the ONS and ONL parameters. 
        </description>
        <list>
          <option value="MATCH">
            <brief>Match size of cube</brief>
            <description>
                This option will match the output cube to the size of the cube 
                provided in the CUBE parameter. 
            </description>
            <exclusions>
                <item>ONL</item>
                <item>ONS</item>
            </exclusions>
          </option>
          <option value="COMPUTE">
            <brief>Compute size using Control Points</brief>
            <description>
                Computes the size of the output file using the Control Network
                file.  
                This is done by solving for output positions given input 
                positions, then walk the edge of the input file to find the 
                maximum output line and sample.
            </description>
            <exclusions>
                <item>ONL</item>
                <item>ONS</item>
                <item>CUBE</item>
            </exclusions>
          </option>
          <option value="USER">
            <brief>User specific output cube size</brief>
            <description>
                The output cube size as provided by the ONS and ONL parameters. 
            </description>
            <inclusions>
                <item>ONL</item>
                <item>ONS</item>
            </inclusions>
            <exclusions>
                <item>CUBE</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="CUBE">
          <type>cube</type>
          <fileMode>input</fileMode>
        <brief>Match Output cube to this Cube's Size</brief>
        <description>
            The output cube will have the same dimensions as the cube entered here.
        </description>
        <filter>
            *.cub
        </filter>
      </parameter>

      <parameter name="ONL">
       <type>integer</type>
       <brief>Output Lines</brief>
       <description>
           Requested number of lines for the output cube.
       </description>
       <minimum inclusive="yes">1</minimum>
     </parameter>
    
     <parameter name="ONS">
       <type>integer</type>
       <brief>Output Samples</brief>
       <description>
           Requested number of samples for the output cube.
       </description>
       <minimum inclusive="yes">1</minimum>
     </parameter>
    </group>

    <group name="Interpolation">
      <parameter name="INTERP">
        <type>string</type>
        <default>
          <item>CUBICCONVOLUTION</item>
        </default>
        <brief>Type of interpolation</brief>
        <description>
          This is the type of interpolation to be performed on the input.
        </description>
        <list>
          <option value="NEARESTNEIGHBOR">
            <brief>Nearest Neighbor</brief>
            <description>
              Each output pixel will be set to that of the pixel nearest the
              calculated input pixel.
            </description>
          </option>
          <option value="BILINEAR">
            <brief>Bi-Linear interpolation</brief>
            <description>
             Each output pixel value will be set as calculated by a bi-linear 
             pixel value interpolation of an 2x2 pixel array about the 
             calculated input pixel position. 
            </description>
          </option>
          <option value="CUBICCONVOLUTION">
            <brief>Cubic Convolution interpolation</brief>
            <description>
               Each output pixel value will be set as calculated by a cubic 
               convolution pixel value interpolation of an 4x4 pixel array about 
               the calculated input pixel position. 
            </description>
          </option>
        </list>
      </parameter>
    </group>
  </groups>

   <examples>
    <example>
      <brief> Warp Example 1</brief>
      <description>
       Warp Example 1
      </description>
      <terminalInterface>
        <commandLine> warp from=warp_from.cub to=warp_example1.cub 
        cnet=warp_example1.net osize=user onl=1000 ons=1000 
        </commandLine>
        <description>
         This warp command will warp the from cube (warp_from.cub) which is a 
         100Sx1000L image, to a 1000Sx1000L image and match the points from the 
         Control Points in warp_example1.net. 
         See the Control Network input file for more details.
        </description>
      </terminalInterface>
        <inputImages>
        <image src="assets/image/warp_from.jpg" width="55" height="550">
          <brief> Input image for warp</brief>
          <description>This is the input image for the warp examples.
          </description>
          <thumbnail caption=" Input image" src="assets/thumb/warp_from.jpg" width="20" height="200"/>
          <parameterName>FROM</parameterName>
        </image>
      </inputImages>

      <outputImages>
        <image src="assets/image/warp_example1.jpg" width="550" height="550">
          <brief> Output image for warp</brief>
          <description> This is the output image for this example of warp.  
           The Control Network file link below contains the points required to 
           create this kind of a warp output.
          </description>
          <thumbnail caption="Output image showing results of the warp application." src="assets/thumb/warp_example1.jpg" width="200" height="200"/>
          <parameterName>TO</parameterName>
        </image>
      </outputImages>

      <dataFiles>
        <dataFile path="assets/warp_example1.net">
          <brief>
            Control Network input file.
          </brief>
          <description>
            This is the required input for the CNET parameter.  In each control point there are 
            two measures.  Measure 1 is the point on the from
            cube you would 
            like to map to measure 2.
          </description>
          <parameterName></parameterName>
        </dataFile>
      </dataFiles>

    </example>

      <example>
      <brief> Warp Example 2</brief>
      <description>
       Warp Example 2
      </description>
      <terminalInterface>
        <commandLine> warp from=warp_from.cub to=warp_example2.cub 
          cnetl=warp_example2.net osize=user onl=1000 ons=1000
        </commandLine>
        <description>
         This warp command will warp the from cube (warp_from.cub) which is a 
         100Sx1000L image, to a 1000Sx1000L image and match the points from the 
         Control Points in warp_example1.net. 
         See the Control Network input file for more details.
        </description>
      </terminalInterface>
        <inputImages>
        <image src="assets/image/warp_from.jpg" width="55" height="550">
          <brief> Input image for warp</brief>
          <description>This is the input image for the warp examples.
          </description>
          <thumbnail caption=" Input image" src="assets/thumb/warp_from.jpg" width="20" height="200"/>
          <parameterName>FROM</parameterName>
        </image>
      </inputImages>

      <outputImages>
        <image src="assets/image/warp_example2.jpg" width="550" height="550">
          <brief> Output image for warp</brief>
          <description> This is the output image for this example of warp.  
           The Control Network file link below contains the points required to 
           create this kind of a warp output.
          </description>
          <thumbnail caption="Output image showing results of the warp application." src="assets/thumb/warp_example2.jpg" width="200" height="200"/>
          <parameterName>TO</parameterName>
        </image>
      </outputImages>

      <dataFiles>
        <dataFile path="assets/warp_example2.net">
          <brief>
            Control Network input file.
          </brief>
          <description>
            This is the required input for the CNET parameter.  In each control 
            point there are two measures.  Measure 1 is the point on the from
            cube you would like to map to measure 2.
          </description>
          <parameterName></parameterName>
        </dataFile>
      </dataFiles>

    </example>

     <example>
      <brief>Warp Grid Example 3</brief>
      <description>
          This example shows the effect warm has on a grid.  A 1000x1000 image 
          with grid lines every 50 pixels was created.  The control net file has 
          4 points where the upper right and lower left corners were held.  The 
          upper left and lower right points were move to 100,1 and 800,800, 
          respectively.
      </description>
      <terminalInterface>
        <commandLine> warp from=grid_raw.cub  to=grid_warp_weight.cub
          cnet=warp_points.net osize=user onl=1000 ons=1000 interp=bilinear
        </commandLine>
        <description>
         This warp command will warp the from cube (grid_raw.cub) which is a 
         1000Sx1000L image, to a 1000Sx1000L image and match the points from the 
         Control Points in warp_points.net. See the Control Network input file 
         for more details.
        </description>
      </terminalInterface>
        <inputImages>
        <image src="assets/image/grid_raw.jpg" width="1000" height="1000">
          <brief> Input image for warp</brief>
          <description>
              This input file is a 1000x1000 size image with grid lines at 50x50 
              increments. 
          </description>
          <thumbnail caption=" Input image" src="assets/thumb/grid_raw_thumb.jpg" width="250" height="250"/>
          <parameterName>FROM</parameterName>
        </image>
      </inputImages>

      <outputImages>
        <image src="assets/image/grid_warp_weight.jpg" width="1000" height="1000">
          <brief> Output image for warp</brief>
          <description> This is the output image for this example of warp.  
           The Control Network file link below contains the points required to 
           create this kind of a warp output.
          </description>
          <thumbnail caption="Output image showing results of the warp application." src="assets/thumb/grid_warp_weight_thumb.jpg" width="250" height="250"/>
          <parameterName>TO</parameterName>
        </image>
      </outputImages>

      <dataFiles>
        <dataFile path="assets/warp_points.net">
          <brief>
            Control Network input file.
          </brief>
          <description>
            This is the require input for the CNET parameter.  In each control 
            point there are two measures.  Measure 1 is the point on the from 
            cube you would like to map to measure 2.
          </description>
          <parameterName></parameterName>
        </dataFile>
      </dataFiles>

    </example>

   </examples>

</application>

