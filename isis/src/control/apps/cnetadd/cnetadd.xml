<?xml version="1.0" encoding="UTF-8"?>

<application name="cnetadd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>
    Adds Level 1 or Level 2 images to an existing Isis Control Net file.
  </brief>

  <description>
    <p>
        This application adds Level 1 and Level 2 images to an existing ISIS
        <def>Control Net</def> file. It takes in an input Control Net CNET and a
        list file  ADDLIST which contains filenames of all the images to be
        added to the Control Net. The application adds the images to the
        network depending on the Retrieval options. The resulting output
        Control Net is placed in the user specified output file ONET. All other
        Control Net configurations remain unchanged.
    </p>
    <p>
        FROMLIST contains the list of all the images that are part of the input
        Control Net. This input parameter is optional with Control Nets
        generated by applications such as "seedgrid" which will contain only
        lat/lon but no other <def link="Control Measure">Control Measures</def>.
        However, FROMLIST is required if   the RETRIEVAL option is REFERENCE
        (described herein) where the lat/lon's are obtained from the FROMLIST
        <def link="Cube">cubes</def>.
    </p>
    <p>
        The application checks each image in the ADDLIST for all the <def link="Control Point">Control
        Points</def> in the input Control Network as to whether it can be added
        to   any given Control Point. If the image already exists for the
        Control Point, it is skipped. Otherwise, it is checked to see if the
        Control Point's location is within the latitude/longitude (lat/lon)
        boundaries of the image, and adds the image measures if it is.
    </p>
    <p>
        TOLIST is an optional output list which contains the list of all images
        in the output Control Net. If TOLIST is defined then FROMLIST is
        required to make the output list complete. Otherwise the TOLIST will
        contain only the new images from ADDLIST added to the Control Net.
    </p>
    <p>
        The images in the FROMLIST and ADDLIST must be available for the program
        to open. All the PVL log information such as duplicate <def link="Serial Number">serial numbers</def>
        common to FROMLIST and ADDLIST, images added, images omitted and Points
        modified are placed in LOG file if specified.
    </p>
    <p>
        MODIFIEDPOINTS is an optional output parameter that allows the user to
        create a list of the modified points in the final Control Net.
	   </p>
    <p>
        The program has four additional Options or parameters: POLYGON,
        RETRIEVAL, EXTRACT, and DEFILE. If the POLYGON option is enabled, this
        optimization will prune points that fall outside the latitude/longitude
        bounding box of the polygon for the image being added.  By performing
        this check up front, no expensive camera calculations to find a Point's
        location on an image will be performed for points that fail this test.
        In most cases, the vast majority of points fall outside of any given
        image during the adding process, so performance gains can be orders of
        magnitude. IMPORTANT NOTE: this optimization requires that all images
        have had "footprintinit" run beforehand in order to find the image
        polygons.
    </p>
    <p>
        The Control Point's location (lat/lon) is retrieved from either the
        REFERENCE (default) or POINT preference of the RETRIEVAL parameter. If
        REFERENCE is chosen, the lat/lon is calculated from the reference camera
        information of the corresponding images in FROMLIST. If POINT is chosen,
        the lat/lon is taken directly from the information attached to the
        Control Point. The lat/lon is then used to get the Line and Sample of
        the point on the image. IMPORTANT NOTE: the POINT option is meant for
        Control Networks built using "seedgrid" because this program attaches
        the lat/lon information to the points. If you use this option on
        networks with Control Points that do not have this information, those
        points will be ignored.
    </p>
    <p>
        The EXTRACT parameter allows the user to define what goes into the
        ONET. If ALL (default)is specified, then the entire input Control Net
        with the modified points will be written out to the output Control Net.
        If MODIFIED is specified, then only the modified Points(points which has
        the images from the ADDLIST added to it) will be extracted to the
        output.
    </p>
    <p>
        DEFFILE could be specified to validate measures (images). If the image
        being added to a particular point fails the validation test then the
        Measure is set to be Ignored. Following are the different options which
        could be specified in the DEFFILE.The application will validate the
        measure for specified properties. These properties are optional and the
        DEFFILE can have different combinations of these properties. The DEFFILE
        should be in the format shown below:
      </p>

    <p><div style="font-family: Arial, Helvetica, Geneva, sans-serif; font-size:95%">
         <table border="0"><tr><td width="40"></td><td>
          <table border="0" cellspacing="0" cellpadding="0">
          <tr><th colspan="3" align="left">Group=ValidMeasure </th></tr>
          <tr><td width="25"></td><td align="left">MinDN
          </td>
              <td>= Default is Min DN value (depends on the pixel size of the
                image)
              </td></tr>
          <tr><td></td><td align="left">MaxDN </td>
              <td>= Default is Max DN value (depends on the pixel size of the
                image)
              </td></tr>
          <tr><td></td><td align="left">MinEmission </td>
              <td>= 0 (Default)</td></tr>
          <tr><td></td><td align="left">MaxEmission </td>
              <td>= 135 (Default) </td></tr>
          <tr><td></td><td align="left">MinIncidence </td>
              <td>= 0 (Default) </td></tr>
          <tr><td></td><td align="left">MaxIncidence </td>
              <td>= 135 (Default) </td></tr>
          <tr><td></td><td align="left">MinResolution </td>
              <td>= 0 (Default) </td></tr>
          <tr><td></td><td align="left">MaxResolution </td>
              <td>= Maximum integer value</td></tr>
          <tr><td></td><td align="left">PixelsFromEdge</td>
              <td>= 0 (Default) OR</td></tr>
          <tr><td></td><td align="left">MetersFromEdge</td>
              <td>= 0 (Default) </td></tr>
          <tr><th colspan="3" align="left">EndGroup</th><td></td></tr>
          </table></td></tr>
    </table>
    </div>
    <br/>
    </p>
    <p>
      Measures are added if a Point is locked. But if the Point is locked and
      <def>Apriori</def> source is "AverageOfMeasures" then the measures are not
      added to the Control Point. This is because the Point being locked, it
      cannot be be updated for lat/lon values, so newly added measures did not
      contribute to the average that had been previously computed for at the
      point level.
    </p>
  </description>

  <category>
    <categoryItem>Control Networks</categoryItem>
  </category>

  <history>
    <change name="Steven Koechle" date="2008-11-24">
      Original version
    </change>
    <change name="Christopher Austin" date="2008-01-29">
      Fixed major memory leak and added memory control.  Changed param NETWORK
      to CNET, increased developer documentation, added a Progress Object
      during lat/lon calculation.
    </change>
    <change name="Christopher Austin" date="2008-02-23">
      Fixed an error with not catching the failed ground range setting.
    </change>
    <change name="Travis Addair" date="2009-08-27">
      Added radio button allowing user to fill a skeleton Control Network (no
      Control measures) generated by the seedgrid application so long as it
      contains a latitude/longitude for each Control point. This list of files
      to add has also had its parameter name changed from FROMLIST2 to ADDLIST
      for clarity.
    </change>
    <change name="Travis Addair" date="2009-09-02">
      When adding measures to a Network generated by the seedgrid application,
      the Ignore keyword for a Control Point is now set to false if the Point
      has at least two measures.
    </change>
    <change name="Travis Addair" date="2009-09-04">
      A sorted list of Control points that were modified will now be put into
      the log file.
    </change>
    <change name="Christopher Austin" date="2010-04-07">
      Modified to handle duplicate Serial Numbers between the FROMLIST and
      ADDLIST instead of throwing an exception.
    </change>
    <change name="Christopher Austin" date="2010-06-11">
      Added modified Point only cNet output, added list of modified points
      output.
    </change>
    <change name="Christopher Austin" date="2010-06-25">
      Added an error message  when RETREIVAL=POINT is used but lat/lon values
      are absent from the points.
    </change>
    <change name="Sharmila Prasad" date="2010-10-13">
      Modified for binary Control Net
    </change>
    <change name="Sharmila Prasad" date="2010-10-22">
      Reset Apriori values if Apriori source is AvgOfMeasures
    </change>
    <change name="Sharmila Prasad" date="2010-10-28">
      Do not add measures if the Control Point is locked and Apriori source is
      "AverageOfMeasures".
    </change>
    <change name="Christopher Austin" date="2010-11-19">
      Added the DEFFILE option and test, similar to cnetref. Logging still needs
      to be done.
    </change>
    <change name="Christopher Austin" date="2010-12-22">
      Modified documentation to better clarify the DEFFILE parameter.
    </change>
    <change name="Christopher Austin" date="2011-01-18">
      Altered to compile with the new Control redesign.
    </change>
    <change name="Christopher Austin" date="2011-02-18">
      Added the TOLIST parameter.
    </change>
    <change name="Christopher Austin" date="2011-03-14">
      Changed to use SurfacePoints instead of lat/lon calculations.
    </change>
    <change name="Jai Rideout" date="2011-04-12">
      Changed INNET to CNET and OUTNET to ONET for consistency.
    </change>
    <change name="Travis Addair" date="2011-05-25">
      Moved writing of TOLIST to occur after filtering for modified.
    </change>
    <change name="Travis Addair" date="2011-07-07">
      FROMLIST now optional even when RETRIEVAL=POINT to allow for complete
      TOLIST.
    </change>
    <change name="Sharmila Prasad" date="2011-09-29">
      Updated Documentation, moved output file MODIFIEDPOINTS to output file
      group,  changed group name Retrieval options to options and added new test
      Polygon to test the parameter POLYGON.
    </change>
    <change name="Jac Shinaman, Janet Richie" date="2011-09-29">Reviewed,
      Edited the Documentation and the GUI display
    </change>
    <change name="Debbie A. Cook" date="2012-02-17">
      The extract=modified option was changed to not output edit locked points
      and measures, since they were not modified.
    </change>
    <change name="Jeannie Backer" date="2012-10-25">
      Changed call to Camera::resolution() to lower camel case. Isis3 standards
      improvements. References #1181.
    </change>
  </history>

  <groups>

    <group name="Input Files">

        <parameter name="FROMLIST">
          <type>filename</type>
          <fileMode>input</fileMode>
          <brief>
            List of ISIS input cubes in the Control Net.
          </brief>
          <description>
            FROMLIST is a text file that contains the list of all the images
            that are part of the input Control Net. Every file used in the
            Control Net file should be represented in this list. This input
            parameter is optional as Control Net from applications such as
            seedgrid will have only Control points but no Control Measures. FROMLIST
            is required if the Retrieval option is REFERENCE which is the default and
            also if TOLIST is specified.

            The cubes must be available for the program to open.
          </description>
          <filter>
            *.lis
          </filter>
          <internalDefault>None</internalDefault>
        </parameter>

        <parameter name="CNET">
          <type>filename</type>
          <fileMode>input</fileMode>
          <brief>
              ISIS existing Control Net file
          </brief>
          <description>
            This parameter specifies the input Control Net file to which the
            images are to be added.
          </description>
          <filter>
            *.net
          </filter>
        </parameter>

      <parameter name="ADDLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of ISIS input cubes to be added to the Control Net.
        </brief>
        <description>
          A text file containing one column of ISIS cube file names. The cubes
          must be available for the program to open. If cubes in this list are
          also in the FROMLIST, process time will be increased.
        </description>
        <filter>
          *.lis
        </filter>
      </parameter>

    </group>

    <group name="Output Files">

      <parameter name="ONET">
          <type>filename</type>
          <fileMode>output</fileMode>
          <brief>
              Isis output Control Network file
          </brief>
          <description>
            ISIS output Control Network file. The resulting output Control Net
            with the added images is placed in the specified output file in
            ONET.
          </description>
          <filter>
            *.net
          </filter>
      </parameter>

      <parameter name="TOLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of ISIS output images in the ONET
        </brief>
        <description>
          Use this optional parameter to receive a list of all images in the ONET
          that are also in the FROMLIST or ADDLIST. To have a complete
          list, it is important to have the FROMLIST.
        </description>
        <filter>
          *.lis
        </filter>
        <internalDefault>None</internalDefault>
      </parameter>

      <parameter name="LOG">
          <type>filename</type>
          <fileMode>output</fileMode>
          <brief>
              Optional Log File
          </brief>
          <description>
            This optional log file contains information about which files were
            added to the Control Net, which ones were not, and which
            images were common in both the FROMLIST and ADDLIST.
          </description>
          <internalDefault>None</internalDefault>
        </parameter>

        <parameter name="MODIFIEDPOINTS">
          <type>filename</type>
          <fileMode>input</fileMode>
          <internalDefault>Do not list</internalDefault>
          <brief>Creates a list of all modified Control Points</brief>
          <description>
            This optional output file will create a list of the Control points
            that were modified by the addition of measures.
          </description>
          <filter> *.lis *.txt </filter>
        </parameter>

    </group>

    <group name="Options">

      <parameter name="POLYGON">
        <type>boolean</type>
        <default><item>False</item></default>
        <brief>Prune points outside image polygon in adding process</brief>
        <description>
          <p>
            When enabled, this optimization will prune points that fall outside
            the latitude/longitude bounding box of the polygon for the image
            being added.  By performing this check up front, no expensive camera
            calculations to find a Point's location on an image will be
            performed for points that fail this test.  In most cases, the vast
            majority of points fall outside of any given image during the adding
            process, so performance gains can be orders of magnitude.
          </p>
          <p>
            This optimization requires that all images have had "footprintinit"
            run beforehand in order to find the image polygons.
          </p>
        </description>
      </parameter>

        <parameter name="RETRIEVAL">
            <type>string</type>
            <brief>
               Retrieve latitude and longitude from Control points in the
               Control Network or the reference cameras obtained from the
               FROMLIST
            </brief>
            <description>
                This option allows the user to specify whether the latitude and
                longitude used for calculating Control measures' sample/line
                information should be retrieved from the reference cameras
                generated with the FROMLIST or the Control points contained
                within the input Control Network itself.  If the POINT option is
                selected, then there is no need to specify a FROMLIST, otherwise
                one must be specified.
            </description>
            <default><item>REFERENCE</item></default>
            <list>
                <option value="REFERENCE">
                    <brief>
                       Retrieve latitudes and longitudes from reference cameras
                    </brief>
                    <description>
                        This default option will retrieve the latitude and
                        longitude used for computing sample/line position in
                        each Control Measure from a reference camera obtained
                        from the FROMLIST.
                    </description>
                    <inclusions>
                        <item>FROMLIST</item>
                    </inclusions>
                </option>
                <option value="POINT">
                    <brief>
                        Retrieve latitudes and longitudes from Control points
                    </brief>
                    <description>
                        This option will retrieve the latitude and longitude
                        used for computing sample/line position in each Control
                        Measure from its Control Point in the input Control
                        Network.
                    </description>
                </option>
            </list>
        </parameter>

        <parameter name="EXTRACT">
          <type>string</type>
          <default><item>ALL</item></default>
          <brief>Defines what Control Points are to be placed in ONET</brief>
          <description>
            Use this parameter to determine whether to place all Control Points
            in the ONET, or just the Control Points with new Control Measures
            and reference image measures in the ONET. In this case, only
            reference measures and new measures are placed in the Control
            Points of the ONET.
          </description>
          <list>
             <option value="ALL">
                <brief>Place all Control Points in the ONET</brief>
                <description>
                  This default option will add the new cubes to the CNET and
                  place the result in ONET.
                </description>
              </option>
             <option value="MODIFIED">
                <brief>Only place changed Control Points in ONET</brief>
                <description>
                  This option will add the new cubes to the CNET, but only
                  place Control Points that have been added to in the ONET.
                  In addition, only new and reference Control Measures will be
                  placed in the resultant Control Points of the ONET.
                 </description>
              </option>
          </list>
        </parameter>

        <parameter name="DEFFILE">
          <type>filename</type>
          <fileMode>input</fileMode>
          <internalDefault>None</internalDefault>
          <brief>
            PVL file containing the description of the Validity Control
            Measure Keywords for new/added measures
          </brief>
          <description>
            This optional PVL file containing the description of the Validity
            Control Measure Keywords. <strong>Newly added Control
            Measures</strong> which are not valid based on these keywords will
            be set to Ignored. Control Measures that are originally in the CNET
            will <strong>not</strong> be evaluated/Ignored by the DEFFILE.
          </description>
          <filter>
            *.def *.pvl
          </filter>
        </parameter>
    </group>
</groups>

</application>
